{"content":"DQpsb2NhbCBmdW5jdGlvbiB0cnlfcmVxdWlyZShtb2R1bGUsIG1zZykNCiAgICBsb2NhbCBzdWNjZXNzLCByZXN1bHQgPSBwY2FsbChyZXF1aXJlLCBtb2R1bGUpDQogICAgaWYgc3VjY2VzcyB0aGVuIHJldHVybiByZXN1bHQgZWxzZSByZXR1cm4gZXJyb3IobXNnKSBlbmQNCmVuZA0KbG9jYWwgaW1hZ2VzID0gdHJ5X3JlcXVpcmUoImdhbWVzZW5zZS9pbWFnZXMiLCAiRG93bmxvYWQgaW1hZ2VzIGxpYnJhcnk6IGh0dHBzOi8vZ2FtZXNlbnNlLnB1Yi9mb3J1bXMvdmlld3RvcGljLnBocD9pZD0yMjkxNyIpDQpsb2NhbCBiaXQgPSB0cnlfcmVxdWlyZSgiYml0IikNCmxvY2FsIGJhc2U2NCA9IHRyeV9yZXF1aXJlKCJnYW1lc2Vuc2UvYmFzZTY0IiwgIkRvd25sb2FkIGJhc2U2NCBlbmNvZGUvZGVjb2RlIGxpYnJhcnk6IGh0dHBzOi8vZ2FtZXNlbnNlLnB1Yi9mb3J1bXMvdmlld3RvcGljLnBocD9pZD0yMTYxOSIpDQpsb2NhbCBhbnRpYWltX2Z1bmNzID0gdHJ5X3JlcXVpcmUoImdhbWVzZW5zZS9hbnRpYWltX2Z1bmNzIiwgIkRvd25sb2FkIGFudGktYWltIGZ1bmN0aW9ucyBsaWJyYXJ5OiBodHRwczovL2dhbWVzZW5zZS5wdWIvZm9ydW1zL3ZpZXd0b3BpYy5waHA/aWQ9Mjk2NjUiKQ0KbG9jYWwgZmZpID0gdHJ5X3JlcXVpcmUoImZmaSIsICJGYWlsZWQgdG8gcmVxdWlyZSBGRkksIHBsZWFzZSBtYWtlIHN1cmUgQWxsb3cgdW5zYWZlIHNjcmlwdHMgaXMgZW5hYmxlZCEiKQ0KbG9jYWwgdmVjdG9yID0gdHJ5X3JlcXVpcmUoInZlY3RvciIsICJNaXNzaW5nIHZlY3RvciIpDQpsb2NhbCBodHRwID0gdHJ5X3JlcXVpcmUoImdhbWVzZW5zZS9odHRwIiwgIkRvd25sb2FkIEhUVFAgbGlicmFyeTogaHR0cHM6Ly9nYW1lc2Vuc2UucHViL2ZvcnVtcy92aWV3dG9waWMucGhwP2lkPTIxNjE5IikNCmxvY2FsIGNsaXBib2FyZCA9IHRyeV9yZXF1aXJlKCJnYW1lc2Vuc2UvY2xpcGJvYXJkIiwgIkRvd25sb2FkIENsaXBib2FyZCBsaWJyYXJ5OiBodHRwczovL2dhbWVzZW5zZS5wdWIvZm9ydW1zL3ZpZXd0b3BpYy5waHA/aWQ9Mjg2NzgiKQ0KbG9jYWwgZW50ID0gdHJ5X3JlcXVpcmUoImdhbWVzZW5zZS9lbnRpdHkiLCAiRG93bmxvYWQgRW50aXR5IE9iamVjdCBsaWJyYXJ5OiBodHRwczovL2dhbWVzZW5zZS5wdWIvZm9ydW1zL3ZpZXd0b3BpYy5waHA/aWQ9Mjc1MjkiKQ0KbG9jYWwgY3Nnb193ZWFwb25zID0gdHJ5X3JlcXVpcmUoImdhbWVzZW5zZS9jc2dvX3dlYXBvbnMiLCAiRG93bmxvYWQgQ1M6R08gd2VhcG9uIGRhdGEgbGlicmFyeTogaHR0cHM6Ly9nYW1lc2Vuc2UucHViL2ZvcnVtcy92aWV3dG9waWMucGhwP2lkPTE4ODA3IikNCmxvY2FsIEdldENsaWVudEVudGl0eSA9IHZ0YWJsZV9iaW5kKCJjbGllbnRfcGFub3JhbWEuZGxsIiwgIlZDbGllbnRFbnRpdHlMaXN0MDAzIiwgMywgInZvaWQqKF9fdGhpc2NhbGwqKSh2b2lkKiwgaW50KSIpDQpsb2NhbCBzdGVhbXdvcmtzID0gdHJ5X3JlcXVpcmUoImdhbWVzZW5zZS9zdGVhbXdvcmtzIikgb3IgZXJyb3IoJ01pc3NpbmcgaHR0cHM6Ly9nYW1lc2Vuc2UucHViL2ZvcnVtcy92aWV3dG9waWMucGhwP2lkPTI2NTI2JykNCmxvY2FsIHRyYWNlID0gdHJ5X3JlcXVpcmUgKCJnYW1lc2Vuc2UvdHJhY2UiLCAiaHR0cHM6Ly9nYW1lc2Vuc2UucHViL2ZvcnVtcy92aWV3dG9waWMucGhwP2lkPTMyOTQ5IikNCmxvY2FsIGV4dF9lbnRpdHkgPSB0cnlfcmVxdWlyZSgiZ2FtZXNlbnNlL2VudGl0eSIsICJjbm0iKQ0KDQpsb2NhbCBsdWFuYW1lID0gIm1lZ2FtaXgiDQpsb2NhbCB1c2VybmFtZSA9ICJQYWdhbmluaSINCmxvY2FsIGludmVydCA9IHRydWUgDQpsb2NhbCB2YWx1ZSA9IDANCmZ1bmN0aW9uIHN3YXkoKQ0KICAgIGlmIGludmVydCA9PSB0cnVlIHRoZW4NCiAgICAgICAgdmFsdWUgPSB2YWx1ZSArIDINCg0KICAgICAgICBpZiB2YWx1ZSA+IDI1NSB0aGVuIA0KICAgICAgICAgICAgaW52ZXJ0ID0gZmFsc2UNCiAgICAgICAgZW5kDQoNCiAgICBlbHNlDQogICAgICAgIHZhbHVlID0gdmFsdWUgLSAxDQogICAgICAgIGlmIHZhbHVlID09IDAgdGhlbg0KICAgICAgICAgICAgaW52ZXJ0ID0gdHJ1ZQ0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICByZXR1cm4gdmFsdWUNCmVuZA0KDQpsb2NhbCBhaWludmVydCA9IHRydWUgDQpsb2NhbCBhaXZhbHVlID0gMA0KDQpmdW5jdGlvbiBhaXN3YXkoKQ0KICAgIGlmIGFpaW52ZXJ0ID09IHRydWUgdGhlbg0KICAgICAgICBhaXZhbHVlID0gYWl2YWx1ZSArIDAuMjUNCg0KICAgICAgICBpZiBhaXZhbHVlID4gMTAwIHRoZW4gDQogICAgICAgICAgICBhaWludmVydCA9IGZhbHNlDQogICAgICAgIGVuZA0KDQogICAgZWxzZQ0KICAgICAgICBhaXZhbHVlID0gYWl2YWx1ZSAtIDAuMjUNCiAgICAgICAgaWYgYWl2YWx1ZSA9PSAwIHRoZW4NCiAgICAgICAgICAgIGFpaW52ZXJ0ID0gdHJ1ZQ0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICByZXR1cm4gYWl2YWx1ZQ0KZW5kDQoNCmxvY2FsIGFkc2F3ZGlpbnZlcnQgPSB0cnVlIA0KbG9jYWwgYWlkc2F3ZHZhbHVlID0gMA0KDQpmdW5jdGlvbiBodHJzd2F5KCkNCiAgICBpZiBhZHNhd2RpaW52ZXJ0ID09IHRydWUgdGhlbg0KICAgICAgICBhaWRzYXdkdmFsdWUgPSBhaWRzYXdkdmFsdWUgKyAwLjI1DQoNCiAgICAgICAgaWYgYWlkc2F3ZHZhbHVlID4gNzUgdGhlbiANCiAgICAgICAgICAgIGFkc2F3ZGlpbnZlcnQgPSBmYWxzZQ0KICAgICAgICBlbmQNCg0KICAgIGVsc2UNCiAgICAgICAgYWlkc2F3ZHZhbHVlID0gYWlkc2F3ZHZhbHVlIC0gMC4yNQ0KICAgICAgICBpZiBhaWRzYXdkdmFsdWUgPT0gMjAgdGhlbg0KICAgICAgICAgICAgYWRzYXdkaWludmVydCA9IHRydWUNCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgcmV0dXJuIGFpZHNhd2R2YWx1ZQ0KZW5kDQoNCmxvY2FsIHBpdGNoaW52ZXJ0ID0gdHJ1ZSANCmxvY2FsIHBpdGNodmFsdWUgPSAwDQoNCmZ1bmN0aW9uIHBpdGNoc3dheShhLCBiLCBjKQ0KICAgIGlmIHBpdGNoaW52ZXJ0ID09IHRydWUgdGhlbg0KICAgICAgICBwaXRjaHZhbHVlID0gcGl0Y2h2YWx1ZSArIGMNCg0KICAgICAgICBpZiBwaXRjaHZhbHVlID4gYSB0aGVuIA0KICAgICAgICAgICAgcGl0Y2h2YWx1ZSA9IGENCiAgICAgICAgICAgIHBpdGNoaW52ZXJ0ID0gZmFsc2UNCiAgICAgICAgZW5kDQoNCiAgICBlbHNlDQogICAgICAgIHBpdGNodmFsdWUgPSBwaXRjaHZhbHVlIC0gYw0KICAgICAgICBpZiBwaXRjaHZhbHVlIDwgYiB0aGVuDQogICAgICAgICAgICBwaXRjaHZhbHVlID0gYg0KICAgICAgICAgICAgcGl0Y2hpbnZlcnQgPSB0cnVlDQogICAgICAgIGVuZA0KICAgIGVuZA0KICAgIHJldHVybiBwaXRjaHZhbHVlDQplbmQNCg0KLS0gSGVscGZ1bCBGQ1MNCmZ1bmN0aW9uIGxlcnAoYSwgYiwgdCkNCiAgICBpZiBub3QgYiBvciBub3QgYSBvciBub3QgdCB0aGVuIHJldHVybiBlbmQNCiAgICByZXR1cm4gYSArIChiIC0gYSkgKiB0DQplbmQNCmZ1bmN0aW9uIHRleHRfY2xhbXAoeCwgbWludmFsLCBtYXh2YWwpDQogICAgaWYgeCA8IG1pbnZhbCB0aGVuDQogICAgICAgIHJldHVybiBtaW52YWwNCiAgICBlbHNlaWYgeCA+IG1heHZhbCB0aGVuDQogICAgICAgIHJldHVybiBtYXh2YWwNCiAgICBlbHNlDQogICAgICAgIHJldHVybiB4DQogICAgZW5kDQplbmQNCmZ1bmN0aW9uIHVpLm11bHRpUmVmZXJlbmNlKHRhYiwgZ3JvdXBib3gsIG5hbWUpDQogICAgbG9jYWwgcmVmMSwgcmVmMiwgcmVmMyA9IHVpLnJlZmVyZW5jZSh0YWIsIGdyb3VwYm94LCBuYW1lKQ0KICAgIHJldHVybiB7IHJlZjEsIHJlZjIsIHJlZjMgfQ0KZW5kDQpyZ2JhX3RvX2hleCA9IGZ1bmN0aW9uKHIsIGcsIGIsIGEpDQogICAgcmV0dXJuIGJpdC50b2hleCgobWF0aC5mbG9vcihyICsgMC41KSAqIDE2Nzc3MjE2KSArIChtYXRoLmZsb29yKGcgKyAwLjUpICogNjU1MzYpICsgKG1hdGguZmxvb3IoYiArIDAuNSkgKiAyNTYpICsgKG1hdGguZmxvb3IoYSArIDAuNSkpKQ0KZW5kDQoNCmFuaW1hdGVfdGV4dCA9IGZ1bmN0aW9uKHRpbWUsIHN0cmluZywgciwgZywgYiwgYSwgcjIsIGcyLCBiMiwgYTIpDQogICAgbG9jYWwgbSwgbiwgbywgcCA9IHIyLCBnMiwgYjIsIGEyDQogICAgbG9jYWwgdF9vdXQgPSB7fQ0KICAgIGxvY2FsIGwgPSBzdHJpbmc6bGVuKCkgLSAxDQogICAgbG9jYWwgcl9hZGQgPSAobSAtIHIpDQogICAgbG9jYWwgZ19hZGQgPSAobiAtIGcpDQogICAgbG9jYWwgYl9hZGQgPSAobyAtIGIpDQogICAgbG9jYWwgYV9hZGQgPSAocCAtIGEpDQoNCiAgICBmb3IgaSA9IDEsICNzdHJpbmcgZG8NCiAgICAgICAgbG9jYWwgaXRlciA9IChpIC0gMSkgLyAoI3N0cmluZyAtIDEpICsgdGltZQ0KICAgICAgICB0X291dFsjdF9vdXQgKyAxXSA9ICJcYSIgLi4gcmdiYV90b19oZXgociArIHJfYWRkICogbWF0aC5hYnMobWF0aC5jb3MoaXRlcikpLCBnICsgZ19hZGQgKiBtYXRoLmFicyhtYXRoLmNvcyhpdGVyKSksIGIgKyBiX2FkZCAqIG1hdGguYWJzKG1hdGguY29zKGl0ZXIpKSwgYSArIGFfYWRkICogbWF0aC5hYnMobWF0aC5jb3MoaXRlcikpKQ0KICAgICAgICB0X291dFsjdF9vdXQgKyAxXSA9IHN0cmluZzpzdWIoaSwgaSkNCiAgICBlbmQNCg0KICAgIHJldHVybiB0YWJsZS5jb25jYXQodF9vdXQpDQplbmQNCg0KZnVuY3Rpb24gYW5pbWF0ZV9jb2xvcih0aW1lLCByLCBnLCBiLCBhLCByMiwgZzIsIGIyLCBhMikNCiAgICBsb2NhbCBmaW5pc2hlZCA9IGZhbHNlDQogICAgbG9jYWwgbmV3UiwgbmV3RywgbmV3QiwgbmV3QSA9IHIsIGcsIGIsIGENCiAgICBpZiBuZXdSID09IHIyIGFuZCBuZXdHID09IGcyIGFuZCBuZXdCID09IGIyIGFuZCBuZXdBID09IGEyIHRoZW4NCiAgICAgICAgbmV3UiA9IGxlcnAociwgcjIsIHRpbWUpDQogICAgICAgIG5ld0cgPSBsZXJwKGcsIGcyLCB0aW1lKQ0KICAgICAgICBuZXdCID0gbGVycChiLCBiMiwgdGltZSkNCiAgICAgICAgbmV3QSA9IGxlcnAoYSwgYTIsIHRpbWUpDQogICAgZWxzZQ0KICAgICAgICBuZXdSID0gbGVycChyMiwgciwgdGltZSkNCiAgICAgICAgbmV3RyA9IGxlcnAoZzIsIGcsIHRpbWUpDQogICAgICAgIG5ld0IgPSBsZXJwKGIyLCBiLCB0aW1lKQ0KICAgICAgICBuZXdBID0gbGVycChhMiwgYSwgdGltZSkNCiAgICBlbmQNCiAgICByZXR1cm4gbmV3UiwgbmV3RywgbmV3QiwgbmV3QQ0KZW5kDQoNCmxvY2FsIHN0YXJ0X3RpbWUgPSBjbGllbnQudW5peF90aW1lKCkNCmxvY2FsIGZ1bmN0aW9uIGdldF9lbGFwc2VkX3RpbWUoKQ0KICAgIGxvY2FsIGVsYXBzZWRfc2Vjb25kcyA9IGNsaWVudC51bml4X3RpbWUoKSAtIHN0YXJ0X3RpbWUNCiAgICBsb2NhbCBob3VycyA9IG1hdGguZmxvb3IoZWxhcHNlZF9zZWNvbmRzIC8gMzYwMCkNCiAgICBsb2NhbCBtaW51dGVzID0gbWF0aC5mbG9vcigoZWxhcHNlZF9zZWNvbmRzIC0gaG91cnMgKiAzNjAwKSAvIDYwKQ0KICAgIGxvY2FsIHNlY29uZHMgPSBtYXRoLmZsb29yKGVsYXBzZWRfc2Vjb25kcyAtIGhvdXJzICogMzYwMCAtIG1pbnV0ZXMgKiA2MCkNCiAgICByZXR1cm4gc3RyaW5nLmZvcm1hdCgiJTAyZDolMDJkOiUwMmQiLCBob3VycywgbWludXRlcywgc2Vjb25kcykNCmVuZA0KDQpsb2NhbCBmdW5jdGlvbiBlbnRpdHlfaXNfcmVhZHkoZW50KQ0KICAgIHJldHVybiBnbG9iYWxzLmN1cnRpbWUoKSA+PSBlbnRpdHkuZ2V0X3Byb3AoZW50LCAnbV9mbE5leHRBdHRhY2snKQ0KZW5kDQoNCmxvY2FsIGZ1bmN0aW9uIGVudGl0eV9jYW5fZmlyZShlbnQpDQogICAgcmV0dXJuIGdsb2JhbHMuY3VydGltZSgpID49IGVudGl0eS5nZXRfcHJvcChlbnQsICdtX2ZsTmV4dFByaW1hcnlBdHRhY2snKQ0KZW5kDQoNCmZ1bmN0aW9uIGNyZWF0ZV9kYXRhKGZsYWdzLCB2ZWxvY2l0eSkNCiAgICByZXR1cm4gew0KICAgICAgICBmbGFncyA9IGZsYWdzIG9yIDAsDQogICAgICAgIHZlbG9jaXR5ID0gdmVsb2NpdHkgb3IgdmVjdG9yKCkNCiAgICB9DQplbmQNCg0KbG9jYWwgZnVuY3Rpb24gYW5nbGVfdG9fZm9yd2FyZChhbmdsZV94LCBhbmdsZV95KQ0KICAgIGxvY2FsIHN5ID0gbWF0aC5zaW4obWF0aC5yYWQoYW5nbGVfeSkpOw0KICAgIGxvY2FsIGN5ID0gbWF0aC5jb3MobWF0aC5yYWQoYW5nbGVfeSkpOw0KICAgIGxvY2FsIHNwID0gbWF0aC5zaW4obWF0aC5yYWQoYW5nbGVfeCkpOw0KICAgIGxvY2FsIGNwID0gbWF0aC5jb3MobWF0aC5yYWQoYW5nbGVfeCkpOw0KICAgIHJldHVybiBjcCAqIGN5LCBjcCAqIHN5LCAtc3ANCmVuZA0KDQpsb2NhbCBwcmVkaWN0aW9uX2RhdGEgPSBjcmVhdGVfZGF0YSgpDQpsb2NhbCBzZXR1cF9kYXRhID0gY3JlYXRlX2RhdGEoKQ0KbG9jYWwgZnVuY3Rpb24gYXV0b3N0b3AoY21kLCBtaW5pbXVtKQ0KICAgIGxvY2FsIGxwID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQ0KICAgIGlmIGxwID09IG5pbCB0aGVuIHJldHVybiBlbmQNCiAgICBsb2NhbCB2ZWxvY2l0eSA9IHByZWRpY3Rpb25fZGF0YS52ZWxvY2l0eQ0KICAgIGxvY2FsIHNwZWVkID0gdmVsb2NpdHk6bGVuZ3RoMmQoKQ0KICAgIGxvY2FsIGRpcmVjdGlvbiA9IHZlY3Rvcih2ZWxvY2l0eTphbmdsZXMoKSkNCiAgICBsb2NhbCByZWFsX3ZpZXcgPSB2ZWN0b3IoY2xpZW50LmNhbWVyYV9hbmdsZXMoKSkNCiAgICBkaXJlY3Rpb24ueSA9IHJlYWxfdmlldy55IC0gZGlyZWN0aW9uLnk7DQogICAgbG9jYWwgZm9yd2FyZCA9IHZlY3RvcihhbmdsZV90b19mb3J3YXJkKGRpcmVjdGlvbi54LCBkaXJlY3Rpb24ueSkpDQoNCiAgICBsb2NhbCBuZWdhdGl2ZV9zaWRlX21vdmUgPSAtY3Zhci5jbF9zaWRlc3BlZWQ6Z2V0X2Zsb2F0KCkNCiAgICBsb2NhbCBuZWdhdGl2ZV9kaXJlY3Rpb24gPSBuZWdhdGl2ZV9zaWRlX21vdmUgKiBmb3J3YXJkDQoNCiAgICBjbWQuaW5fc3BlZWQgPSAxDQoNCiAgICBjbWQuZm9yd2FyZG1vdmUgPSBuZWdhdGl2ZV9kaXJlY3Rpb24ueA0KICAgIGNtZC5zaWRlbW92ZSA9IG5lZ2F0aXZlX2RpcmVjdGlvbi55DQplbmQNCg0KbG9jYWwgZnVuY3Rpb24gdHJhdmVyc2VfdGFibGUodGJsLCBwcmVmaXgpDQogICAgcHJlZml4ID0gcHJlZml4IG9yICIiDQogICAgbG9jYWwgc3RhY2sgPSB7e3RibCwgcHJlZml4fX0NCg0KICAgIHdoaWxlICNzdGFjayA+IDAgZG8NCiAgICAgICAgbG9jYWwgY3VycmVudCA9IHRhYmxlLnJlbW92ZShzdGFjaykNCiAgICAgICAgbG9jYWwgY3VycmVudF90YmwgPSBjdXJyZW50WzFdDQogICAgICAgIGxvY2FsIGN1cnJlbnRfcHJlZml4ID0gY3VycmVudFsyXQ0KDQogICAgICAgIGZvciBrZXksIHZhbHVlIGluIHBhaXJzKGN1cnJlbnRfdGJsKSBkbw0KICAgICAgICAgICAgbG9jYWwgZnVsbF9rZXkgPSBjdXJyZW50X3ByZWZpeCAuLiBrZXkNCiAgICAgICAgICAgIGlmIHR5cGUodmFsdWUpID09ICJ0YWJsZSIgdGhlbg0KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChzdGFjaywge3ZhbHVlLCBmdWxsX2tleSAuLiAiLiJ9KQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIC0tINCf0YDQuNC80LXQvdGP0LXQvCB1aS5zZXRfdmlzaWJsZSDQuiDQutCw0LbQtNC+0LzRgyDRjdC70LXQvNC10L3RgtGDDQogICAgICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUodmFsdWUsIGZhbHNlKSAtLSDQl9C00LXRgdGMINC80L7QttC90L4g0LjQt9C80LXQvdC40YLRjCDQv9Cw0YDQsNC80LXRgtGAINCy0LjQtNC40LzQvtGB0YLQuCDQvdCwINC90YPQttC90L7QtSDQt9C90LDRh9C10L3QuNC1DQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgZW5kDQplbmQNCg0KbG9jYWwgZnVuY3Rpb24gdHJhdmVyc2VfdGFibGVfb24odGJsLCBwcmVmaXgpDQogICAgcHJlZml4ID0gcHJlZml4IG9yICIiDQogICAgbG9jYWwgc3RhY2sgPSB7e3RibCwgcHJlZml4fX0NCg0KICAgIHdoaWxlICNzdGFjayA+IDAgZG8NCiAgICAgICAgbG9jYWwgY3VycmVudCA9IHRhYmxlLnJlbW92ZShzdGFjaykNCiAgICAgICAgbG9jYWwgY3VycmVudF90YmwgPSBjdXJyZW50WzFdDQogICAgICAgIGxvY2FsIGN1cnJlbnRfcHJlZml4ID0gY3VycmVudFsyXQ0KDQogICAgICAgIGZvciBrZXksIHZhbHVlIGluIHBhaXJzKGN1cnJlbnRfdGJsKSBkbw0KICAgICAgICAgICAgbG9jYWwgZnVsbF9rZXkgPSBjdXJyZW50X3ByZWZpeCAuLiBrZXkNCiAgICAgICAgICAgIGlmIHR5cGUodmFsdWUpID09ICJ0YWJsZSIgdGhlbg0KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChzdGFjaywge3ZhbHVlLCBmdWxsX2tleSAuLiAiLiJ9KQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIC0tINCf0YDQuNC80LXQvdGP0LXQvCB1aS5zZXRfdmlzaWJsZSDQuiDQutCw0LbQtNC+0LzRgyDRjdC70LXQvNC10L3RgtGDDQogICAgICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUodmFsdWUsIHRydWUpIC0tINCX0LTQtdGB0Ywg0LzQvtC20L3QviDQuNC30LzQtdC90LjRgtGMINC/0LDRgNCw0LzQtdGC0YAg0LLQuNC00LjQvNC+0YHRgtC4INC90LAg0L3Rg9C20L3QvtC1INC30L3QsNGH0LXQvdC40LUNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQNCmVuZA0KDQpsb2NhbCBpbmNsdWRlcyA9IGZ1bmN0aW9uKHRhYmxlLCBrZXkpDQogICAgZm9yIGkgPSAxLCAjdGFibGUgZG8NCiAgICAgICAgaWYgdGFibGVbaV0gPT0ga2V5IHRoZW4NCiAgICAgICAgICAgIHJldHVybiB0cnVlDQogICAgICAgIGVuZA0KICAgIGVuZA0KDQogICAgcmV0dXJuIGZhbHNlDQplbmQNCg0KcmVjID0gZnVuY3Rpb24oeCwgeSwgdywgaCwgcmFkaXVzLCBjb2xvcikNCiAgICByYWRpdXMgPSBtYXRoLm1pbih4LzIsIHkvMiwgcmFkaXVzKQ0KICAgIGxvY2FsIHIsIGcsIGIsIGEgPSB1bnBhY2soY29sb3IpDQogICAgcmVuZGVyZXIucmVjdGFuZ2xlKHgsIHkgKyByYWRpdXMsIHcsIGggLSByYWRpdXMqMiwgciwgZywgYiwgYSkNCiAgICByZW5kZXJlci5yZWN0YW5nbGUoeCArIHJhZGl1cywgeSwgdyAtIHJhZGl1cyoyLCByYWRpdXMsIHIsIGcsIGIsIGEpDQogICAgcmVuZGVyZXIucmVjdGFuZ2xlKHggKyByYWRpdXMsIHkgKyBoIC0gcmFkaXVzLCB3IC0gcmFkaXVzKjIsIHJhZGl1cywgciwgZywgYiwgYSkNCiAgICByZW5kZXJlci5jaXJjbGUoeCArIHJhZGl1cywgeSArIHJhZGl1cywgciwgZywgYiwgYSwgcmFkaXVzLCAxODAsIDAuMjUpDQogICAgcmVuZGVyZXIuY2lyY2xlKHggLSByYWRpdXMgKyB3LCB5ICsgcmFkaXVzLCByLCBnLCBiLCBhLCByYWRpdXMsIDkwLCAwLjI1KQ0KICAgIHJlbmRlcmVyLmNpcmNsZSh4IC0gcmFkaXVzICsgdywgeSAtIHJhZGl1cyArIGgsIHIsIGcsIGIsIGEsIHJhZGl1cywgMCwgMC4yNSkNCiAgICByZW5kZXJlci5jaXJjbGUoeCArIHJhZGl1cywgeSAtIHJhZGl1cyArIGgsIHIsIGcsIGIsIGEsIHJhZGl1cywgLTkwLCAwLjI1KQ0KZW5kDQoNCnJlY19vdXRsaW5lID0gZnVuY3Rpb24oeCwgeSwgdywgaCwgcmFkaXVzLCB0aGlja25lc3MsIGNvbG9yKQ0KICAgIHJhZGl1cyA9IG1hdGgubWluKHcvMiwgaC8yLCByYWRpdXMpDQogICAgbG9jYWwgciwgZywgYiwgYSA9IHVucGFjayhjb2xvcikNCiAgICBpZiByYWRpdXMgPT0gMSB0aGVuDQogICAgICAgIHJlbmRlcmVyLnJlY3RhbmdsZSh4LCB5LCB3LCB0aGlja25lc3MsIHIsIGcsIGIsIGEpDQogICAgICAgIHJlbmRlcmVyLnJlY3RhbmdsZSh4LCB5ICsgaCAtIHRoaWNrbmVzcywgdyAsIHRoaWNrbmVzcywgciwgZywgYiwgYSkNCiAgICBlbHNlDQogICAgICAgIHJlbmRlcmVyLnJlY3RhbmdsZSh4ICsgcmFkaXVzLCB5LCB3IC0gcmFkaXVzKjIsIHRoaWNrbmVzcywgciwgZywgYiwgYSkNCiAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHggKyByYWRpdXMsIHkgKyBoIC0gdGhpY2tuZXNzLCB3IC0gcmFkaXVzKjIsIHRoaWNrbmVzcywgciwgZywgYiwgYSkNCiAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHgsIHkgKyByYWRpdXMsIHRoaWNrbmVzcywgaCAtIHJhZGl1cyoyLCByLCBnLCBiLCBhKQ0KICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUoeCArIHcgLSB0aGlja25lc3MsIHkgKyByYWRpdXMsIHRoaWNrbmVzcywgaCAtIHJhZGl1cyoyLCByLCBnLCBiLCBhKQ0KICAgICAgICByZW5kZXJlci5jaXJjbGVfb3V0bGluZSh4ICsgcmFkaXVzLCB5ICsgcmFkaXVzLCByLCBnLCBiLCBhLCByYWRpdXMsIDE4MCwgMC4yNSwgdGhpY2tuZXNzKQ0KICAgICAgICByZW5kZXJlci5jaXJjbGVfb3V0bGluZSh4ICsgcmFkaXVzLCB5ICsgaCAtIHJhZGl1cywgciwgZywgYiwgYSwgcmFkaXVzLCA5MCwgMC4yNSwgdGhpY2tuZXNzKQ0KICAgICAgICByZW5kZXJlci5jaXJjbGVfb3V0bGluZSh4ICsgdyAtIHJhZGl1cywgeSArIHJhZGl1cywgciwgZywgYiwgYSwgcmFkaXVzLCAtOTAsIDAuMjUsIHRoaWNrbmVzcykNCiAgICAgICAgcmVuZGVyZXIuY2lyY2xlX291dGxpbmUoeCArIHcgLSByYWRpdXMsIHkgKyBoIC0gcmFkaXVzLCByLCBnLCBiLCBhLCByYWRpdXMsIDAsIDAuMjUsIHRoaWNrbmVzcykNCiAgICBlbmQNCmVuZA0KDQpsb2NhbCBnbG93X21vZHVsZSA9IGZ1bmN0aW9uKHgsIHksIHcsIGgsIHdpZHRoLCByb3VuZGluZywgYWNjZW50LCBhY2NlbnRfaW5uZXIpDQogICAgbG9jYWwgdGhpY2tuZXNzID0gMQ0KICAgIGxvY2FsIE9mZnNldCA9IDENCiAgICBsb2NhbCByLCBnLCBiLCBhID0gdW5wYWNrKGFjY2VudCkNCiAgICBpZiBhY2NlbnRfaW5uZXIgdGhlbg0KICAgICAgICByZWMoeCwgeSwgdywgaCArIDEsIHJvdW5kaW5nLCBhY2NlbnRfaW5uZXIpDQogICAgZW5kDQogICAgZm9yIGsgPSAwLCB3aWR0aCBkbw0KICAgICAgICBpZiBhICogKGsvd2lkdGgpXigxKSA+IDUgdGhlbg0KICAgICAgICAgICAgbG9jYWwgYWNjZW50ID0ge3IsIGcsIGIsIGEgKiAoay93aWR0aCleKDIpfQ0KICAgICAgICAgICAgcmVjX291dGxpbmUoeCArIChrIC0gd2lkdGggLSBPZmZzZXQpKnRoaWNrbmVzcywgeSArIChrIC0gd2lkdGggLSBPZmZzZXQpICogdGhpY2tuZXNzLCB3IC0gKGsgLSB3aWR0aCAtIE9mZnNldCkqdGhpY2tuZXNzKjIsIGggKyAxIC0gKGsgLSB3aWR0aCAtIE9mZnNldCkqdGhpY2tuZXNzKjIsIHJvdW5kaW5nICsgdGhpY2tuZXNzICogKHdpZHRoIC0gayArIE9mZnNldCksIHRoaWNrbmVzcywgYWNjZW50KQ0KICAgICAgICBlbmQNCiAgICBlbmQNCmVuZA0KDQotLSBBTklNIE9OIExPQUQNCmxvY2FsIHkgPSAwDQpsb2NhbCBhbHBoYSA9IDANCmxvY2FsIHN0YXJ0dXBfYW5pbSA9IHRydWUNCmxvY2FsIGNodWogPSB0cnVlDQpsb2NhbCBzaG93X3RleHQgPSBmYWxzZQ0KDQoNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ3BhaW50X3VpJywgZnVuY3Rpb24oKQ0KICAgIGxvY2FsIHNjcmVlbiA9IHZlY3RvcihjbGllbnQuc2NyZWVuX3NpemUoKSkNCiAgICBsb2NhbCBzaXplID0gdmVjdG9yKHNjcmVlbi54LCBzY3JlZW4ueSkNCg0KICAgIGlmIHN0YXJ0dXBfYW5pbSA9PSB0cnVlIHRoZW4NCiAgICAgICAgbG9jYWwgc3RhcnQsIGVuID0gezE4NCwgMTg0LCAxODQsIGFscGhhfSwgezYyLCA2MiwgNjIsIDEwMH0NCiAgICAgICAgbG9jYWwgdGV4dCA9ICJ3ZWxjb21lIGJhY2shIg0KICAgICAgICBsb2NhbCByb3RhdGlvbiA9IGxlcnAoMCwgMzYwLCBnbG9iYWxzLnJlYWx0aW1lKCkgJSAxKQ0KICAgICAgICBpZiBjaHVqID09IHRydWUgdGhlbg0KICAgICAgICBhbHBoYSA9IGxlcnAoYWxwaGEsIDI1NSwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDI0KQ0KICAgICAgICBlbmQNCgkgICAgcmVuZGVyZXIuYmx1cigwLDAsc2l6ZS54LCBzaXplLnkpDQogICAgICAgIA0KICAgICAgICByZW5kZXJlci50ZXh0KHNjcmVlbi54LzIsIHNjcmVlbi55LzIgKzUwLCAyNTUsIDI1NSwgMjU1LCBhbHBoYSwgJ2MnLCAwLCB0ZXh0KQ0KICAgICAgICBpZiBhbHBoYSA+IDIxMCB0aGVuDQogICAgICAgICAgICBpZiBjaHVqID09IHRydWUgdGhlbg0KICAgICAgICAgICAgICAgIHkgPSBsZXJwKHksIDE1MCwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDI0KQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgICAgICBpZiB5ID4gMTQ5IHRoZW4NCiAgICAgICAgICAgIGNodWogPSBmYWxzZQ0KICAgICAgICAgICAgYWxwaGEgPSBsZXJwKGFscGhhLCAwLCBnbG9iYWxzLmZyYW1ldGltZSgpICogMjQpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIGFscGhhIDwgMSB0aGVuDQogICAgICAgICAgICAgICAgc3RhcnR1cF9hbmltID0gZmFsc2UNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICAgICAgaWYgc2hvd190ZXh0ID09IHRydWUgdGhlbg0KICAgICAgICAgICAgcmVuZGVyZXIudGV4dChzY3JlZW4ueC8yLCBzY3JlZW4ueSAtIHkvMiArIDY1LCAxODQsIDE4NCwgMTg0LCBhbHBoYSwgJ2MnLCAwLCAnJykNCiAgICAgICAgZW5kDQogICAgZW5kDQplbmQpDQoNCmxvY2FsIHJlZiA9IA0Kew0KICAgIGFudGlhaW0gPSB7DQogICAgICAgIGFudGlfYWltID0gdWkubXVsdGlSZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJFbmFibGVkIiksDQogICAgICAgIHBpdGNoID0gdWkubXVsdGlSZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJQaXRjaCIpLA0KICAgICAgICB5YXcgPSB7dWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiWWF3Iil9LA0KICAgICAgICB5YXdfYmFzZSA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyBCYXNlIiksDQogICAgICAgIGppdHRlciA9IHsgdWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiWWF3IGppdHRlciIpIH0sDQogICAgICAgIGJvZHlfeWF3ID0geyB1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJCb2R5IHlhdyIpIH0sDQogICAgICAgIGZzX2JvZHlfeWF3ID0gdWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRnJlZXN0YW5kaW5nIGJvZHkgeWF3IiksDQogICAgICAgIHJvbGxzbGlkZXIgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJSb2xsIiksDQogICAgICAgIHNsb3dfbW90aW9uID0geyB1aS5yZWZlcmVuY2UoIkFBIiwgIk90aGVyIiwgIlNsb3cgbW90aW9uIikgfSwNCgkJZnJlZXN0YW5kLCBmcmVlc3RhbmRrZXkgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJGcmVlc3RhbmRpbmciKSwNCgkJZWRnZXlhdyA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkVkZ2UgeWF3IiksDQoJCWZha2VsYWdsaW1pdCA9IHVpLm11bHRpUmVmZXJlbmNlKCJBQSIsIkZha2UgbGFnIiwgIkxpbWl0IiksDQoJCWZha2VsYWd2YXJpYW5jZSA9IHVpLm11bHRpUmVmZXJlbmNlKCJBQSIsIkZha2UgbGFnIiwgIlZhcmlhbmNlIiksDQogICAgICAgIGZha2VsYWdhbW91bnQgPSB1aS5tdWx0aVJlZmVyZW5jZSgiQUEiLCJGYWtlIGxhZyIsICJBbW91bnQiKSwNCiAgICAgICAgZmFrZWxhZ2VuYWJsZWQgPSB1aS5tdWx0aVJlZmVyZW5jZSgiQUEiLCJGYWtlIGxhZyIsICJFbmFibGVkIiksDQogICAgICAgIGxlZ21vdmVtZW50ID0gdWkubXVsdGlSZWZlcmVuY2UoIkFBIiwiT3RoZXIiLCAiTGVnIG1vdmVtZW50IiksDQogICAgICAgIGZha2VwZWVrID0gdWkubXVsdGlSZWZlcmVuY2UoIkFBIiwiT3RoZXIiLCAiRmFrZSBwZWVrIiksDQogICAgICAgIG9uc2hvdGFhID0gdWkubXVsdGlSZWZlcmVuY2UoIkFBIiwiT3RoZXIiLCAiT24gc2hvdCBhbnRpLWFpbSIpLA0KICAgIH0NCn0NCg0Kc3BhY2UyNDEgPSB1aS5uZXdfbGFiZWwoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIiAiKQ0KDQpsb2NhbCBsYWJlbF90YWIgPSB7DQpuYW1lID0gdWkubmV3X2xhYmVsKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICIgICAgICAgICAgICAgICAgICAgbWVnYW1peCBhbnRpLWFpbSIpLA0KbGFiZWxsaW5lID0gdWkubmV3X2xhYmVsKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICItLS0tLS0tLS0tLS0tLS0tLS0tLXwiKSwNCn0NCg0KY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygicGFpbnRfdWkiLCBmdW5jdGlvbigpDQogICAgaWYgdWkuaXNfbWVudV9vcGVuKCkgdGhlbg0KICAgICAgICB1aS5zZXQobGFiZWxfdGFiLm5hbWUsICBhbmltYXRlX3RleHQoZ2xvYmFscy5jdXJ0aW1lKCkgKiAxLjUsICJNRUdBTUlYIEJMRVNTIiwgMTk0LDE0MiwyMjAsMjAwLDE2NSwxNDgsMTY1LDE1MCkpDQogICAgICAgIHVpLnNldChsYWJlbF90YWIubGFiZWxsaW5lLCAgYW5pbWF0ZV90ZXh0KGdsb2JhbHMuY3VydGltZSgpICogMS41LCAiLS0tLS0tLS0tLS0tLS0tLS0tLS18IiwgMjU1LDI1NSwyNTUsMTUwLDE5NCwxNDIsMjIwLDApKQ0KICAgIGVuZA0KZW5kKQ0KDQp1aXN0YXRlID0gNw0KVUlfTGFiZWxfRW1wdHkgPSB1aS5uZXdfbGFiZWwoIkFBIiwgIkZha2UgbGFnIiwgIiAiKSANCg0KVUlfQnV0dG9uX0JhY2sgPSB1aS5uZXdfYnV0dG9uKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQmFjayIsIGZ1bmN0aW9uKCkNCiAgICB1aS5zZXRfdmlzaWJsZShVSV9CdXR0b25fQmFjaywgZmFsc2UpDQogICAgdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX1Zpc3VhbHMsIHRydWUpDQogICAgdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX0FBLCB0cnVlKQ0KCXVpLnNldF92aXNpYmxlKFVJX0J1dHRvbl9Db25maWdzLCB0cnVlKQ0KICAgIHVpLnNldF92aXNpYmxlKFVJX0J1dHRvbl9SYWdlYm90LCB0cnVlKQ0KICAgIHVpLnNldF92aXNpYmxlKFVJX0J1dHRvbl9BQU1JU0MsIHRydWUpDQoJdWlzdGF0ZSA9IDcNCmVuZCkNCg0KVUlfQnV0dG9uX0FBID0gdWkubmV3X2J1dHRvbigiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIuKZlSAgQW50aS1BaW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiwgZnVuY3Rpb24oKQ0KICAgIHVpLnNldF92aXNpYmxlKFVJX0J1dHRvbl9CYWNrLCB0cnVlKQ0KICAgIHVpLnNldF92aXNpYmxlKFVJX0J1dHRvbl9WaXN1YWxzLCBmYWxzZSkNCiAgICB1aS5zZXRfdmlzaWJsZShVSV9CdXR0b25fQUEsIGZhbHNlKQ0KCXVpLnNldF92aXNpYmxlKFVJX0J1dHRvbl9Db25maWdzLCBmYWxzZSkNCgl1aS5zZXRfdmlzaWJsZShVSV9CdXR0b25fUmFnZWJvdCwgZmFsc2UpDQogICAgdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX0FBTUlTQywgZmFsc2UpDQoJdWlzdGF0ZSA9IDENCmVuZCkNCg0KdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX0JhY2ssIGZhbHNlKQ0KVUlfQnV0dG9uX0FBTUlTQyA9IHVpLm5ld19idXR0b24oIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICLimpLvuI4gIEFudGktQWltcyBNaXNjICAgICAgICAgICAgICAgICAgICAgICAgICAgICIsIGZ1bmN0aW9uKCkNCiAgICB1aS5zZXRfdmlzaWJsZShVSV9CdXR0b25fQmFjaywgdHJ1ZSkNCiAgICB1aS5zZXRfdmlzaWJsZShVSV9CdXR0b25fVmlzdWFscywgZmFsc2UpDQogICAgdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX0FBLCBmYWxzZSkNCgl1aS5zZXRfdmlzaWJsZShVSV9CdXR0b25fQ29uZmlncywgZmFsc2UpDQoJdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX1JhZ2Vib3QsIGZhbHNlKQ0KICAgIHVpLnNldF92aXNpYmxlKFVJX0J1dHRvbl9BQU1JU0MsIGZhbHNlKQ0KCXVpc3RhdGUgPSA2DQplbmQpDQoNCnVpLnNldF92aXNpYmxlKFVJX0J1dHRvbl9CYWNrLCBmYWxzZSkNClVJX0J1dHRvbl9SYWdlYm90ID0gdWkubmV3X2J1dHRvbigiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIuKYoO+4jiAgUmFnZWJvdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLCBmdW5jdGlvbigpDQogICAgdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX0JhY2ssIHRydWUpDQogICAgdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX1Zpc3VhbHMsIGZhbHNlKQ0KICAgIHVpLnNldF92aXNpYmxlKFVJX0J1dHRvbl9BQSwgZmFsc2UpDQoJdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX0NvbmZpZ3MsIGZhbHNlKQ0KCXVpLnNldF92aXNpYmxlKFVJX0J1dHRvbl9SYWdlYm90LCBmYWxzZSkNCiAgICB1aS5zZXRfdmlzaWJsZShVSV9CdXR0b25fQUFNSVNDLCBmYWxzZSkNCgl1aXN0YXRlID0gMg0KZW5kKQ0KDQpVSV9CdXR0b25fVmlzdWFscyA9IHVpLm5ld19idXR0b24oIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICLimLwgIFZpc3VhbHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLCBmdW5jdGlvbigpDQogICAgdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX0JhY2ssIHRydWUpDQogICAgdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX1Zpc3VhbHMsIGZhbHNlKQ0KICAgIHVpLnNldF92aXNpYmxlKFVJX0J1dHRvbl9BQSwgZmFsc2UpDQoJdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX0NvbmZpZ3MsIGZhbHNlKQ0KCXVpLnNldF92aXNpYmxlKFVJX0J1dHRvbl9SYWdlYm90LCBmYWxzZSkNCiAgICB1aS5zZXRfdmlzaWJsZShVSV9CdXR0b25fQUFNSVNDLCBmYWxzZSkNCgl1aXN0YXRlID0gMw0KZW5kKQ0KDQpVSV9CdXR0b25fQ29uZmlncyA9IHVpLm5ld19idXR0b24oIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICLinIkgIENvbmZpZ3MgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLCBmdW5jdGlvbigpDQogICAgdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX0JhY2ssIHRydWUpDQogICAgdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX1Zpc3VhbHMsIGZhbHNlKQ0KICAgIHVpLnNldF92aXNpYmxlKFVJX0J1dHRvbl9BQSwgZmFsc2UpDQoJdWkuc2V0X3Zpc2libGUoVUlfQnV0dG9uX0NvbmZpZ3MsIGZhbHNlKQ0KCXVpLnNldF92aXNpYmxlKFVJX0J1dHRvbl9SYWdlYm90LCBmYWxzZSkNCiAgICB1aS5zZXRfdmlzaWJsZShVSV9CdXR0b25fQUFNSVNDLCBmYWxzZSkNCgl1aXN0YXRlID0gNQ0KZW5kKQ0KDQpsb2NhbCBwcmVzZXRfc2VsZWN0b3IgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIlByZXNldCIsIHsiQ2xhc3NpYyBKaXR0ZXIgKGZvciAyeDIgdG91cm5hbWVudHMpIiwgIkRlbGF5ZWQgSml0dGVyIiwgIkNvbmRpdGlvbmFsIn0pDQpsb2NhbCBzdGF0ZV9zZWxlY3RvciA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiU3RhdGUiLCB7IlN0YW5kaW5nIiwgIk1vdmluZyIsICJTbG93IFdhbGtpbmciLCAiQ3JvdWNoaW5nIiwgIkluIEFpciIsICJJbiBBaXIgJiBDcm91Y2hpbmciLCAiRmFrZSBMYWcifSkNCmxvY2FsIGFudGlhaW1fdGFiID0gew0KIENyb3VjaGluZyA9IHsNCiAgICBwaXRjaCA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiUGl0Y2hcbmMiLCB7Ik9mZiIsICJEb3duIiwgIlVwIiwgIlJhbmRvbSIsICJDdXN0b20ifSksDQogICAgcGl0Y2hfc2xpZGVyID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQ3VzdG9tIHBpdGNoXG5jIiwgLTg5LCA4OSwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGF0X3RhcmdldHMgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyBCYXNlXG5jIiwgeyJPZmYiLCAiQmFja3dhcmQiLCAiQXQgVGFyZ2V0In0pLA0KICAgIGxlZnRfeWF3ID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiTGVmdCBZYXcgQWRkXG5jIiwgLTE4MCwgMTgwLCAwLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgcmlnaHRfeWF3ID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiUmlnaHQgWWF3IEFkZFxuYyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGppdHRlcl9tb2RlID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJNb2RpZmllclxuYyIsIHsiQ2VudGVyIiwgIk9mZnNldCIsICJSYW5kb20iLCAiMyBXYXkifSksDQogICAgaml0dGVyX2Ftb3VudCA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIk1vZGlmaWVyIEFtb3VudFxuYyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgIiAiLCAxLCB7IH0pLA0KICAgIGxieSA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQm9keSB5YXdcbmMiLCB7Ik9mZiIsICJKaXR0ZXIiLCAibWVnYW1peCIsICJEZWxheWVkIiwgIlN0YXRpYyJ9KSwNCiAgICBsYnlzaWRlID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQm9keSBZYXcgTGltaXRcbmMiLCAtMTgwLCAxODAsIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICBsYnlzcGVlZCA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkRlbGF5ZWQgU3BlZWRcbmMiLCAxLCAyMCwgMTIsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICBkZWZlbnNpdmUgPSB7DQogICAgYWEgPSB1aS5uZXdfY2hlY2tib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkRlZmVuc2l2ZSBBQVxuYyIpLA0KICAgIHBpdGNoID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJEZWZlbnNpdmUgUGl0Y2hcbmMiLCB7Ik5vbmUiLCAiRG93biIsICJVcCIsICJSYW5kb20iLCAiUEFLRVRBIiwgIkN1c3RvbSJ9KSwNCiAgICBhX3BpdGNoID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQSBQaXRjaCBBZGRcbmMiLCAtODksIDg5LCAwLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgYl9waXRjaCA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkIgUGl0Y2ggQWRkXG5jIiwgLTg5LCA4OSwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIHlhdyA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRGVmZW5zaXZlIFlhd1xuYyIsIHsiTm9uZSIsICJTcGluYm90IiwgIlNpZGV3YXlzIiwgIk9wcG9zaXRlIiwgIk9wcG9zaXRlIEppdHRlciIsICJSYW5kb20iLCAiMy1XYXkiLCAiNS1XYXkiLCAiQ3VzdG9tIn0pLA0KICAgIGFfeWF3ID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQSBZYXcgQWRkXG5jIiwgLTE4MCwgMTgwLCAwLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgYl95YXcgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJCIFlhdyBBZGRcbmMiLCAtMTgwLCAxODAsIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiB9LA0KIH0sDQogU3RhbmRpbmcgPSB7DQogICAgcGl0Y2ggPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIlBpdGNoXG5zIiwgeyJPZmYiLCAiRG93biIsICJVcCIsICJSYW5kb20iLCAiQ3VzdG9tIn0pLA0KICAgIHBpdGNoX3NsaWRlciA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkN1c3RvbSBwaXRjaFxucyIsIC04OSwgODksIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICBhdF90YXJnZXRzID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJZYXcgQmFzZVxucyIsIHsiT2ZmIiwgIkJhY2t3YXJkIiwgIkF0IFRhcmdldCJ9KSwNCiAgICBsZWZ0X3lhdyA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkxlZnQgWWF3IEFkZFxucyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIHJpZ2h0X3lhdyA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIlJpZ2h0IFlhdyBBZGRcbnMiLCAtMTgwLCAxODAsIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICBqaXR0ZXJfbW9kZSA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiTW9kaWZpZXJcbnMiLCB7IkNlbnRlciIsICJPZmZzZXQiLCAiUmFuZG9tIiwgIjMgV2F5In0pLA0KICAgIGppdHRlcl9hbW91bnQgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJNb2RpZmllciBBbW91bnRcbnMiLCAtMTgwLCAxODAsIDAsIHRydWUsICIgIiwgMSwgeyB9KSwNCiAgICBsYnkgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkJvZHkgeWF3XG5zIiwgeyJPZmYiLCAiSml0dGVyIiwgIm1lZ2FtaXgiLCAiRGVsYXllZCIsICJTdGF0aWMifSksDQogICAgbGJ5c2lkZSA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkJvZHkgWWF3IExpbWl0XG5zIiwgLTE4MCwgMTgwLCAwLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgbGJ5c3BlZWQgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJEZWxheWVkIFNwZWVkXG5zIiwgMSwgMjAsIDEyLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgZGVmZW5zaXZlID0gew0KICAgIGFhID0gdWkubmV3X2NoZWNrYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJEZWZlbnNpdmUgQUFcbnMiKSwNCiAgICBwaXRjaCA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRGVmZW5zaXZlIFBpdGNoXG5zIiwgeyJOb25lIiwgIkRvd24iLCAiVXAiLCAiUmFuZG9tIiwgIlBBS0VUQSIsICJDdXN0b20ifSksDQogICAgYV9waXRjaCA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkEgUGl0Y2ggQWRkXG5zIiwgLTg5LCA4OSwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGJfcGl0Y2ggPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJCIFBpdGNoIEFkZFxucyIsIC04OSwgODksIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICB5YXcgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkRlZmVuc2l2ZSBZYXdcbnMiLCB7Ik5vbmUiLCAiU3BpbmJvdCIsICJTaWRld2F5cyIsICJPcHBvc2l0ZSIsICJPcHBvc2l0ZSBKaXR0ZXIiLCAiUmFuZG9tIiwgIjMtV2F5IiwgIjUtV2F5IiwgIkN1c3RvbSJ9KSwNCiAgICBhX3lhdyA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkEgWWF3IEFkZFxucyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGJfeWF3ID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQiBZYXcgQWRkXG5zIiwgLTE4MCwgMTgwLCAwLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgfSwNCiAgICB9LA0KIFNsb3d3YWxraW5nID0gew0KICAgIHBpdGNoID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJQaXRjaFxuc3ciLCB7Ik9mZiIsICJEb3duIiwgIlVwIiwgIlJhbmRvbSIsICJDdXN0b20ifSksDQogICAgcGl0Y2hfc2xpZGVyID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQ3VzdG9tIHBpdGNoXG5zdyIsIC04OSwgODksIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICBhdF90YXJnZXRzID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJZYXcgQmFzZVxuc3ciLCB7Ik9mZiIsICJCYWNrd2FyZCIsICJBdCBUYXJnZXQifSksDQogICAgbGVmdF95YXcgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJMZWZ0IFlhdyBBZGRcbnN3IiwgLTE4MCwgMTgwLCAwLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgcmlnaHRfeWF3ID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiUmlnaHQgWWF3IEFkZFxuc3ciLCAtMTgwLCAxODAsIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICBqaXR0ZXJfbW9kZSA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiTW9kaWZpZXJcbnN3IiwgeyJDZW50ZXIiLCAiT2Zmc2V0IiwgIlJhbmRvbSIsICIzIFdheSJ9KSwNCiAgICBqaXR0ZXJfYW1vdW50ID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiTW9kaWZpZXIgQW1vdW50XG5zdyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgIiAiLCAxLCB7IH0pLA0KICAgIGxieSA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQm9keSB5YXdcbnN3IiwgeyJPZmYiLCAiSml0dGVyIiwgIm1lZ2FtaXgiLCAiRGVsYXllZCIsICJTdGF0aWMifSksDQogICAgbGJ5c2lkZSA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkJvZHkgWWF3IExpbWl0XG5zdyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGxieXNwZWVkID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRGVsYXllZCBTcGVlZFxuc3ciLCAxLCAyMCwgMTIsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICBkZWZlbnNpdmUgPSB7DQogICAgYWEgPSB1aS5uZXdfY2hlY2tib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkRlZmVuc2l2ZSBBQVxuc3ciKSwNCiAgICBwaXRjaCA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRGVmZW5zaXZlIFBpdGNoXG5zdyIsIHsiTm9uZSIsICJEb3duIiwgIlVwIiwgIlJhbmRvbSIsICJQQUtFVEEiLCAiQ3VzdG9tIn0pLA0KICAgIGFfcGl0Y2ggPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJBIFBpdGNoIEFkZFxudyIsIC04OSwgODksIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICBiX3BpdGNoID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQiBQaXRjaCBBZGRcbnciLCAtODksIDg5LCAwLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgeWF3ID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJEZWZlbnNpdmUgWWF3XG5zdyIsIHsiTm9uZSIsICJTcGluYm90IiwgIlNpZGV3YXlzIiwgIk9wcG9zaXRlIiwgIk9wcG9zaXRlIEppdHRlciIsICJSYW5kb20iLCAiMy1XYXkiLCAiNS1XYXkiLCAiQ3VzdG9tIn0pLA0KICAgIGFfeWF3ID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQSBZYXcgQWRkXG5zdyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGJfeWF3ID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQiBZYXcgQWRkXG5zdyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIH0sDQogICAgfSwNCiBNb3ZpbmcgPSB7DQogICAgcGl0Y2ggPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIlBpdGNoXG53IiwgeyJPZmYiLCAiRG93biIsICJVcCIsICJSYW5kb20iLCAiQ3VzdG9tIn0pLA0KICAgIHBpdGNoX3NsaWRlciA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkN1c3RvbSBwaXRjaFxudyIsIC04OSwgODksIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICBhdF90YXJnZXRzID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJZYXcgQmFzZVxudyIsIHsiT2ZmIiwgIkJhY2t3YXJkIiwgIkF0IFRhcmdldCJ9KSwNCiAgICBsZWZ0X3lhdyA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkxlZnQgWWF3IEFkZFxudyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIHJpZ2h0X3lhdyA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIlJpZ2h0IFlhdyBBZGRcbnciLCAtMTgwLCAxODAsIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICBqaXR0ZXJfbW9kZSA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiTW9kaWZpZXJcbnciLCB7IkNlbnRlciIsICJPZmZzZXQiLCAiUmFuZG9tIiwgIjMgV2F5In0pLA0KICAgIGppdHRlcl9hbW91bnQgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJNb2RpZmllciBBbW91bnRcbnciLCAtMTgwLCAxODAsIDAsIHRydWUsICIgIiwgMSwgeyB9KSwNCiAgICBsYnkgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkJvZHkgeWF3XG53IiwgeyJPZmYiLCAiSml0dGVyIiwgIm1lZ2FtaXgiLCAiRGVsYXllZCIsICJTdGF0aWMifSksDQogICAgbGJ5c2lkZSA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkJvZHkgWWF3IExpbWl0XG53IiwgLTE4MCwgMTgwLCAwLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgbGJ5c3BlZWQgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJEZWxheWVkIFNwZWVkXG53IiwgMSwgMjAsIDEyLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgZGVmZW5zaXZlID0gew0KICAgIGFhID0gdWkubmV3X2NoZWNrYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJEZWZlbnNpdmUgQUFcbnciKSwNCiAgICBwaXRjaCA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRGVmZW5zaXZlIFBpdGNoXG53IiwgeyJOb25lIiwgIkRvd24iLCAiVXAiLCAiUmFuZG9tIiwgIlBBS0VUQSIsICJDdXN0b20ifSksDQogICAgYV9waXRjaCA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkEgUGl0Y2ggQWRkXG53IiwgLTg5LCA4OSwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGJfcGl0Y2ggPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJCIFBpdGNoIEFkZFxudyIsIC04OSwgODksIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICB5YXcgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkRlZmVuc2l2ZSBZYXdcbnciLCB7Ik5vbmUiLCAiU3BpbmJvdCIsICJTaWRld2F5cyIsICJPcHBvc2l0ZSIsICJPcHBvc2l0ZSBKaXR0ZXIiLCAiUmFuZG9tIiwgIjMtV2F5IiwgIjUtV2F5IiwgIkN1c3RvbSJ9KSwNCiAgICBhX3lhdyA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkEgWWF3IEFkZFxudyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGJfeWF3ID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQiBZYXcgQWRkXG53IiwgLTE4MCwgMTgwLCAwLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgfSwNCiAgICB9LA0KIEluQWlyID0gew0KICAgIHBpdGNoID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJQaXRjaFxuaiIsIHsiT2ZmIiwgIkRvd24iLCAiVXAiLCAiUmFuZG9tIiwgIkN1c3RvbSJ9KSwNCiAgICBwaXRjaF9zbGlkZXIgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJDdXN0b20gcGl0Y2hcbmoiLCAtODksIDg5LCAwLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgYXRfdGFyZ2V0cyA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiWWF3IEJhc2VcbmoiLCB7Ik9mZiIsICJCYWNrd2FyZCIsICJBdCBUYXJnZXQifSksDQogICAgbGVmdF95YXcgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJMZWZ0IFlhdyBBZGRcbmoiLCAtMTgwLCAxODAsIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICByaWdodF95YXcgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJSaWdodCBZYXcgQWRkXG5qIiwgLTE4MCwgMTgwLCAwLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgaml0dGVyX21vZGUgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIk1vZGlmaWVyXG5qIiwgeyJDZW50ZXIiLCAiT2Zmc2V0IiwgIlJhbmRvbSIsICIzIFdheSJ9KSwNCiAgICBqaXR0ZXJfYW1vdW50ID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiTW9kaWZpZXIgQW1vdW50XG5qIiwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiICIsIDEsIHsgfSksDQogICAgbGJ5ID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJCb2R5IHlhd1xuaiIsIHsiT2ZmIiwgIkppdHRlciIsICJtZWdhbWl4IiwgIkRlbGF5ZWQiLCAiU3RhdGljIn0pLA0KICAgIGxieXNpZGUgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJCb2R5IFlhdyBMaW1pdFxuaiIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGxieXNwZWVkID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRGVsYXllZCBTcGVlZCIsIDEsIDIwLCAxMiwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGRlZmVuc2l2ZSA9IHsNCiAgICBhYSA9IHVpLm5ld19jaGVja2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRGVmZW5zaXZlIEFBXG5qIiksDQogICAgcGl0Y2ggPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkRlZmVuc2l2ZSBQaXRjaFxuaiIsIHsiTm9uZSIsICJEb3duIiwgIlVwIiwgIlJhbmRvbSIsICJQQUtFVEEiLCAiQ3VzdG9tIn0pLA0KICAgIGFfcGl0Y2ggPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJBIFBpdGNoIEFkZFxuaiIsIC04OSwgODksIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICBiX3BpdGNoID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQiBQaXRjaCBBZGRcbmoiLCAtODksIDg5LCAwLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgeWF3ID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJEZWZlbnNpdmUgWWF3XG5qIiwgeyJOb25lIiwgIlNwaW5ib3QiLCAiU2lkZXdheXMiLCAiT3Bwb3NpdGUiLCAiT3Bwb3NpdGUgSml0dGVyIiwgIlJhbmRvbSIsICIzLVdheSIsICI1LVdheSIsICJDdXN0b20ifSksDQogICAgYV95YXcgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJBIFlhdyBBZGRcbmoiLCAtMTgwLCAxODAsIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICBiX3lhdyA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkIgWWF3IEFkZFxuaiIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIH0sDQogICAgfSwNCiBBaXJjcm91Y2hpbmcgPSB7DQogICAgcGl0Y2ggPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIlBpdGNoXG5hYyIsIHsiT2ZmIiwgIkRvd24iLCAiVXAiLCAiUmFuZG9tIiwgIkN1c3RvbSJ9KSwNCiAgICBwaXRjaF9zbGlkZXIgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJDdXN0b20gcGl0Y2hcbmFjIiwgLTg5LCA4OSwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGF0X3RhcmdldHMgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyBCYXNlXG5hYyIsIHsiT2ZmIiwgIkJhY2t3YXJkIiwgIkF0IFRhcmdldCJ9KSwNCiAgICBsZWZ0X3lhdyA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkxlZnQgWWF3IEFkZFxuYWMiLCAtMTgwLCAxODAsIDAsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICByaWdodF95YXcgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJSaWdodCBZYXcgQWRkXG5hYyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGppdHRlcl9tb2RlID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJNb2RpZmllclxuYWMiLCB7IkNlbnRlciIsICJPZmZzZXQiLCAiUmFuZG9tIiwgIjMgV2F5In0pLA0KICAgIGppdHRlcl9hbW91bnQgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJNb2RpZmllciBBbW91bnRcbmFjIiwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiICIsIDEsIHsgfSksDQogICAgbGJ5ID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJCb2R5IHlhd1xuYWMiLCB7Ik9mZiIsICJKaXR0ZXIiLCAibWVnYW1peCIsICJEZWxheWVkIiwgIlN0YXRpYyJ9KSwNCiAgICBsYnlzaWRlID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQm9keSBZYXcgTGltaXRcbmFjIiwgLTE4MCwgMTgwLCAwLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgbGJ5c3BlZWQgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJEZWxheWVkIFNwZWVkIiwgMSwgMjAsIDEyLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgZGVmZW5zaXZlID0gew0KICAgIGFhID0gdWkubmV3X2NoZWNrYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJEZWZlbnNpdmUgQUFcbmFjIiksDQogICAgcGl0Y2ggPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkRlZmVuc2l2ZSBQaXRjaFxuYWMiLCB7Ik5vbmUiLCAiRG93biIsICJVcCIsICJSYW5kb20iLCAiUEFLRVRBIiwgIkN1c3RvbSJ9KSwNCiAgICBhX3BpdGNoID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQSBQaXRjaCBBZGRcbmFjIiwgLTg5LCA4OSwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGJfcGl0Y2ggPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJCIFBpdGNoIEFkZFxuYWMiLCAtODksIDg5LCAwLCB0cnVlLCBuaWwsIDEsIHsgfSksDQogICAgeWF3ID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJEZWZlbnNpdmUgWWF3XG5hYyIsIHsiTm9uZSIsICJTcGluYm90IiwgIlNpZGV3YXlzIiwgIk9wcG9zaXRlIiwgIk9wcG9zaXRlIEppdHRlciIsICJSYW5kb20iLCAiMy1XYXkiLCAiNS1XYXkiLCAiQ3VzdG9tIn0pLA0KICAgIGFfeWF3ID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQSBZYXcgQWRkXG5hYyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGJfeWF3ID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQiBZYXcgQWRkXG5hYyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIH0sDQogICAgfSwNCiBGYWtlbGFnID0gew0KICAgIHBpdGNoID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJQaXRjaFxubGFnIiwgeyJPZmYiLCAiRG93biIsICJVcCIsICJSYW5kb20iLCAiQ3VzdG9tIn0pLA0KICAgIHBpdGNoX3NsaWRlciA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkN1c3RvbSBwaXRjaFxubGFnIiwgLTg5LCA4OSwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGF0X3RhcmdldHMgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyBCYXNlXG5sYWciLCB7Ik9mZiIsICJCYWNrd2FyZCIsICJBdCBUYXJnZXQifSksDQogICAgbGVmdF95YXcgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJMZWZ0IFlhdyBBZGRcbmxhZyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIHJpZ2h0X3lhdyA9IHVpLm5ld19zbGlkZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIlJpZ2h0IFlhdyBBZGRcbmxhZyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGppdHRlcl9tb2RlID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJNb2RpZmllclxubGFnIiwgeyJDZW50ZXIiLCAiT2Zmc2V0IiwgIlJhbmRvbSIsICIzIFdheSJ9KSwNCiAgICBqaXR0ZXJfYW1vdW50ID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiTW9kaWZpZXIgQW1vdW50XG5sYWciLCAtMTgwLCAxODAsIDAsIHRydWUsICIgIiwgMSwgeyB9KSwNCiAgICBsYnkgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgIkJvZHkgeWF3XG5sYWciLCB7Ik9mZiIsICJKaXR0ZXIiLCAibWVnYW1peCIsICJEZWxheWVkIiwgIlN0YXRpYyJ9KSwNCiAgICBsYnlzaWRlID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQm9keSBZYXcgTGltaXRcbmxhZyIsIC0xODAsIDE4MCwgMCwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIGxieXNwZWVkID0gdWkubmV3X3NsaWRlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRGVsYXllZCBTcGVlZCIsIDEsIDIwLCAxMiwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KICAgIH0sDQogZmVhdHVyZV90YWIgPSB7DQogICAgZXh0cmFfb3B0aW9uID0gdWkubmV3X211bHRpc2VsZWN0KCJBQSIsIkZha2UgTGFnIiwgIuKMqO+4jiBFeHRyYSBPcHRpb25zKEV4cGxvaXRzKSIsICLim6ggRGVmZW5zaXZlIEFsdGVybmF0aXZlIiwgIuKYgSBGYWtlIExhZyBBbHRlcm5hdGl2ZSIpLA0KICAgIGZha2VsYWdfbW9kZSA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJGYWtlIExhZyIsICJGYWtlIExhZyBMb2dpY3MiLCAiRHluYW1pYyIsICJNYXhpbXVtIiwgIkZsdWN0dWF0ZSIsICJTd2l0Y2giLCAiUmFuZG9tIiksDQogICAgZmFrZWxhZ192YXJvdXMgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkZha2UgTGFnIiwgIkZha2UgTGFnIFZhcmlhbmNlIiwgMSwgMTAwLCAxLCB0cnVlLCAiwrAiLCAxLCB7IH0pLA0KICAgIGZha2VsYWdfZmlyc3QgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIkZha2UgTGFnIiwgIkZha2UgTGFnIEEgQWRkIiwgMSwgMTQsIDEsIHRydWUsIG5pbCwgMSwgeyB9KSwNCiAgICBmYWtlbGFnX3NlY29uZCA9IHVpLm5ld19zbGlkZXIoIkFBIiwiRmFrZSBMYWciLCAiRmFrZSBMYWcgQiBBZGQiLCAxLCAxNCwgMSwgdHJ1ZSwgbmlsLCAxLCB7IH0pLA0KDQogICAgZm9yY2VfbGMgPSB1aS5uZXdfbXVsdGlzZWxlY3QoIkFBIiwiT3RoZXIiLCAiRm9yY2UgQnJlYWtpbmcgTEMiLCB7IlN0YW5kaW5nIiwgIk1vdmluZyIsICJTbG93IFdhbGtpbmciLCAiQ3JvdWNoaW5nIiwgIkluIEFpciIsICJJbiBBaXIgJiBDcm91Y2hpbmciLCAiRnJlZXN0YW5kaW5nIiwgIk1hbnVhbHMifSksDQogICAgZGVmZW5zaXZlX21vZGUgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiT3RoZXIiLCAi4puoICBEZWZlbnNpdmUgQWR2YW5jZWQgT3B0aW9ucyIsICLinLcgIE9wdGltaXplZCIsICLiiJ4gQWx0ZXJuYXRpdmUiKSwNCiAgICBtaW5fdGlja19sZWZ0ID0gdWkubmV3X3NsaWRlcigiQUEiLCJPdGhlciIsICJNaW5pbXVtIERlZmVuc2l2ZSBUaWNrIExlZnQiLCAwLCAxNCwgMCwgdHJ1ZSwgInQiLCAxLCB7IH0pLA0KICAgIG1heF90aWNrX2xlZnQgPSB1aS5uZXdfc2xpZGVyKCJBQSIsIk90aGVyIiwgIk1heGltdW0gRGVmZW5zaXZlIFRpY2sgTGVmdCIsIDAsIDE0LCAxNCwgdHJ1ZSwgInQiLCAxLCB7IH0pLA0KICAgIGxhYmVsZGVmID0gdWkubmV3X2xhYmVsKCJBQSIsIk90aGVyIiwgIlxuNDIzMTIzMnRmZHNmcyIpLA0KDQogICAgIH0sDQp9DQoNCmtleWJpbmRzX3RhYiA9IHsNCiAgICBoaWRlc2hvdHMgPSB1aS5uZXdfaG90a2V5KCJBQSIsICJGYWtlIExhZyIsICJIaWRlc2hvdHMiLCBmYWxzZSksDQogICAgc2xvd3dhbGsgPSB1aS5uZXdfaG90a2V5KCJBQSIsICJGYWtlIExhZyIsICJTbG93IFdhbGsiLCBmYWxzZSksDQogICAgZWRnZXlhdyA9IHVpLm5ld19ob3RrZXkoIkFBIiwgIkZha2UgTGFnIiwgIkVkZ2UgeWF3IiwgZmFsc2UpLA0KICAgIGZyZWVzdGFuZCA9IHVpLm5ld19ob3RrZXkoIkFBIiwgIkZha2UgTGFnIiwgIkZyZWVzdGFuZCIsIGZhbHNlKSwNCiAgICBtYW51YWxfbGVmdCA9IHVpLm5ld19ob3RrZXkoIkFBIiwiRmFrZSBMYWciLCJNYW51YWwgbGVmdCIsIGZhbHNlKSwNCiAgICBtYW51YWxfcmlnaHQgPSB1aS5uZXdfaG90a2V5KCJBQSIsIkZha2UgTGFnIiwiTWFudWFsIHJpZ2h0IiwgZmFsc2UpLA0KICAgIG1hbnVhbF9mb3J3YXJkID0gdWkubmV3X2hvdGtleSgiQUEiLCJGYWtlIExhZyIsIk1hbnVhbCBmb3J3YXJkIiwgZmFsc2UpLA0KIH0NCg0KIE1pc2MgPSB7DQogICAgZGlzYWJsZWZsID0gdWkubmV3X211bHRpc2VsZWN0KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJEaXNhYmxlIEZha2UgTGFnIiwgeyJEb3VibGUgVGFwIiwgIkhpZGUgU2hvdHMiLCAiU3RhbmRpbmciLCAiRFQgS25pZmUifSksDQogICAgc2FmZV9oZWFkID0gdWkubmV3X211bHRpc2VsZWN0KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJTYWZlIEhlYWQiLCAiS25pZmUiLCAiVGFzZXIiLCAiSGVpZ2h0IEFkdmFudGFnZSIpLA0KDQogICAgZmxpY2tleCA9IHVpLm5ld19tdWx0aXNlbGVjdCgiQUEiLCAiT3RoZXIiLCAiRmxpY2sgRXhwbG9pdCIsIHsiU3RhbmRpbmciLCAiTW92aW5nIiwgIlNsb3cgV2Fsa2luZyIsICJDcm91Y2hpbmciLCAiSW4gQWlyIiwgIkluIEFpciAmIENyb3VjaGluZyJ9KSwNCiAgICBmbGlja3BpdGNoID0gdWkubmV3X2NvbWJvYm94KCJBQSIsICJPdGhlciIsICJGbGljayBQaXRjaCIsICJaZXJvIiwgIlVwIiwgIkRvd24iLCAiUmFuZG9tIiwgIlBBS0VUQSIsICJTZW1pLVVwIiwgIlNlbWktRG93biIpLA0KICAgIGZsaWNreWF3ID0gdWkubmV3X2NvbWJvYm94KCJBQSIsICJPdGhlciIsICJGbGljayBZYXciLCAiU3RhdGljIiwgIlJhbmRvbSIsICJKaXR0ZXIiKSwNCg0KICAgIGZvcmNlZnNtID0gdWkubmV3X2NoZWNrYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJGb3JjZSBCcmVhayBMQyBGUyBBbmQgTWFudWFsIiksDQogICAgZWRnZWRlZmVuc2l2ZSA9IHVpLm5ld19jaGVja2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRWRnZSBZYXcgV2hlbiBEZWZlbnNpdmUiKSwNCiAgICBub3dhcm11cGFhID0gdWkubmV3X2NoZWNrYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJEaXNhYmxlIGR1cmluZyBXYXJtdXAiKSwNCiAgICBhdm9pZF9iYWNrc3RhYiA9IHVpLm5ld19jaGVja2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQXZvaWQgYmFja3N0YWIiKSwNCiAgICB9DQoNCiBnZW5lcmFsX3RhYiA9IHsNCiAgICBubGR0ID0gdWkubmV3X2NoZWNrYm94KCJBQSIsIkZha2UgbGFnIiwgIk5MIERUIiksDQogICAgYWlyc3RvcCA9IHVpLm5ld19jaGVja2JveCgiQUEiLCJGYWtlIGxhZyIsICJBaXJzdG9wIiksDQogICAgYWlyc3RvcGtleSA9IHVpLm5ld19ob3RrZXkoIkFBIiwiRmFrZSBsYWciLCAiQWlyc3RvcCIsIHRydWUpLA0KICAgIHJlc29sdmVyID0gdWkubmV3X2NoZWNrYm94KCJBQSIsIkZha2UgbGFnIiwgIlJzb2x2ZXIiKSwNCiAgICB0ZWxlcG9ydCA9IHVpLm5ld19jaGVja2JveCgiQUEiLCJGYWtlIGxhZyIsICJBdXRvVGVsZXBvcnQiKSwNCiAgICB0ZWxlcG9ydF9rZXkgPSB1aS5uZXdfaG90a2V5KCJBQSIsICJGYWtlIGxhZyIsICJ0ZWxlcG9ydCIsIHRydWUpLA0KICAgIGxhZ2V4cGxvaXQgPSB1aS5uZXdfY2hlY2tib3goIkFBIiwiRmFrZSBsYWciLCAiQWVyb2JpZyBMYWcgRXhwbG9pdCIpLA0KICAgIGxhZ2V4cGxvaXRfa2V5ID0gdWkubmV3X2hvdGtleSgiQUEiLCAiRmFrZSBsYWciLCAiQWVyb2JpZyIsIHRydWUpLA0KDQogICAgLS0gTWlzYw0KICAgIHRyYXNodGFsayA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiU2hpdCBUYWxrIiwgeyJOb25lIiwgIkVuZ2xpc2giLCAiMSJ9KSwNCg0KIH0NCg0KIHZpc3VhbHNfdGFiID0gew0KICAgIGFuaW1icmVha2VyID0gdWkubmV3X211bHRpc2VsZWN0KCJBQSIsIk90aGVyIiwgIkFuaW1hdGlvbiBGaXggQnJlYWtlciIsIHsiTGFuZGluZyBQaXRjaCIsICJNb3ZlIExlYW4iLCAiU2xpZGUgT24gU2xvdyBXYWxrIiwgIkdyb3VuZCBFYXJ0aHF1YWtlIiwgIkFpciBFYXJ0aHF1YWtlIn0pLA0KICAgIGdyb3VuZGJyZWFrZXIgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiT3RoZXIiLCAiT24gR3JvdW5kIExlZyBCcmVha2VyIiwgIk5vbmUiLCAiQmFja3dhcmRzIiwgIk1vb24gV2FsayIpLA0KICAgIGFpcmJyZWFrZXIgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwiT3RoZXIiLCAiSW4gQWlyIExlZyBCcmVha2VyIiwgIk5vbmUiLCAiRm9yY2UgRmFsbGluZyIsICJNb29uIFdhbGsiKSwNCg0KICAgIGNlbnRlcl9pbmRpY2F0b3JzID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJDcm9zc2hhaXIgaW5kcyIsICJPZmYiLCAiTWVnYW1peCIsICJQYXJhZGlzZSIpLA0KICAgIGNyb3NzaGFpcmFjY2VudCA9IHVpLm5ld19jb2xvcl9waWNrZXIoIkFBIiwiQW50aS1haW1ib3QgYW5nbGVzIiwgImNyb3NzaGFpcmNvbG9yIiwgMjU1LCAxNzAsIDc1KSwNCg0KICAgIGFycm93cyA9IHVpLm5ld19jb21ib2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQXJyb3dzIiwgeyJPZmYiLCAiVFM0IiwgIk1hbnVhbCIsICJtZWdhbWl4In0pLA0KICAgIGFycm93YWNjZW50ID0gdWkubmV3X2NvbG9yX3BpY2tlcigiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiY3Jvc3NoYWlyY29sb3IiKSwNCiAgICBvbnNjb3BlID0gdWkubmV3X2NvbWJvYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJPbiBzY29wZSBhbmltYXRpb24iLCB7Ik9mZiIsICJSaWdodCIsICJCbGVzcyJ9KSwNCiAgICBwYW5lbCA9IHVpLm5ld19jaGVja2JveCgiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRGVidWcgUGFuZWwiKSwNCiAgICBjbGFudGFnID0gdWkubmV3X2NoZWNrYm94KCJBQSIsIkFudGktYWltYm90IGFuZ2xlcyIsICJDbGFudGFnIiksDQoNCiAgICBldmVudGxvZ3MgPSB1aS5uZXdfY2hlY2tib3goIkFBIiwiRmFrZSBsYWciLCAiTG9ncyIpLA0KICAgIGV2ZW50Z2xvdyA9IHVpLm5ld19jaGVja2JveCgiQUEiLCJGYWtlIGxhZyIsICJHbG93IiksDQogICAgZXZlbnRvdXRsaW5lID0gdWkubmV3X2NoZWNrYm94KCJBQSIsIkZha2UgbGFnIiwgIk91dGxpbmUiKSwNCiAgICBldmVudGxvZ3NhY2NlbnQgPSB1aS5uZXdfY29sb3JfcGlja2VyKCJBQSIsIkZha2UgbGFnIiwgIkV2ZW50bG9nIENvbG9yIiwgMjU1LCAxNzAsIDc1KSwNCiAgICBldmVudHMgPSB1aS5uZXdfbXVsdGlzZWxlY3QoIkFBIiwiRmFrZSBsYWciLCAiRmFrZSBsYWciLCAiRGFtYWdlIERlbHQiLCAiQWltZWQgSGl0Ym94IiksDQogICAgZXZlbnRzX3N0eWxlID0gdWkubmV3X211bHRpc2VsZWN0KCJBQSIsIkZha2UgbGFnIiwgIlN0eWxlIiwgIm1lZ2FtaXgiLCAiQ29uc29sZSIpLA0KIH0NCg0KIC0tIENGRw0KbG9jYWwgZGF0YWJhc2VfbmFtZSA9ICJtZWdhbWl4X2NmZyINCmxvY2FsIGRiID0gZGF0YWJhc2UucmVhZChkYXRhYmFzZV9uYW1lKSBvciB7IGNvbmZpZ3MgPSB7fSB9DQpsb2NhbCBjb25maWdfbGlzdCA9IHt9DQpsb2NhbCBiaW5kcyA9IHt9DQpmdW5jdGlvbiB1aS5tdWx0aVJlZmVyZW5jZSh0YWIsIGdyb3VwYm94LCBuYW1lKQ0KICAgIGxvY2FsIHJlZjEsIHJlZjIsIHJlZjMgPSB1aS5yZWZlcmVuY2UodGFiLCBncm91cGJveCwgbmFtZSkNCiAgICByZXR1cm4geyByZWYxLCByZWYyLCByZWYzIH0NCmVuZA0KbG9jYWwgcmVmZXJlbmNlcyA9IHsNCn0NCg0KbG9jYWwgQ29uZmlncyA9IHsgfQ0KbG9jYWwgbWVudSA9IHt9IGRvDQogICAgQ29uZmlncy5JbXBvcnQgPSB1aS5uZXdfYnV0dG9uKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiSW1wb3J0IGZyb20gY2xpcGJvYXJkIiwgZnVuY3Rpb24oKQ0KICAgICAgICBsb2NhbCBzdWNjZXNzLCBjZmcgPSBwY2FsbChqc29uLnBhcnNlLCBjbGlwYm9hcmQuZ2V0KCkpDQoNCiAgICAgICAgaWYgbm90IHN1Y2Nlc3MgdGhlbg0KICAgICAgICAgICAgY2xpZW50LmVycm9yX2xvZygnQXR0ZW1wdCB0byBsb2FkIGFuIGludmFsaWQgY29uZmlnJykNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICBlbmQNCg0KICAgICAgICBmb3IgaSwgdmFsIGluIHBhaXJzKGNmZykgZG8NCiAgICAgICAgICAgIGxvY2FsIHN1Y2Nlc3MgPSB0cnVlDQogICAgICAgICAgICBsb2NhbCByZWYgPSByZWZlcmVuY2VzW2ldDQogICAgICAgICAgICBpZiB0eXBlKHJlZikgPT0gInRhYmxlIiB0aGVuDQogICAgICAgICAgICAgICAgc3VjY2VzcyA9IHBjYWxsKHVpLnNldCwgcmVmWzFdLCB2YWxbMV0pDQogICAgICAgICAgICAgICAgaWYgbm90IHN1Y2Nlc3MgdGhlbiBjbGllbnQuZXJyb3JfbG9nKCJBdHRlbXB0IHRvIGxvYWQgYW4gb3V0ZGF0ZWQgY29uZmlnIikgcmV0dXJuIGVuZA0KICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBwY2FsbCh1aS5zZXQsIHJlZlsyXSwgdmFsWzJdKQ0KICAgICAgICAgICAgICAgIGlmIG5vdCBzdWNjZXNzIHRoZW4gY2xpZW50LmVycm9yX2xvZygiQXR0ZW1wdCB0byBsb2FkIGFuIG91dGRhdGVkIGNvbmZpZyIpIHJldHVybiBlbmQNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBzdWNjZXNzID0gcGNhbGwodWkuc2V0LCByZWYsIHZhbCkNCiAgICAgICAgICAgICAgICBpZiBub3Qgc3VjY2VzcyB0aGVuIGNsaWVudC5lcnJvcl9sb2coIkF0dGVtcHQgdG8gbG9hZCBhbiBvdXRkYXRlZCBjb25maWciKSByZXR1cm4gZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KICAgIENvbmZpZ3MuRXhwb3J0ID0gdWkubmV3X2J1dHRvbigiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkV4cG9ydCB0byBjbGlwYm9hcmQiLCBmdW5jdGlvbigpDQogICAgICAgIGxvY2FsIHRlbXAgPSB7fQ0KDQogICAgICAgIGZvciBpLCByZWYgaW4gcGFpcnMocmVmZXJlbmNlcykgZG8NCiAgICAgICAgICAgIGlmIHR5cGUocmVmKSA9PSAidGFibGUiIHRoZW4NCiAgICAgICAgICAgICAgICB0ZW1wW2ldID0geyB1aS5nZXQocmVmWzFdKSwgdWkuZ2V0KHJlZlsyXSkgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHRlbXBbaV0gPSB1aS5nZXQocmVmKQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KDQogICAgICAgIGNsaXBib2FyZC5zZXQoanNvbi5zdHJpbmdpZnkodGVtcCkpDQogICAgZW5kKQ0KICAgIGxvY2FsIHZpc2libGUgPSB0cnVlDQplbmQNCmZ1bmN0aW9uIGZsYXR0ZW5UYWJsZShzb3VyY2UsIGRlc3RpbmF0aW9uLCBwcmVmaXgpDQogICAgZm9yIGtleSwgdmFsdWUgaW4gcGFpcnMoc291cmNlKSBkbw0KICAgICAgICBsb2NhbCBmdWxsS2V5ID0gcHJlZml4IGFuZCAocHJlZml4IC4uICIuIiAuLiBrZXkpIG9yIGtleQ0KICAgICAgICBpZiB0eXBlKHZhbHVlKSA9PSAidGFibGUiIHRoZW4NCiAgICAgICAgICAgIGZsYXR0ZW5UYWJsZSh2YWx1ZSwgZGVzdGluYXRpb24sIGZ1bGxLZXkpIC0tINCg0LXQutGD0YDRgdC40LLQvdC+INC+0LHRitC10LTQuNC90Y/QtdC8INCy0LvQvtC20LXQvdC90YPRjiDRgtCw0LHQu9C40YbRgw0KICAgICAgICBlbHNlDQogICAgICAgICAgICBkZXN0aW5hdGlvbltmdWxsS2V5XSA9IHZhbHVlIC0tINCU0L7QsdCw0LLQu9GP0LXQvCDQutC70Y7RhyDQuCDQt9C90LDRh9C10L3QuNC1INCyINC/0LvQvtGB0LrRg9GOINGC0LDQsdC70LjRhtGDDQogICAgICAgIGVuZA0KICAgIGVuZA0KZW5kDQpmbGF0dGVuVGFibGUoYW50aWFpbV90YWIsIHJlZmVyZW5jZXMpDQpmbGF0dGVuVGFibGUobGFiZWxfdGFiLCByZWZlcmVuY2VzKQ0KZmxhdHRlblRhYmxlKHZpc3VhbHNfdGFiLCByZWZlcmVuY2VzKQ0KZmxhdHRlblRhYmxlKGdlbmVyYWxfdGFiLCByZWZlcmVuY2VzKQ0KZnVuY3Rpb24gZmxhdHRlblRhYmxlVmFsdWVzKHNvdXJjZSkNCiAgICBsb2NhbCBmbGF0dGVuZWRWYWx1ZXMgPSB7fQ0KDQogICAgbG9jYWwgZnVuY3Rpb24gZmxhdHRlbihzb3VyY2UpDQogICAgICAgIGZvciBfLCB2YWx1ZSBpbiBwYWlycyhzb3VyY2UpIGRvDQogICAgICAgICAgICBpZiB0eXBlKHZhbHVlKSA9PSAidGFibGUiIHRoZW4NCiAgICAgICAgICAgICAgICBmbGF0dGVuKHZhbHVlKSAtLSDQoNC10LrRg9GA0YHQuNCy0L3QviDQvtCx0YDQsNCx0LDRgtGL0LLQsNC10Lwg0LLQu9C+0LbQtdC90L3Rg9GOINGC0LDQsdC70LjRhtGDDQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGZsYXR0ZW5lZFZhbHVlcywgdmFsdWUpIC0tINCU0L7QsdCw0LLQu9GP0LXQvCDQt9C90LDRh9C10L3QuNC1INCyINC/0LvQvtGB0LrQuNC5INGB0L/QuNGB0L7Qug0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZA0KDQogICAgZmxhdHRlbihzb3VyY2UpDQoNCiAgICByZXR1cm4gZmxhdHRlbmVkVmFsdWVzDQplbmQNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBhaW50X3VpIiwgZnVuY3Rpb24oKQ0KdHJhdmVyc2VfdGFibGUocmVmKQ0KDQotLUxBQkVMUw0KaWYgdWlzdGF0ZSA9PSA3IHRoZW4gDQogICAgdHJhdmVyc2VfdGFibGVfb24obGFiZWxfdGFiKQ0KZWxzZQ0KICAgIHRyYXZlcnNlX3RhYmxlKGxhYmVsX3RhYikNCmVuZA0KDQppZiB1aXN0YXRlID09IDYgdGhlbiANCiAgICB0cmF2ZXJzZV90YWJsZV9vbihrZXliaW5kc190YWIpDQogICAgdHJhdmVyc2VfdGFibGVfb24oTWlzYykNCmVsc2UNCiAgICB0cmF2ZXJzZV90YWJsZShrZXliaW5kc190YWIpDQogICAgdHJhdmVyc2VfdGFibGUoTWlzYykgDQplbmQNCg0KLS0gQ0ZHIFRBQg0KaWYgdWlzdGF0ZSA9PSA1IHRoZW4NCiAgICB0cmF2ZXJzZV90YWJsZV9vbihDb25maWdzKQ0KZWxzZQ0KICAgIHRyYXZlcnNlX3RhYmxlKENvbmZpZ3MpDQogICAgZm9yIF8sIHYgaW4gcGFpcnMoYmluZHMpIGRvDQogICAgICAgIHVpLnNldF92aXNpYmxlKHYucmVmLCBmYWxzZSkNCiAgICAgIGVuZA0KZW5kDQoNCg0KDQoNCg0KLS0gQUEgVEFCDQppZiB1aXN0YXRlIH49IDEgdGhlbiB0cmF2ZXJzZV90YWJsZShhbnRpYWltX3RhYikgdWkuc2V0X3Zpc2libGUoc3RhdGVfc2VsZWN0b3IsIGZhbHNlKSB1aS5zZXRfdmlzaWJsZShwcmVzZXRfc2VsZWN0b3IsIGZhbHNlKSB0cmF2ZXJzZV90YWJsZShhbnRpYWltX3RhYi5mZWF0dXJlX3RhYikgZWxzZSANCiAgICBpZiB1aS5nZXQoc3RhdGVfc2VsZWN0b3IpID09ICJJbiBBaXIiIHRoZW4NCiAgICAgICAgY3VycmVudGNvbmRpdGlvbiA9IGFudGlhaW1fdGFiWyJJbkFpciJdDQogICAgZWxzZWlmIHVpLmdldChzdGF0ZV9zZWxlY3RvcikgPT0gIkluIEFpciAmIENyb3VjaGluZyIgdGhlbg0KICAgICAgICBjdXJyZW50Y29uZGl0aW9uID0gYW50aWFpbV90YWJbIkFpcmNyb3VjaGluZyJdDQogICAgZWxzZWlmIHVpLmdldChzdGF0ZV9zZWxlY3RvcikgPT0gIlNsb3cgV2Fsa2luZyIgdGhlbg0KICAgICAgICBjdXJyZW50Y29uZGl0aW9uID0gYW50aWFpbV90YWJbIlNsb3d3YWxraW5nIl0NCiAgICBlbHNlaWYgdWkuZ2V0KHN0YXRlX3NlbGVjdG9yKSA9PSAiRmFrZSBMYWciIHRoZW4NCiAgICAgICAgY3VycmVudGNvbmRpdGlvbiA9IGFudGlhaW1fdGFiWyJGYWtlbGFnIl0NCiAgICBlbHNlICANCiAgICAgICAgY3VycmVudGNvbmRpdGlvbiA9IGFudGlhaW1fdGFiW3VpLmdldChzdGF0ZV9zZWxlY3RvcildDQogICAgZW5kDQogICAgdWkuc2V0X3Zpc2libGUocHJlc2V0X3NlbGVjdG9yLCB0cnVlKSANCiAgICB0cmF2ZXJzZV90YWJsZShhbnRpYWltX3RhYikNCg0KDQppZiB1aS5nZXQocHJlc2V0X3NlbGVjdG9yKSA9PSAiQ29uZGl0aW9uYWwiIHRoZW4NCnRyYXZlcnNlX3RhYmxlX29uKGN1cnJlbnRjb25kaXRpb24pIHVpLnNldF92aXNpYmxlKHN0YXRlX3NlbGVjdG9yLCB0cnVlKSB0cmF2ZXJzZV90YWJsZV9vbihhbnRpYWltX3RhYi5mZWF0dXJlX3RhYikNCg0KaWYgdWkuZ2V0KGN1cnJlbnRjb25kaXRpb24uYXRfdGFyZ2V0cykgPT0gIk9mZiIgdGhlbiB1aS5zZXRfdmlzaWJsZShjdXJyZW50Y29uZGl0aW9uLmxlZnRfeWF3LCBmYWxzZSkgdWkuc2V0X3Zpc2libGUoY3VycmVudGNvbmRpdGlvbi5yaWdodF95YXcsIGZhbHNlKSBlbmQNCmlmIHVpLmdldChjdXJyZW50Y29uZGl0aW9uLmF0X3RhcmdldHMpID09ICJCYWNrd2FyZCIgdGhlbiB1aS5zZXRfdmlzaWJsZShjdXJyZW50Y29uZGl0aW9uLmxlZnRfeWF3LCB0cnVlKSB1aS5zZXRfdmlzaWJsZShjdXJyZW50Y29uZGl0aW9uLnJpZ2h0X3lhdywgdHJ1ZSkgZW5kDQppZiB1aS5nZXQoY3VycmVudGNvbmRpdGlvbi5hdF90YXJnZXRzKSA9PSAiQXQgVGFyZ2V0IiB0aGVuIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24ubGVmdF95YXcsIHRydWUpIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24ucmlnaHRfeWF3LCB0cnVlKSBlbmQNCmlmIHVpLmdldChjdXJyZW50Y29uZGl0aW9uLnBpdGNoKSB+PSAiQ3VzdG9tIiB0aGVuIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24ucGl0Y2hfc2xpZGVyLCBmYWxzZSkgZWxzZSB1aS5zZXRfdmlzaWJsZShjdXJyZW50Y29uZGl0aW9uLnBpdGNoX3NsaWRlciwgdHJ1ZSkgZW5kDQppZiB1aS5nZXQoY3VycmVudGNvbmRpdGlvbi5sYnkpID09ICJKaXR0ZXIiIHRoZW4gdWkuc2V0X3Zpc2libGUoY3VycmVudGNvbmRpdGlvbi5sYnlzaWRlLCBmYWxzZSkgdWkuc2V0X3Zpc2libGUoY3VycmVudGNvbmRpdGlvbi5sYnlzcGVlZCwgZmFsc2UpIGVuZA0KaWYgdWkuZ2V0KGN1cnJlbnRjb25kaXRpb24ubGJ5KSA9PSAibWVnYW1peCIgdGhlbiB1aS5zZXRfdmlzaWJsZShjdXJyZW50Y29uZGl0aW9uLmxieXNpZGUsIGZhbHNlKSB1aS5zZXRfdmlzaWJsZShjdXJyZW50Y29uZGl0aW9uLmxieXNwZWVkLCBmYWxzZSkgZW5kDQppZiB1aS5nZXQoY3VycmVudGNvbmRpdGlvbi5sYnkpID09ICJTdGF0aWMiIHRoZW4gdWkuc2V0X3Zpc2libGUoY3VycmVudGNvbmRpdGlvbi5sYnlzaWRlLCB0cnVlKSB1aS5zZXRfdmlzaWJsZShjdXJyZW50Y29uZGl0aW9uLmxieXNwZWVkLCBmYWxzZSkgZW5kDQppZiB1aS5nZXQoY3VycmVudGNvbmRpdGlvbi5sYnkpID09ICJEZWxheWVkIiB0aGVuIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24ubGJ5c2lkZSwgZmFsc2UpIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24ubGJ5c3BlZWQsIHRydWUpIGVuZA0KaWYgdWkuZ2V0KGN1cnJlbnRjb25kaXRpb24ubGJ5KSA9PSAiT2ZmIiB0aGVuIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24ubGJ5c2lkZSxmYWxzZSkgdWkuc2V0X3Zpc2libGUoY3VycmVudGNvbmRpdGlvbi5sYnlzcGVlZCwgZmFsc2UpIGVuZA0KaWYgdWkuZ2V0KHN0YXRlX3NlbGVjdG9yKSB+PSAiRmFrZSBMYWciIHRoZW4NCmlmIG5vdCB1aS5nZXQoY3VycmVudGNvbmRpdGlvbi5kZWZlbnNpdmUuYWEpIHRoZW4gdHJhdmVyc2VfdGFibGUoY3VycmVudGNvbmRpdGlvbi5kZWZlbnNpdmUpIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24uZGVmZW5zaXZlLmFhLCB0cnVlKQ0KZWxzZQ0KdHJhdmVyc2VfdGFibGVfb24oY3VycmVudGNvbmRpdGlvbi5kZWZlbnNpdmUpDQppZiB1aS5nZXQoY3VycmVudGNvbmRpdGlvbi5kZWZlbnNpdmUueWF3KSA9PSAiQ3VzdG9tIiB0aGVuIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24uZGVmZW5zaXZlLmFfeWF3LCB0cnVlKSB1aS5zZXRfdmlzaWJsZShjdXJyZW50Y29uZGl0aW9uLmRlZmVuc2l2ZS5iX3lhdywgdHJ1ZSkNCmVsc2VpZiB1aS5nZXQoY3VycmVudGNvbmRpdGlvbi5kZWZlbnNpdmUueWF3KSA9PSAiUmFuZG9tIiB0aGVuIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24uZGVmZW5zaXZlLmFfeWF3LCB0cnVlKSB1aS5zZXRfdmlzaWJsZShjdXJyZW50Y29uZGl0aW9uLmRlZmVuc2l2ZS5iX3lhdywgdHJ1ZSkNCmVsc2VpZiB1aS5nZXQoY3VycmVudGNvbmRpdGlvbi5kZWZlbnNpdmUueWF3KSA9PSAiU3BpbmJvdCIgdGhlbiB1aS5zZXRfdmlzaWJsZShjdXJyZW50Y29uZGl0aW9uLmRlZmVuc2l2ZS5hX3lhdywgdHJ1ZSkgdWkuc2V0X3Zpc2libGUoY3VycmVudGNvbmRpdGlvbi5kZWZlbnNpdmUuYl95YXcsIGZhbHNlKSANCmVsc2UNCiAgICB1aS5zZXRfdmlzaWJsZShjdXJyZW50Y29uZGl0aW9uLmRlZmVuc2l2ZS5hX3lhdywgZmFsc2UpIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24uZGVmZW5zaXZlLmJfeWF3LCBmYWxzZSkNCmVuZA0KaWYgdWkuZ2V0KGN1cnJlbnRjb25kaXRpb24uZGVmZW5zaXZlLnBpdGNoKSA9PSAiQ3VzdG9tIiB0aGVuIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24uZGVmZW5zaXZlLmFfcGl0Y2gsIHRydWUpIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24uZGVmZW5zaXZlLmJfcGl0Y2gsIHRydWUpDQplbHNlaWYgdWkuZ2V0KGN1cnJlbnRjb25kaXRpb24uZGVmZW5zaXZlLnBpdGNoKSA9PSAiUmFuZG9tIiB0aGVuIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24uZGVmZW5zaXZlLmFfcGl0Y2gsIHRydWUpIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24uZGVmZW5zaXZlLmJfcGl0Y2gsIHRydWUpDQplbHNlaWYgdWkuZ2V0KGN1cnJlbnRjb25kaXRpb24uZGVmZW5zaXZlLnBpdGNoKSA9PSAiUEFLRVRBIiB0aGVuIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24uZGVmZW5zaXZlLmFfcGl0Y2gsIHRydWUpIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24uZGVmZW5zaXZlLmJfcGl0Y2gsIHRydWUpIA0KZWxzZQ0KICAgIHVpLnNldF92aXNpYmxlKGN1cnJlbnRjb25kaXRpb24uZGVmZW5zaXZlLmFfcGl0Y2gsIGZhbHNlKSB1aS5zZXRfdmlzaWJsZShjdXJyZW50Y29uZGl0aW9uLmRlZmVuc2l2ZS5iX3BpdGNoLCBmYWxzZSkNCmVuZA0KZW5kDQplbmQNCmVsc2UNCiAgICB0cmF2ZXJzZV90YWJsZShjdXJyZW50Y29uZGl0aW9uKSB1aS5zZXRfdmlzaWJsZShzdGF0ZV9zZWxlY3RvciwgZmFsc2UpIHRyYXZlcnNlX3RhYmxlX29uKGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiKQ0KZW5kDQoNCmlmIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5leHRyYV9vcHRpb24pLCAi4piBIEZha2UgTGFnIEFsdGVybmF0aXZlIikgdGhlbiANCiAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mYWtlbGFnX21vZGUsIHRydWUpDQogICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ192YXJvdXMsIHRydWUpDQogICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ19maXJzdCwgdHJ1ZSkNCiAgICBpZiB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ19tb2RlKSA9PSAiU3dpdGNoIiBvciAiUmFuZG9tIiB0aGVuDQogICAgICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZha2VsYWdfc2Vjb25kLCB0cnVlKQ0KICAgIGVsc2UNCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ19zZWNvbmQsIGZhbHNlKQ0KICAgIGVuZA0KZWxzZQ0KICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZha2VsYWdfbW9kZSwgZmFsc2UpDQogICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ192YXJvdXMsIGZhbHNlKQ0KICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZha2VsYWdfZmlyc3QsIGZhbHNlKQ0KICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZha2VsYWdfc2Vjb25kLCBmYWxzZSkNCmVuZA0KDQoNCmlmIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5leHRyYV9vcHRpb24pLCAi4puoIERlZmVuc2l2ZSBBbHRlcm5hdGl2ZSIpIHRoZW4gDQogICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZGVmZW5zaXZlX21vZGUsIHRydWUpDQogICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZm9yY2VfbGMsIHRydWUpDQppZiB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZGVmZW5zaXZlX21vZGUpID09ICLiiJ4gQWx0ZXJuYXRpdmUiIHRoZW4NCiAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5taW5fdGlja19sZWZ0LCB0cnVlKQ0KICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLm1heF90aWNrX2xlZnQsIHRydWUpDQogICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV90YWIuZmVhdHVyZV90YWIubGFiZWxkZWYsIHRydWUpDQplbHNlDQogICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV90YWIuZmVhdHVyZV90YWIubWluX3RpY2tfbGVmdCwgZmFsc2UpDQogICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV90YWIuZmVhdHVyZV90YWIubWF4X3RpY2tfbGVmdCwgZmFsc2UpDQogICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV90YWIuZmVhdHVyZV90YWIubGFiZWxkZWYsIGZhbHNlKQ0KZW5kDQplbHNlDQogICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZGVmZW5zaXZlX21vZGUsIGZhbHNlKQ0KICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZvcmNlX2xjLCBmYWxzZSkNCiAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5taW5fdGlja19sZWZ0LCBmYWxzZSkNCiAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5tYXhfdGlja19sZWZ0LCBmYWxzZSkNCiAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5sYWJlbGRlZiwgZmFsc2UpDQplbmQNCg0KZW5kIA0KLS0NCg0KLS0gUkFHRUJPVCBUQUINCmlmIHVpc3RhdGUgPT0gMiB0aGVuDQp0cmF2ZXJzZV90YWJsZV9vbihnZW5lcmFsX3RhYikNCmVsc2UNCnRyYXZlcnNlX3RhYmxlKGdlbmVyYWxfdGFiKQ0KZW5kDQotLQ0KaWYgdWlzdGF0ZSA9PSAzIHRoZW4NCnRyYXZlcnNlX3RhYmxlX29uKHJlZi5hbnRpYWltLmxlZ21vdmVtZW50KQ0KdHJhdmVyc2VfdGFibGVfb24odmlzdWFsc190YWIpDQoNCmlmIHVpLmdldCh2aXN1YWxzX3RhYi5ldmVudGxvZ3MpIHRoZW4gdWkuc2V0X3Zpc2libGUodmlzdWFsc190YWIuZXZlbnRzLCB0cnVlKSB1aS5zZXRfdmlzaWJsZSh2aXN1YWxzX3RhYi5ldmVudHNfc3R5bGUsIHRydWUpIHVpLnNldF92aXNpYmxlKHZpc3VhbHNfdGFiLmV2ZW50Z2xvdywgdHJ1ZSkgDQplbHNlDQp1aS5zZXRfdmlzaWJsZSh2aXN1YWxzX3RhYi5ldmVudHMsIGZhbHNlKSB1aS5zZXRfdmlzaWJsZSh2aXN1YWxzX3RhYi5ldmVudHNfc3R5bGUsIGZhbHNlKSB1aS5zZXRfdmlzaWJsZSh2aXN1YWxzX3RhYi5ldmVudGdsb3csIGZhbHNlKSANCmVuZA0KZWxzZQ0KdHJhdmVyc2VfdGFibGUocmVmLmFudGlhaW0ubGVnbW92ZW1lbnQpDQp0cmF2ZXJzZV90YWJsZSh2aXN1YWxzX3RhYikNCmVuZA0KZW5kKQ0KbG9jYWwgZ3JhbV9jcmVhdGUgPSBmdW5jdGlvbih2YWx1ZSwgY291bnQpIGxvY2FsIGdyYW0gPSB7IH07IGZvciBpPTEsIGNvdW50IGRvIGdyYW1baV0gPSB2YWx1ZTsgZW5kIHJldHVybiBncmFtOyBlbmQNCmxvY2FsIGdyYW1fdXBkYXRlID0gZnVuY3Rpb24odGFiLCB2YWx1ZSwgZm9yY2VkKSBsb2NhbCBuZXdfdGFiID0gdGFiOyBpZiBmb3JjZWQgb3IgbmV3X3RhYlsjbmV3X3RhYl0gfj0gdmFsdWUgdGhlbiB0YWJsZS5pbnNlcnQobmV3X3RhYiwgdmFsdWUpOyB0YWJsZS5yZW1vdmUobmV3X3RhYiwgMSk7IGVuZDsgdGFiID0gbmV3X3RhYjsgZW5kDQpsb2NhbCBnZXRfYXZlcmFnZSA9IGZ1bmN0aW9uKHRhYikgbG9jYWwgZWxlbWVudHMsIHN1bSA9IDAsIDA7IGZvciBrLCB2IGluIHBhaXJzKHRhYikgZG8gc3VtID0gc3VtICsgdjsgZWxlbWVudHMgPSBlbGVtZW50cyArIDE7IGVuZCByZXR1cm4gc3VtIC8gZWxlbWVudHM7IGVuZA0KDQpsb2NhbCBhbnRpX2FpbXMgPSB7DQogICAgY29uZGl0aW9uID0gIiIsDQp9DQpsb2NhbCBoZWxwZXJzID0gew0KICAgIGxwID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwNCiAgICBncm91bmRfdGlja3MgPSAwLA0KfQ0Kc2tlZXRmYWtlbGFnbGltaXQgPSB1aS5yZWZlcmVuY2UoIkFBIiwiRmFrZSBsYWciLCAiTGltaXQiKQ0Kc2tlZXRmYWtlbGFnYW1vdW50ID0gdWkucmVmZXJlbmNlKCJBQSIsIkZha2UgbGFnIiwgIkFtb3VudCIpDQpza2VldGZha2VsYWd2YXJpYW5jZSA9IHVpLnJlZmVyZW5jZSgiQUEiLCJGYWtlIGxhZyIsICJWYXJpYW5jZSIpDQpsb2NhbCBrZXlzZm9yaW5kcyA9IA0Kew0KICAgYWltYm90ID0gdWkubXVsdGlSZWZlcmVuY2UoIlJBR0UiLCAiQWltYm90IiwgIkVuYWJsZWQiKTsNCiAgIG11bHRpcG9pbnQgPSB1aS5tdWx0aVJlZmVyZW5jZSgiUkFHRSIsICJBaW1ib3QiLCAiTXVsdGktcG9pbnQgc2NhbGUiKTsNCiAgIGRvdWJsZXRhcCA9IHVpLm11bHRpUmVmZXJlbmNlKCJSQUdFIiwgIkFpbWJvdCIsICJEb3VibGUgdGFwIik7DQogICBzbG93d2FsayA9ICB1aS5tdWx0aVJlZmVyZW5jZSgiQUEiLCAiT3RoZXIiLCAiU2xvdyBtb3Rpb24iKTsNCiAgIGhpZGVzaG90cyA9ICB1aS5tdWx0aVJlZmVyZW5jZSgiQUEiLCAiT3RoZXIiLCAiT24gc2hvdCBhbnRpLWFpbSIpOw0KICAgZHRfbGltaXQgPSB1aS5yZWZlcmVuY2UoIlJBR0UiLCAiQWltYm90IiwgIkRvdWJsZSB0YXAgZmFrZSBsYWcgbGltaXQiKTsNCiAgIGZyZWVzdGFuZCA9IHVpLm11bHRpUmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRnJlZXN0YW5kaW5nIik7DQogICBmZCA9IHVpLnJlZmVyZW5jZSgiUkFHRSIsICJPdGhlciIsICJEdWNrIHBlZWsgYXNzaXN0Iik7DQogICBkbWcgPSB1aS5tdWx0aVJlZmVyZW5jZSgiUkFHRSIsICJBaW1ib3QiLCAiTWluaW11bSBkYW1hZ2Ugb3ZlcnJpZGUiKTsNCn0gIA0KDQpsb2NhbCBmdW5jdGlvbiBkb3VibGV0YXBfY2hhcmdlZCgpDQogICAgaWYgbm90IHVpLmdldChrZXlzZm9yaW5kcy5kb3VibGV0YXBbMV0pIG9yIG5vdCB1aS5nZXQoa2V5c2ZvcmluZHMuZG91YmxldGFwWzJdKSBvciB1aS5nZXQoa2V5c2ZvcmluZHMuZmQpIHRoZW4gcmV0dXJuIGZhbHNlIGVuZA0KDQogICAgbG9jYWwgbWUgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpDQoNCiAgICBpZiBtZSA9PSBuaWwgb3Igbm90IGVudGl0eS5pc19hbGl2ZShtZSkgdGhlbiByZXR1cm4gZmFsc2UgZW5kDQoNCiAgICBsb2NhbCB3ZWFwb24gPSBlbnRpdHkuZ2V0X3Byb3AobWUsICJtX2hBY3RpdmVXZWFwb24iKQ0KDQogICAgaWYgd2VhcG9uID09IG5pbCB0aGVuIHJldHVybiBmYWxzZSBlbmQNCg0KICAgIGxvY2FsIG5leHRfYXR0YWNrID0gZW50aXR5LmdldF9wcm9wKG1lLCAibV9mbE5leHRBdHRhY2siKSArIDAuMjUNCiAgICBsb2NhbCBuZXh0X3ByaW1hcnlfYXR0YWNrID0gZW50aXR5LmdldF9wcm9wKHdlYXBvbiwgIm1fZmxOZXh0UHJpbWFyeUF0dGFjayIpICsgMC41DQoNCiAgICBpZiBuZXh0X2F0dGFjayA9PSBuaWwgb3IgbmV4dF9wcmltYXJ5X2F0dGFjayA9PSBuaWwgdGhlbiByZXR1cm4gZmFsc2UgZW5kDQoNCiAgICByZXR1cm4gbmV4dF9hdHRhY2sgLSBnbG9iYWxzLmN1cnRpbWUoKSA8IDAgYW5kIG5leHRfcHJpbWFyeV9hdHRhY2sgLSBnbG9iYWxzLmN1cnRpbWUoKSA8IDANCmVuZA0KDQogZnVuY3Rpb24gZ2V0X3ZlbG9jaXR5KHBsYXllcikNCiAgICBsb2NhbCB4LHkseiA9IGVudGl0eS5nZXRfcHJvcChwbGF5ZXIsICJtX3ZlY1ZlbG9jaXR5IikNCiAgICBpZiB4ID09IG5pbCB0aGVuIHJldHVybiBlbmQNCiAgICByZXR1cm4gbWF0aC5zcXJ0KHgqeCArIHkqeSArIHoqeikNCmVuZA0KDQpsb2NhbCBmb3JyZWFsdGltZSA9IDANCmZ1bmN0aW9uIHNtb290aEppdHRlcihzd2l0Y2h5YXcxLCBzd2l0Y2h5YXcyLCBzd2l0Y2hpbmdzcGVlZCkNCiAgICBpZiBnbG9iYWxzLmN1cnRpbWUoKSA+IGZvcnJlYWx0aW1lICsgMSAvIChzd2l0Y2hpbmdzcGVlZCAqIDIpIHRoZW4NCiAgICAgICAgZmluYWx5YXdnZyA9IHN3aXRjaHlhdzENCiAgICAgICAgaWYgZ2xvYmFscy5jdXJ0aW1lKCkgLSBmb3JyZWFsdGltZSA+IDIgLyAoc3dpdGNoaW5nc3BlZWQgKiAyKSB0aGVuDQogICAgICAgICAgICBmb3JyZWFsdGltZSA9IGdsb2JhbHMuY3VydGltZSgpDQogICAgICAgIGVuZA0KICAgIGVsc2UNCiAgICAgICAgZmluYWx5YXdnZyA9IHN3aXRjaHlhdzINCiAgICBlbmQNCiAgICByZXR1cm4gZmluYWx5YXdnZw0KZW5kDQoNCmZ1bmN0aW9uIGRlc3luY3NpZGUoKQ0KICAgIGlmIG5vdCBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpIG9yIG5vdCBlbnRpdHkuaXNfYWxpdmUoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkgdGhlbg0KICAgICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBsb2NhbCBib2R5eWF3ID0gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZsUG9zZVBhcmFtZXRlciIsIDExKSAqIDEyMCAtIDYwDQogICAgbG9jYWwgc2lkZSA9IGJvZHl5YXcgPiAwIGFuZCAtMSBvciAxDQogICAgcmV0dXJuIHNpZGUNCmVuZA0KY29uZHRvdGFrZSA9ICIiDQpmdW5jdGlvbiBjYWxjdWxhdGVfYm9keV9mcygpDQogICAgaWYgbm90IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgb3Igbm90IGNsaWVudC5jdXJyZW50X3RocmVhdCgpIHRoZW4NCiAgICAgICAgcmV0dXJuIDENCiAgICBlbmQNCiAgICBsb2NhbCB4MSwgeTEsIHoxID0gZW50aXR5LmhpdGJveF9wb3NpdGlvbihlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAwKQ0KICAgIGxvY2FsIHgyLCB5MiwgejIgPSBlbnRpdHkuaGl0Ym94X3Bvc2l0aW9uKGNsaWVudC5jdXJyZW50X3RocmVhdCgpLCAwKQ0KDQogICAgbG9jYWwgcmVzdWx0DQogICAgaWYgeDIgLSB4MSA8IDEwIHRoZW4NCiAgICAgICAgcmVzdWx0ID0gLTENCiAgICBlbHNlDQogICAgICAgIHJlc3VsdCA9IDENCiAgICBlbmQNCg0KICAgIHJldHVybiByZXN1bHQNCmVuZA0KDQpmdW5jdGlvbiBoZWxwZXJzOmlzX29uX2dyb3VuZCgpDQogICAgbHAgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpDQogICAgaWYgbm90IGxwIHRoZW4gcmV0dXJuIGVuZA0KICAgIGxvY2FsIGZsYWdzID0gZW50aXR5LmdldF9wcm9wKGxwLCAnbV9mRmxhZ3MnKQ0KICAgIGlmIGJpdC5iYW5kKGZsYWdzLCAxKSA9PSAwIHRoZW4NCiAgICAgICAgaGVscGVycy5ncm91bmRfdGlja3MgPSAwDQogICAgZWxzZWlmIGhlbHBlcnMuZ3JvdW5kX3RpY2tzIDw9IDQ1IHRoZW4NCiAgICAgICAgaGVscGVycy5ncm91bmRfdGlja3MgPSBoZWxwZXJzLmdyb3VuZF90aWNrcyArIDENCiAgICBlbmQNCiAgICByZXR1cm4gaGVscGVycy5ncm91bmRfdGlja3MgPj0gNDUNCmVuZA0KDQpmdW5jdGlvbiBhbnRpX2FpbXM6Z2V0X3N0YXRlX3R5cGUoKQ0KICAgIGxwID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQ0KICAgIGlmIG5vdCBscCBvciBub3QgZW50aXR5LmlzX2FsaXZlKGxwKSB0aGVuIHJldHVybiBlbmQNCiAgICAgICAgICAgIGlmIG5vdCBlbnRpdHkuaXNfYWxpdmUobHApIHRoZW4gcmV0dXJuIGVuZA0KICAgICAgICAgICAgbG9jYWwgZHVja19hbXQgPSBlbnRpdHkuZ2V0X3Byb3AobHAsICdtX2ZsRHVja0Ftb3VudCcpDQogICAgICAgICAgICBsb2NhbCBzcGVlZCA9IHZlY3RvcihlbnRpdHkuZ2V0X3Byb3AobHAsICdtX3ZlY1ZlbG9jaXR5JykpOmxlbmd0aCgpDQogICAgICAgICAgICBpZiB1aS5nZXQoa2V5c2ZvcmluZHMuZG91YmxldGFwWzFdKSBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmRvdWJsZXRhcFsyXSkgYW5kIG5vdCB1aS5nZXQoa2V5c2ZvcmluZHMuZmQpIG9yIHVpLmdldChrZXlzZm9yaW5kcy5oaWRlc2hvdHNbMV0pIGFuZCBub3QgdWkuZ2V0KGtleXNmb3JpbmRzLmZkKSBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmhpZGVzaG90c1syXSkgdGhlbg0KICAgICAgICAgICAgICAgIGlmIG5vdCBoZWxwZXJzOmlzX29uX2dyb3VuZCgpIGFuZCBkdWNrX2FtdCA9PSAwIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJBaXIiDQogICAgICAgICAgICAgICAgZWxzZWlmIGR1Y2tfYW10ID4gMCBhbmQgbm90IGhlbHBlcnM6aXNfb25fZ3JvdW5kKCkgdGhlbg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkFpckNyb3VjaCINCiAgICAgICAgICAgICAgICBlbHNlaWYgZHVja19hbXQgPiAwIGFuZCBoZWxwZXJzOmlzX29uX2dyb3VuZCgpIGFuZCBub3QgdWkuZ2V0KGtleXNmb3JpbmRzLmZkKSB0aGVuDQogICAgICAgICAgICAgICAgICAgIHJldHVybiAiQ3JvdWNoIg0KICAgICAgICAgICAgICAgIGVsc2VpZiBzcGVlZCA+IDIgYW5kIG5vdCB1aS5nZXQocmVmLmFudGlhaW0uc2xvd19tb3Rpb25bMl0pIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJNb3ZpbmciDQogICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChyZWYuYW50aWFpbS5zbG93X21vdGlvblsyXSkgdGhlbg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlNsb3dXYWxrIg0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJTdGFuZGluZyINCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICByZXR1cm4gIkZha2UgTGFnIg0KICAgICAgICAgICAgZW5kDQplbmQNCg0KZnVuY3Rpb24gYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpDQogICAgbHAgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpDQogICAgaWYgbm90IGxwIG9yIG5vdCBlbnRpdHkuaXNfYWxpdmUobHApIHRoZW4gcmV0dXJuIGVuZA0KICAgICAgICAgICAgaWYgbm90IGVudGl0eS5pc19hbGl2ZShscCkgdGhlbiByZXR1cm4gZW5kDQogICAgICAgICAgICBsb2NhbCBkdWNrX2FtdCA9IGVudGl0eS5nZXRfcHJvcChscCwgJ21fZmxEdWNrQW1vdW50JykNCiAgICAgICAgICAgIGxvY2FsIHNwZWVkID0gdmVjdG9yKGVudGl0eS5nZXRfcHJvcChscCwgJ21fdmVjVmVsb2NpdHknKSk6bGVuZ3RoKCkNCiAgICAgICAgICAgIGlmIHVpLmdldChrZXlzZm9yaW5kcy5kb3VibGV0YXBbMV0pIGFuZCB1aS5nZXQoa2V5c2ZvcmluZHMuZG91YmxldGFwWzJdKSBhbmQgbm90IHVpLmdldChrZXlzZm9yaW5kcy5mZCkgb3IgdWkuZ2V0KGtleXNmb3JpbmRzLmhpZGVzaG90c1sxXSkgYW5kIG5vdCB1aS5nZXQoa2V5c2ZvcmluZHMuZmQpIGFuZCB1aS5nZXQoa2V5c2ZvcmluZHMuaGlkZXNob3RzWzJdKSB0aGVuDQogICAgICAgICAgICAgICAgaWYgbm90IGhlbHBlcnM6aXNfb25fZ3JvdW5kKCkgYW5kIGR1Y2tfYW10ID09IDAgdGhlbg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkluIEFpciINCiAgICAgICAgICAgICAgICBlbHNlaWYgZHVja19hbXQgPiAwIGFuZCBub3QgaGVscGVyczppc19vbl9ncm91bmQoKSB0aGVuDQogICAgICAgICAgICAgICAgICAgIHJldHVybiAiSW4gQWlyICYgQ3JvdWNoaW5nIg0KICAgICAgICAgICAgICAgIGVsc2VpZiBkdWNrX2FtdCA+IDAgYW5kIGhlbHBlcnM6aXNfb25fZ3JvdW5kKCkgYW5kIG5vdCB1aS5nZXQoa2V5c2ZvcmluZHMuZmQpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJDcm91Y2hpbmciDQogICAgICAgICAgICAgICAgZWxzZWlmIHNwZWVkID4gMiBhbmQgbm90IHVpLmdldChyZWYuYW50aWFpbS5zbG93X21vdGlvblsyXSkgdGhlbg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gIk1vdmluZyINCiAgICAgICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KHJlZi5hbnRpYWltLnNsb3dfbW90aW9uWzJdKSB0aGVuDQogICAgICAgICAgICAgICAgICAgIHJldHVybiAiU2xvdyBXYWxraW5nIg0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJTdGFuZGluZyINCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICByZXR1cm4gIkZha2UgTGFnIg0KICAgICAgICAgICAgZW5kDQplbmQNCmZ1bmN0aW9uIGFudGlfYWltczpnZXRfZmFrZWxhZ19jb25kKCkNCiAgICBscCA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkNCiAgICBpZiBub3QgbHAgb3Igbm90IGVudGl0eS5pc19hbGl2ZShscCkgdGhlbiByZXR1cm4gZW5kDQogICAgICAgICAgICBpZiBub3QgZW50aXR5LmlzX2FsaXZlKGxwKSB0aGVuIHJldHVybiBlbmQNCiAgICAgICAgICAgIGxvY2FsIGR1Y2tfYW10ID0gZW50aXR5LmdldF9wcm9wKGxwLCAnbV9mbER1Y2tBbW91bnQnKQ0KICAgICAgICAgICAgbG9jYWwgc3BlZWQgPSB2ZWN0b3IoZW50aXR5LmdldF9wcm9wKGxwLCAnbV92ZWNWZWxvY2l0eScpKTpsZW5ndGgoKQ0KICAgICAgICAgICAgICAgIGlmIG5vdCBoZWxwZXJzOmlzX29uX2dyb3VuZCgpIGFuZCBkdWNrX2FtdCA9PSAwIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJJbiBBaXIiDQogICAgICAgICAgICAgICAgZWxzZWlmIGR1Y2tfYW10ID4gMCBhbmQgbm90IGhlbHBlcnM6aXNfb25fZ3JvdW5kKCkgdGhlbg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkluIEFpciAmIENyb3VjaGluZyINCiAgICAgICAgICAgICAgICBlbHNlaWYgZHVja19hbXQgPiAwIGFuZCBoZWxwZXJzOmlzX29uX2dyb3VuZCgpIGFuZCBub3QgdWkuZ2V0KGtleXNmb3JpbmRzLmZkKSB0aGVuDQogICAgICAgICAgICAgICAgICAgIHJldHVybiAiQ3JvdWNoaW5nIg0KICAgICAgICAgICAgICAgIGVsc2VpZiBzcGVlZCA+IDIgYW5kIG5vdCB1aS5nZXQocmVmLmFudGlhaW0uc2xvd19tb3Rpb25bMl0pIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJNb3ZpbmciDQogICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChyZWYuYW50aWFpbS5zbG93X21vdGlvblsyXSkgdGhlbg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlNsb3cgV2Fsa2luZyINCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHJldHVybiAiU3RhbmRpbmciDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCg0KLS0gQ1JFQVRFIE1PVkUNCg0KbG9jYWwgZnVuY3Rpb24gZ2V0X2VudF9kaXN0KGVudF8xLCBlbnRfMikNCiAgICBsb2NhbCBlbnQxX3BvcyA9IHZlY3RvcihlbnRpdHkuZ2V0X3Byb3AoZW50XzEsICJtX3ZlY09yaWdpbiIpKQ0KICAgIGxvY2FsIGVudDJfcG9zID0gdmVjdG9yKGVudGl0eS5nZXRfcHJvcChlbnRfMiwgIm1fdmVjT3JpZ2luIikpDQoNCiAgICBsb2NhbCBkaXN0ID0gZW50MV9wb3M6ZGlzdChlbnQyX3BvcykNCg0KICAgIHJldHVybiBkaXN0DQplbmQNCmxvY2FsIGZ1bmN0aW9uIGlzX3Zpc2libGUoZW50KQ0KICAgIGxvY2FsIG1lID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQ0KICAgIGxvY2FsIGxfeCwgbF95LCBsX3ogPSBlbnRpdHkuaGl0Ym94X3Bvc2l0aW9uKG1lLCAwKQ0KICAgIGxvY2FsIGVfeCwgZV95LCBlX3ogPSBlbnRpdHkuaGl0Ym94X3Bvc2l0aW9uKGVudCwgMCkNCg0KICAgIGxvY2FsIGZyYWMsIGVudCA9IGNsaWVudC50cmFjZV9saW5lKG1lLCBsX3gsIGxfeSwgbF96LCBlX3gsIGVfeSwgZV96KQ0KDQogICAgcmV0dXJuIGZyYWMgPiAwLjY1DQplbmQNCmxvY2FsIHRpY2tiYXNlX2NoZWNrID0gMA0KY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygic2V0dXBfY29tbWFuZCIsIGZ1bmN0aW9uKGNtZCkNCiAgICBtZSA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkNCiAgICBpZiBub3QgbWUgb3Igbm90IGVudGl0eS5pc19hbGl2ZShtZSkgdGhlbiByZXR1cm4gZW5kDQogICAgdGlja2Jhc2VfY2hlY2sgPSBnbG9iYWxzLnRpY2tjb3VudCgpID4gZW50aXR5LmdldF9wcm9wKG1lLCAibV9uVGlja2Jhc2UiKQ0KZW5kKQ0KDQpsb2NhbCBmdW5jdGlvbiBhbnRpYmFja3N0YWIoKSANCiAgICBsb2NhbCBiZXN0ZW5lbXkgPSBjbGllbnQuY3VycmVudF90aHJlYXQoKQ0KICAgIGxvY2FsIGxwID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQ0KICAgIGlmIG5vdCBiZXN0ZW5lbXkgb3Igbm90IGxwIHRoZW4gcmV0dXJuIGZhbHNlIGVuZA0KICAgIGlmIGVudGl0eS5nZXRfY2xhc3NuYW1lKGVudGl0eS5nZXRfcGxheWVyX3dlYXBvbihiZXN0ZW5lbXkpKSA9PSAiQ0tuaWZlIiBhbmQgaXNfdmlzaWJsZShiZXN0ZW5lbXkpIGFuZCBnZXRfZW50X2Rpc3QobHAsIGJlc3RlbmVteSkgPCA0NTAgYW5kIGJlc3RlbmVteSB+PSBuaWwgdGhlbiANCiAgICAgICAgcmV0dXJuIHRydWUgDQogICAgZWxzZSANCiAgICAgICAgcmV0dXJuIGZhbHNlDQogICAgZW5kDQplbmQNCg0KZnVuY3Rpb24gc2FmZWhlYWR0YXJnZXQoKSANCiAgICBsb2NhbCBiZXN0ZW5lbXkgPSBjbGllbnQuY3VycmVudF90aHJlYXQoKQ0KICAgIGlmIGJlc3RlbmVteSA9PSBuaWwgdGhlbiByZXR1cm4gZmFsc2UgZW5kDQogICAgaWYgZW50aXR5LmdldF9jbGFzc25hbWUoZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGJlc3RlbmVteSkpIH49ICJDS25pZmUiIGFuZCBnZXRfZW50X2Rpc3QobHAsIGJlc3RlbmVteSkgPiAyNSB0aGVuDQogICAgICAgIGxvY2FsIG9yaWdpbiA9IHZlY3RvcihlbnRpdHkuZ2V0X29yaWdpbihlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSkNCiAgICAgICAgbG9jYWwgb3JpZ2luMiA9IHZlY3RvcihlbnRpdHkuZ2V0X29yaWdpbihiZXN0ZW5lbXkpKQ0KICAgICAgICByZXR1cm4gb3JpZ2luLnogLSBvcmlnaW4yLnogPiA3MA0KICAgIGVsc2UNCiAgICAgICAgcmV0dXJuIGZhbHNlDQogICAgZW5kDQplbmQNCmZyZWVzdGFuZCwgZnJlZXN0YW5ka2V5ID0gdWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRnJlZXN0YW5kaW5nIikNCmxhc3RfcHJlc3NfdCA9IDANCg0KY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygicGFpbnRfdWkiLCBmdW5jdGlvbigpDQogICAgaWYgdWkuZ2V0KGtleWJpbmRzX3RhYi5oaWRlc2hvdHMpIHRoZW4NCiAgICAgICAgdWkuc2V0KGtleXNmb3JpbmRzLmhpZGVzaG90c1sxXSwgdHJ1ZSkNCiAgICAgICAgdWkuc2V0KGtleXNmb3JpbmRzLmhpZGVzaG90c1syXSwgIkFsd2F5cyBvbiIpDQogICAgZWxzZSANCiAgICAgICAgdWkuc2V0KGtleXNmb3JpbmRzLmhpZGVzaG90c1sxXSwgZmFsc2UpDQogICAgICAgIHVpLnNldChrZXlzZm9yaW5kcy5oaWRlc2hvdHNbMl0sICJPbiBob3RrZXkiKQ0KICAgIGVuZA0KICAgIGlmIHVpLmdldChrZXliaW5kc190YWIuc2xvd3dhbGspIHRoZW4NCiAgICAgICAgdWkuc2V0KGtleXNmb3JpbmRzLnNsb3d3YWxrWzFdLCB0cnVlKQ0KICAgICAgICB1aS5zZXQoa2V5c2ZvcmluZHMuc2xvd3dhbGtbMl0sICJBbHdheXMgb24iKQ0KICAgIGVsc2UgDQogICAgICAgIHVpLnNldChrZXlzZm9yaW5kcy5zbG93d2Fsa1sxXSwgZmFsc2UpDQogICAgICAgIHVpLnNldChrZXlzZm9yaW5kcy5zbG93d2Fsa1syXSwgIk9uIGhvdGtleSIpDQogICAgZW5kDQogICAgaWYgdWkuZ2V0KGtleWJpbmRzX3RhYi5lZGdleWF3KSB0aGVuDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5lZGdleWF3LCB0cnVlKQ0KCWVsc2UgDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5lZGdleWF3LCBmYWxzZSkNCiAgICBlbmQNCiAgICB1aS5zZXQoa2V5YmluZHNfdGFiLm1hbnVhbF9yaWdodCwgIk9uIGhvdGtleSIpDQogICAgdWkuc2V0KGtleWJpbmRzX3RhYi5tYW51YWxfbGVmdCwgIk9uIGhvdGtleSIpDQogICAgdWkuc2V0KGtleWJpbmRzX3RhYi5tYW51YWxfZm9yd2FyZCwgIk9uIGhvdGtleSIpDQogICAgaWYgdWkuZ2V0KGtleWJpbmRzX3RhYi5tYW51YWxfcmlnaHQpIGFuZCBsYXN0X3ByZXNzX3QgKyAwLjIgPCBnbG9iYWxzLmN1cnRpbWUoKSB0aGVuDQogICAgICAgIG1hbnVhbF9kaXIgPSBtYW51YWxfZGlyID09IDIgYW5kIDAgb3IgMg0KICAgICAgICBsYXN0X3ByZXNzX3QgPSBnbG9iYWxzLmN1cnRpbWUoKQ0KICAgIGVsc2VpZiB1aS5nZXQoa2V5YmluZHNfdGFiLm1hbnVhbF9sZWZ0KSBhbmQgbGFzdF9wcmVzc190ICsgMC4yIDwgZ2xvYmFscy5jdXJ0aW1lKCkgdGhlbg0KICAgICAgICBtYW51YWxfZGlyID0gbWFudWFsX2RpciA9PSAxIGFuZCAwIG9yIDENCiAgICAgICAgbGFzdF9wcmVzc190ID0gZ2xvYmFscy5jdXJ0aW1lKCkNCiAgICBlbHNlaWYgdWkuZ2V0KGtleWJpbmRzX3RhYi5tYW51YWxfZm9yd2FyZCkgYW5kIGxhc3RfcHJlc3NfdCArIDAuMiA8IGdsb2JhbHMuY3VydGltZSgpIHRoZW4NCiAgICAgICAgbWFudWFsX2RpciA9IG1hbnVhbF9kaXIgPT0gMyBhbmQgMCBvciAzDQogICAgICAgIGxhc3RfcHJlc3NfdCA9IGdsb2JhbHMuY3VydGltZSgpDQogICAgZWxzZWlmIGxhc3RfcHJlc3NfdCA+IGdsb2JhbHMuY3VydGltZSgpIHRoZW4NCiAgICAgICAgbGFzdF9wcmVzc190ID0gZ2xvYmFscy5jdXJ0aW1lKCkNCiAgICBlbmQNCiAgICBpZiB1aS5nZXQoa2V5YmluZHNfdGFiLmZyZWVzdGFuZCkgYW5kIG1hbnVhbF9kaXIgPT0gMCB0aGVuDQoJCXVpLnNldChmcmVlc3RhbmQsIHRydWUpDQogICAgICAgIHVpLnNldChmcmVlc3RhbmRrZXksICJBbHdheXMgb24iKSANCiAgICBlbHNlIA0KCXVpLnNldChmcmVlc3RhbmQsIGZhbHNlKQ0KICAgICAgICB1aS5zZXQoZnJlZXN0YW5ka2V5LCAiT24gaG90a2V5IikgICAgDQoJCWVuZA0KZW5kKQ0KYWJzdG9mbGljayA9IDANCmNsYW1wZXIgPSBmdW5jdGlvbihjb3VudCkNCmlmIGNvdW50ID4gMTgwIHRoZW4gDQpyZXR1cm4gLTE4MCArIChjb3VudCAtIDE4MCkNCmVsc2VpZiBjb3VudCA8IC0xODAgdGhlbg0KcmV0dXJuIDE4MCAtICgtMTgwIC0gY291bnQpDQplbmQNCmVuZA0KDQptYW51YWxfZGlyID0gMA0KY3VycmVudF90aWNrY291bnQgPSAwDQoNCmxvY2FsIHF1aWNrX3BlZWtfYXNzaXN0ID0ge3VpLnJlZmVyZW5jZSgiUkFHRSIsICJPdGhlciIsICJRdWljayBwZWVrIGFzc2lzdCIpfQ0KbG9jYWwgcXVpY2tfcGVla19hc3Npc3RfbW9kZSA9IHt1aS5yZWZlcmVuY2UoIlJBR0UiLCAiT3RoZXIiLCAiUXVpY2sgcGVlayBhc3Npc3QgbW9kZSIpfQ0KDQpicmVha2VyID0gew0KICAgIGRlZmVuc2l2ZSA9IDAsDQogICAgZGVmZW5zaXZlX2NoZWNrID0gMCwNCn0NCnRpY2tiYXNlID0gMA0KY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygicHJlX3ByZWRpY3RfY29tbWFuZCIsIGZ1bmN0aW9uKGNtZCkNCiAgICB0aWNrYmFzZSA9IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9uVGlja0Jhc2UiKQ0KICAgIGJyZWFrZXIuZGVmZW5zaXZlX2NoZWNrID0gbWF0aC5tYXgodGlja2Jhc2UsIGJyZWFrZXIuZGVmZW5zaXZlX2NoZWNrKQ0KICAgIGJyZWFrZXIuZGVmZW5zaXZlID0gYnJlYWtlci5kZWZlbnNpdmVfY2hlY2sgLSB0aWNrYmFzZQ0KZW5kKQ0KDQogICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygibGV2ZWxfaW5pdCIsIGZ1bmN0aW9uKCkNCiAgICAgICAgYnJlYWtlci5kZWZlbnNpdmVfY2hlY2sgPSAwDQogICAgICAgIGZvcnJlYWx0aW1lID0gMA0KICAgIGVuZCkNCg0KZnVuY3Rpb24gbWF0aF9tYXAodmFsdWUsIGluX21pbiwgaW5fbWF4LCBvdXRfbWluLCBvdXRfbWF4KQ0KICAgIHJldHVybiAodmFsdWUgLSBpbl9taW4pICogKG91dF9tYXggLSBvdXRfbWluKSAvIChpbl9tYXggLSBpbl9taW4pICsgb3V0X21pbg0KZW5kDQoNCiAgICBsb2NhbCB3YXlfMyA9IHsNCiAgICAgICAgWzBdID0gLTkwLCANCiAgICAgICAgWzFdID0gMTgwLCANCiAgICAgICAgWzJdID0gOTANCiAgICB9DQogICAgbG9jYWwgd2F5XzUgPSB7DQogICAgICAgIFswXSA9IC05MCwgDQogICAgICAgIFsxXSA9IC00NSwgDQogICAgICAgIFsyXSA9IDE4MCwgDQogICAgICAgIFszXSA9IDQ1LCANCiAgICAgICAgWzRdID0gOTANCiAgICB9DQoNCiAgICB3YXljb3VudCA9IDANCiAgICBzd2l0Y2hkZWYgPSBmYWxzZQ0KY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygic2V0dXBfY29tbWFuZCIsIGZ1bmN0aW9uKGNtZCkNCiAgICBsb2NhbCB0aHJlYXQgPSBjbGllbnQuY3VycmVudF90aHJlYXQoKQ0KICAgIGxvY2FsIGxwID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQ0KICAgIGxvY2FsIG5leHRBdHRhY2sgPSBlbnRpdHkuZ2V0X3Byb3AobHAsICJtX2ZsTmV4dEF0dGFjayIpDQogICAgbG9jYWwgbmV4dFByaW1hcnlBdHRhY2sgPSBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGxwKSwgIm1fZmxOZXh0UHJpbWFyeUF0dGFjayIpDQogICAgbG9jYWwgZHRfYWN0aXZlID0gZmFsc2UNCiAgICBsb2NhbCBkdF90b2dnbGVkID0gdWkuZ2V0KGtleXNmb3JpbmRzLmRvdWJsZXRhcFsxXSkgYW5kIHVpLmdldChrZXlzZm9yaW5kcy5kb3VibGV0YXBbMl0pDQogICAgbG9jYWwgaHNfdG9nZ2xlZCA9IHVpLmdldChrZXlzZm9yaW5kcy5oaWRlc2hvdHNbMV0pIGFuZCB1aS5nZXQoa2V5c2ZvcmluZHMuaGlkZXNob3RzWzJdKQ0KICAgIGlmIG5leHRQcmltYXJ5QXR0YWNrIH49IG5pbCB0aGVuDQogICAgICAgIGR0X2FjdGl2ZSA9IG5vdCAobWF0aC5tYXgobmV4dFByaW1hcnlBdHRhY2ssIG5leHRBdHRhY2spID4gZ2xvYmFscy5jdXJ0aW1lKCkpDQogICAgZW5kDQoNCiAgICBpZiBnbG9iYWxzLmNob2tlZGNvbW1hbmRzKCkgPT0gMCB0aGVuDQogICAgICAgIHN3aXRjaGRlZiA9IG5vdCBzd2l0Y2hkZWYNCiAgICBlbmQNCiAgICANCiAgICBpZiB1aS5nZXQoTWlzYy5ub3dhcm11cGFhKSBhbmQgZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfZ2FtZV9ydWxlcygpLCAibV9iV2FybXVwUGVyaW9kIikgPT0gMSB0aGVuIHVpLnNldChyZWYuYW50aWFpbS5hbnRpX2FpbVsxXSwgZmFsc2UpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLmFudGlfYWltWzFdLCB0cnVlKSBlbmQNCiAgICBkdG1peCA9IChkdF90b2dnbGVkID09IHRydWUgYW5kIGR0X2FjdGl2ZSA9PSB0cnVlKSBvciAoaHNfdG9nZ2xlZCA9PSB0cnVlKQ0KICAgIGV4cGxvaXRpbmcgPSB1aS5nZXQoa2V5c2ZvcmluZHMuZG91YmxldGFwWzFdKSBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmRvdWJsZXRhcFsyXSkgb3IgdWkuZ2V0KGtleXNmb3JpbmRzLmhpZGVzaG90c1sxXSkgYW5kIHVpLmdldChrZXlzZm9yaW5kcy5oaWRlc2hvdHNbMl0pDQogICAgaWYgdWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmRlZmVuc2l2ZV9tb2RlKSA9PSAi4py3ICBPcHRpbWl6ZWQiIHRoZW4NCiAgICAgICAgc3BlZWQxID0gMg0KICAgICAgICBzcGVlZDIgPSAxNQ0KICAgIGVsc2UNCiAgICBzcGVlZDEgPSB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIubWluX3RpY2tfbGVmdCkNCiAgICBzcGVlZDIgPSB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIubWF4X3RpY2tfbGVmdCkNCiAgICBlbmQNCiAgICBpc19kZWZlbnNpdmUgPSB0aWNrYmFzZV9jaGVjayBhbmQgYnJlYWtlci5kZWZlbnNpdmUgPiBzcGVlZDEgYW5kIGJyZWFrZXIuZGVmZW5zaXZlIDwgc3BlZWQyDQogICAgICAgIA0KICAgIGhhbmRsZV9hYSA9IGZ1bmN0aW9uKHBpdGNoLCBwaXRjaHNsaWRlciwgZGVmZW5zaXZlc2xpZGVyMiwgZGVmZW5zaXZlc2xpZGVyMywgYXRfdGFyZ2V0cywgbGVmdF95YXcsIHJpZ2h0X3lhdywgaml0dGVyX21vZGUsIGppdHRlcl9hbW91bnQsIGxieSwgbGJ5c2lkZSwgbGJ5c3BlZWQsIGRlZmVuc2l2ZW9uLCBkZWZlbnNpdmVwaXRjaCwgYV9waXRjaCwgYl9waXRjaCwgZGVmZW5zaXZleWF3LCBhX3lhdywgYl95YXcpDQoNCiAgICBpZiBpbmNsdWRlcyh1aS5nZXQoTWlzYy5mbGlja2V4KSwgIlN0YW5kaW5nIikgYW5kIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiU3RhbmRpbmciIHRoZW4NCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiTWluaW1hbCIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgMCBvciAtMTgwKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiT2ZmIikNCiAgICBlbHNlaWYgaW5jbHVkZXModWkuZ2V0KE1pc2MuZmxpY2tleCksICJNb3ZpbmciKSBhbmQgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJNb3ZpbmciIHRoZW4NCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiTWluaW1hbCIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgMCBvciAtMTgwKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiT2ZmIikNCiAgICBlbHNlaWYgaW5jbHVkZXModWkuZ2V0KE1pc2MuZmxpY2tleCksICJTbG93IFdhbGtpbmciKSBhbmQgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJTbG93IFdhbGtpbmciIHRoZW4NCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiTWluaW1hbCIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgMCBvciAtMTgwKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiT2ZmIikNCiAgICBlbHNlaWYgaW5jbHVkZXModWkuZ2V0KE1pc2MuZmxpY2tleCksICJDcm91Y2hpbmciKSBhbmQgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJDcm91Y2hpbmciIHRoZW4NCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiTWluaW1hbCIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgMCBvciAtMTgwKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiT2ZmIikNCiAgICBlbHNlaWYgaW5jbHVkZXModWkuZ2V0KE1pc2MuZmxpY2tleCksICJJbiBBaXIiKSBhbmQgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJJbiBBaXIiIHRoZW4NCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiTWluaW1hbCIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgMCBvciAtMTgwKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiT2ZmIikNCiAgICBlbHNlaWYgaW5jbHVkZXModWkuZ2V0KE1pc2MuZmxpY2tleCksICJJbiBBaXIgJiBDcm91Y2hpbmciKSBhbmQgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJJbiBBaXIgJiBDcm91Y2hpbmciIHRoZW4NCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiTWluaW1hbCIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgMCBvciAtMTgwKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiT2ZmIikNCg0KICAgIGVsc2VpZiB1aS5nZXQocHJlc2V0X3NlbGVjdG9yKSA9PSAiQ29uZGl0aW9uYWwiIHRoZW4NCg0KICAgICAgICBpZiBwaXRjaCA9PSAiT2ZmIiB0aGVuIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIk9mZiIpIGVsc2VpZiBwaXRjaCA9PSAiQ3VzdG9tIiB0aGVuIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIkN1c3RvbSIpIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgcGl0Y2hzbGlkZXIpIGVsc2VpZiBwaXRjaCA9PSAiRG93biIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJNaW5pbWFsIikgZWxzZSB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sIHBpdGNoKSBlbmQNCiAgICAgICAgaWYgYXRfdGFyZ2V0cyA9PSAiT2ZmIiB0aGVuIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICJPZmYiKSBlbHNlaWYgYXRfdGFyZ2V0cyA9PSAiQXQgVGFyZ2V0IiB0aGVuIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKSB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikgZWxzZWlmIGF0X3RhcmdldHMgPT0gIkJhY2t3YXJkIiB0aGVuIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICIxODAiKSB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJMb2NhbCB2aWV3IikgZW5kDQogICAgICAgIGlmIGppdHRlcl9tb2RlID09ICIzIFdheSIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiU2tpdHRlciIpIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIGppdHRlcl9hbW91bnQpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgaml0dGVyX21vZGUpIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIGppdHRlcl9hbW91bnQpIGVuZA0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmZzX2JvZHlfeWF3LCBmYWxzZSkNCiAgICAgICAgaWYgbGJ5ID09ICJTdGF0aWMiIHRoZW4NCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIlN0YXRpYyIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIGxieXNpZGUpDQogICAgICAgIGVsc2VpZiBsYnkgPT0gIkppdHRlciIgdGhlbiANCg0KICAgICAgICAgICAgaWYgY21kLmNvbW1hbmRfbnVtYmVyID4gY3VycmVudF90aWNrY291bnQgKyAoMCBvciAxKSB0aGVuDQogICAgICAgICAgICAgICAgaWYgY21kLmNob2tlZGNvbW1hbmRzID09IDAgdGhlbg0KICAgICAgICAgICAgICAgICAgICBkZWxheWVkX2ppdHRlciA9IG5vdCBkZWxheWVkX2ppdHRlcg0KICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdGlja2NvdW50ID0gY21kLmNvbW1hbmRfbnVtYmVyDQogICAgICAgICAgICAgICAgICAgY21kLmFsbG93X3NlbmRfcGFja2V0ID0gZmFsc2UNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVsc2VpZiBjbWQuY29tbWFuZF9udW1iZXIgPCBjdXJyZW50X3RpY2tjb3VudCB0aGVuDQogICAgICAgICAgICAgICAgY3VycmVudF90aWNrY291bnQgPSBjbWQuY29tbWFuZF9udW1iZXINCiAgICAgICAgICAgIGVuZA0KDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJTdGF0aWMiKQ0KICAgICAgICAgICAgaWYgZGVsYXllZF9qaXR0ZXIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIC0xKSBlbHNlIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgMSkgZW5kDQogICAgICAgIGVsc2VpZiBsYnkgPT0gIm1lZ2FtaXgiIHRoZW4gDQoNCiAgICAgICAgICAgIGlmIG1hdGgucmFuZG9tKDAsMykgPT0gMyB0aGVuDQogICAgICAgICAgICAgICAgcmFuc3NzID0gbWF0aC5yYW5kb20oMTAsMjApDQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgcmFuc3NzID0gbWF0aC5yYW5kb20oMCw0KQ0KICAgICAgICAgICAgZW5kDQoNCiAgICAgICAgICAgIGlmIGNtZC5jb21tYW5kX251bWJlciA+IGN1cnJlbnRfdGlja2NvdW50ICsgcmFuc3NzIHRoZW4NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiBjbWQuY2hva2VkY29tbWFuZHMgPT0gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgIGRlbGF5ZWRfaml0dGVyID0gbm90IGRlbGF5ZWRfaml0dGVyDQogICAgICAgICAgICAgICAgICAgY3VycmVudF90aWNrY291bnQgPSBjbWQuY29tbWFuZF9udW1iZXINCiAgICAgICAgICAgICAgICAgICBjbWQuYWxsb3dfc2VuZF9wYWNrZXQgPSBmYWxzZQ0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZWxzZWlmIGNtZC5jb21tYW5kX251bWJlciA8IGN1cnJlbnRfdGlja2NvdW50IHRoZW4NCiAgICAgICAgICAgICAgICBjdXJyZW50X3RpY2tjb3VudCA9IGNtZC5jb21tYW5kX251bWJlcg0KICAgICAgICAgICAgZW5kDQoNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIlN0YXRpYyIpDQogICAgICAgICAgICBpZiBkZWxheWVkX2ppdHRlciB0aGVuIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgLTEpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAxKSBlbmQNCiAgICAgICAgZWxzZWlmIGxieSA9PSAiRGVsYXllZCIgdGhlbg0KICAgICAgICAgICAgaWYgY21kLmNvbW1hbmRfbnVtYmVyID4gY3VycmVudF90aWNrY291bnQgKyBsYnlzcGVlZCB0aGVuDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgY21kLmNob2tlZGNvbW1hbmRzID09IDAgdGhlbg0KICAgICAgICAgICAgICAgICAgICBkZWxheWVkX2ppdHRlciA9IG5vdCBkZWxheWVkX2ppdHRlcg0KICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdGlja2NvdW50ID0gY21kLmNvbW1hbmRfbnVtYmVyDQogICAgICAgICAgICAgICAgICAgY21kLmFsbG93X3NlbmRfcGFja2V0ID0gZmFsc2UNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVsc2VpZiBjbWQuY29tbWFuZF9udW1iZXIgPCBjdXJyZW50X3RpY2tjb3VudCB0aGVuDQogICAgICAgICAgICAgICAgY3VycmVudF90aWNrY291bnQgPSBjbWQuY29tbWFuZF9udW1iZXINCiAgICAgICAgICAgIGVuZA0KDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJTdGF0aWMiKQ0KICAgICAgICAgICAgaWYgZGVsYXllZF9qaXR0ZXIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIC0xKSBlbHNlIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgMSkgZW5kDQogICAgICAgIGVsc2VpZiBsYnkgPT0gIk9mZiIgdGhlbg0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiT2ZmIikNCiAgICAgICAgZW5kDQoNCiAgICAgICAgaWYgZGVsYXllZF9qaXR0ZXIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCBsZWZ0X3lhdykgZWxzZSB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCByaWdodF95YXcpIGVuZA0KDQogICAgICAgIGlmIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5leHRyYV9vcHRpb24pLCAi4piBIEZha2UgTGFnIEFsdGVybmF0aXZlIikgYW5kIG5vdCAoKGluY2x1ZGVzKHVpLmdldChNaXNjLmRpc2FibGVmbCksICJEb3VibGUgVGFwIikgYW5kIHVpLmdldChrZXlzZm9yaW5kcy5kb3VibGV0YXBbMV0pIGFuZCB1aS5nZXQoa2V5c2ZvcmluZHMuZG91YmxldGFwWzJdKSkgb3IgKGluY2x1ZGVzKHVpLmdldChNaXNjLmRpc2FibGVmbCksICJIaWRlIFNob3RzIikgYW5kIHVpLmdldChrZXlzZm9yaW5kcy5oaWRlc2hvdHNbMV0pIGFuZCB1aS5nZXQoa2V5c2ZvcmluZHMuaGlkZXNob3RzWzJdKSkgb3IgKGluY2x1ZGVzKHVpLmdldChNaXNjLmRpc2FibGVmbCksICJTdGFuZGluZyIpIGFuZCBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIlN0YW5kaW5nIikgb3IgKGluY2x1ZGVzKHVpLmdldChNaXNjLmRpc2FibGVmbCksICJEVCBLbmlmZSIpIGFuZCBlbnRpdHkuZ2V0X2NsYXNzbmFtZShlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkpID09ICJDS25pZmUiIGFuZCB1aS5nZXQoa2V5c2ZvcmluZHMuZG91YmxldGFwWzFdKSBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmRvdWJsZXRhcFsyXSkpKSB0aGVuDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uZmFrZWxhZ2VuYWJsZWRbMV0sIHRydWUpDQogICAgICAgICAgICBpZiB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ19tb2RlKSA9PSAiU3dpdGNoIiB0aGVuDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uZmFrZWxhZ2Ftb3VudFsxXSwgIkZsdWN0dWF0ZSIpDQogICAgICAgICAgICB1aS5zZXQoc2tlZXRmYWtlbGFnbGltaXQsIGdsb2JhbHMudGlja2NvdW50KCkgJSAyMCA+IDEwIGFuZCB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ19maXJzdCkgb3IgdWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZha2VsYWdfc2Vjb25kKSkNCiAgICAgICAgICAgIHVpLnNldChza2VldGZha2VsYWd2YXJpYW5jZSwgdWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZha2VsYWdfdmFyb3VzKSkNCiAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ19tb2RlKSA9PSAiUmFuZG9tIiB0aGVuDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uZmFrZWxhZ2Ftb3VudFsxXSwgIkZsdWN0dWF0ZSIpDQogICAgICAgICAgICB1aS5zZXQoc2tlZXRmYWtlbGFnbGltaXQsIG1hdGgucmFuZG9tKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mYWtlbGFnX2ZpcnN0KSBvciB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ19zZWNvbmQpLCB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ19zZWNvbmQpIG9yIHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mYWtlbGFnX2ZpcnN0KSkpDQogICAgICAgICAgICB1aS5zZXQoc2tlZXRmYWtlbGFndmFyaWFuY2UsIHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mYWtlbGFnX3Zhcm91cykpDQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uZmFrZWxhZ2Ftb3VudFsxXSwgdWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZha2VsYWdfbW9kZSkpDQogICAgICAgICAgICB1aS5zZXQoc2tlZXRmYWtlbGFnbGltaXQsIHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mYWtlbGFnX2ZpcnN0KSkNCiAgICAgICAgICAgIHVpLnNldChza2VldGZha2VsYWd2YXJpYW5jZSwgdWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZha2VsYWdfdmFyb3VzKSkNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbHNlDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uZmFrZWxhZ2VuYWJsZWRbMV0sIGZhbHNlKQ0KICAgICAgICBlbmQNCiAgICBlbHNlaWYgdWkuZ2V0KHByZXNldF9zZWxlY3RvcikgPT0gIkNsYXNzaWMgSml0dGVyIChmb3IgMngyIHRvdXJuYW1lbnRzKSIgdGhlbg0KICAgICAgICBpZiBpbmNsdWRlcyh1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZXh0cmFfb3B0aW9uKSwgIuKYgSBGYWtlIExhZyBBbHRlcm5hdGl2ZSIpIGFuZCBub3QgKChpbmNsdWRlcyh1aS5nZXQoTWlzYy5kaXNhYmxlZmwpLCAiRG91YmxlIFRhcCIpIGFuZCB1aS5nZXQoa2V5c2ZvcmluZHMuZG91YmxldGFwWzFdKSBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmRvdWJsZXRhcFsyXSkpIG9yIChpbmNsdWRlcyh1aS5nZXQoTWlzYy5kaXNhYmxlZmwpLCAiSGlkZSBTaG90cyIpIGFuZCB1aS5nZXQoa2V5c2ZvcmluZHMuaGlkZXNob3RzWzFdKSBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmhpZGVzaG90c1syXSkpIG9yIChpbmNsdWRlcyh1aS5nZXQoTWlzYy5kaXNhYmxlZmwpLCAiU3RhbmRpbmciKSBhbmQgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJTdGFuZGluZyIpIG9yIChpbmNsdWRlcyh1aS5nZXQoTWlzYy5kaXNhYmxlZmwpLCAiRFQgS25pZmUiKSBhbmQgZW50aXR5LmdldF9jbGFzc25hbWUoZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpKSA9PSAiQ0tuaWZlIiBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmRvdWJsZXRhcFsxXSkgYW5kIHVpLmdldChrZXlzZm9yaW5kcy5kb3VibGV0YXBbMl0pKSkgdGhlbg0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmZha2VsYWdlbmFibGVkWzFdLCB0cnVlKQ0KICAgICAgICAgICAgaWYgdWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZha2VsYWdfbW9kZSkgPT0gIlN3aXRjaCIgdGhlbg0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmZha2VsYWdhbW91bnRbMV0sICJGbHVjdHVhdGUiKQ0KICAgICAgICAgICAgdWkuc2V0KHNrZWV0ZmFrZWxhZ2xpbWl0LCBnbG9iYWxzLnRpY2tjb3VudCgpICUgMjAgPiAxMCBhbmQgdWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZha2VsYWdfZmlyc3QpIG9yIHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mYWtlbGFnX3NlY29uZCkpDQogICAgICAgICAgICB1aS5zZXQoc2tlZXRmYWtlbGFndmFyaWFuY2UsIHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mYWtlbGFnX3Zhcm91cykpDQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZha2VsYWdfbW9kZSkgPT0gIlJhbmRvbSIgdGhlbg0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmZha2VsYWdhbW91bnRbMV0sICJGbHVjdHVhdGUiKQ0KICAgICAgICAgICAgdWkuc2V0KHNrZWV0ZmFrZWxhZ2xpbWl0LCBtYXRoLnJhbmRvbSh1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ19maXJzdCksIHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mYWtlbGFnX3NlY29uZCkpKQ0KICAgICAgICAgICAgdWkuc2V0KHNrZWV0ZmFrZWxhZ3ZhcmlhbmNlLCB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ192YXJvdXMpKQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmZha2VsYWdhbW91bnRbMV0sIHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mYWtlbGFnX21vZGUpKQ0KICAgICAgICAgICAgdWkuc2V0KHNrZWV0ZmFrZWxhZ2xpbWl0LCB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ19maXJzdCkpDQogICAgICAgICAgICB1aS5zZXQoc2tlZXRmYWtlbGFndmFyaWFuY2UsIHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mYWtlbGFnX3Zhcm91cykpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmZha2VsYWdlbmFibGVkWzFdLCBmYWxzZSkNCiAgICAgICAgZW5kDQoNCiAgICAgICAgaWYgZ2xvYmFscy50aWNrY291bnQoKSAlIDEwID4gMiB0aGVuIHNwX2ppdHRlciA9IDEgZWxzZSBzcF9qaXR0ZXIgPSAyMCBlbmQNCg0KICAgICAgICBpZiBjbWQuY29tbWFuZF9udW1iZXIgPiBjdXJyZW50X3RpY2tjb3VudCArIHNwX2ppdHRlciB0aGVuDQogICAgICAgICAgICBpZiBjbWQuY2hva2VkY29tbWFuZHMgPT0gMCB0aGVuDQogICAgICAgICAgICAgICAgZGVsYXllZF9qaXR0ZXIgPSBub3QgZGVsYXllZF9qaXR0ZXINCiAgICAgICAgICAgICAgIGN1cnJlbnRfdGlja2NvdW50ID0gY21kLmNvbW1hbmRfbnVtYmVyDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZWlmIGNtZC5jb21tYW5kX251bWJlciA8IGN1cnJlbnRfdGlja2NvdW50IHRoZW4NCiAgICAgICAgICAgIGN1cnJlbnRfdGlja2NvdW50ID0gY21kLmNvbW1hbmRfbnVtYmVyDQogICAgICAgIGVuZA0KDQogICAgICAgIGlmIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiQ3JvdWNoaW5nIiB0aGVuDQogICAgICAgIGlmIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mb3JjZV9sYyksICJDcm91Y2hpbmciKSBhbmQgaXNfZGVmZW5zaXZlIHRoZW4gY21kLmZvcmNlX2RlZmVuc2l2ZSA9IHRydWUgZW5kDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIk1pbmltYWwiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJBdCB0YXJnZXRzIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIlN0YXRpYyIpDQogICAgICAgIGlmIGRlbGF5ZWRfaml0dGVyIHRoZW4gdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAtMSkgZWxzZSB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIDEpIGVuZA0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgaWYgZGVsYXllZF9qaXR0ZXIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAtMjUpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgMjkpIGVuZA0KICAgICAgICBlbHNlaWYgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJTdGFuZGluZyIgdGhlbg0KICAgICAgICAgICAgaWYgaW5jbHVkZXModWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZvcmNlX2xjKSwgIlN0YW5kaW5nIikgYW5kIGlzX2RlZmVuc2l2ZSB0aGVuIGNtZC5mb3JjZV9kZWZlbnNpdmUgPSB0cnVlIGVuZA0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiTWluaW1hbCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJBdCB0YXJnZXRzIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIlN0YXRpYyIpDQogICAgICAgICAgICBpZiBkZWxheWVkX2ppdHRlciB0aGVuIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgLTEpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAxKSBlbmQNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICIxODAiKQ0KICAgICAgICAgICAgaWYgZGVsYXllZF9qaXR0ZXIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAtMjMpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgMzkpIGVuZA0KICAgICAgICBlbHNlaWYgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJTbG93IFdhbGtpbmciIHRoZW4NCiAgICAgICAgICAgIGlmIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mb3JjZV9sYyksICJTbG93IFdhbGtpbmciKSBhbmQgaXNfZGVmZW5zaXZlIHRoZW4gY21kLmZvcmNlX2RlZmVuc2l2ZSA9IHRydWUgZW5kDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJNaW5pbWFsIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiU3RhdGljIikNCiAgICAgICAgICAgIGlmIGRlbGF5ZWRfaml0dGVyIHRoZW4gdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAtMSkgZWxzZSB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIDEpIGVuZA0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICBpZiBkZWxheWVkX2ppdHRlciB0aGVuIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIC0zNSkgZWxzZSB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCA0NSkgZW5kDQogICAgICAgIGVsc2VpZiBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIk1vdmluZyIgdGhlbg0KICAgICAgICAgICAgaWYgaW5jbHVkZXModWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZvcmNlX2xjKSwgIk1vdmluZyIpIGFuZCBpc19kZWZlbnNpdmUgdGhlbiBjbWQuZm9yY2VfZGVmZW5zaXZlID0gdHJ1ZSBlbmQNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIk1pbmltYWwiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJTdGF0aWMiKQ0KICAgICAgICAgICAgaWYgZGVsYXllZF9qaXR0ZXIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIC0xKSBlbHNlIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgMSkgZW5kDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgICAgIGlmIGRlbGF5ZWRfaml0dGVyIHRoZW4gdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgLTI2KSBlbHNlIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIDQ2KSBlbmQNCiAgICAgICAgZWxzZWlmIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiSW4gQWlyIiB0aGVuDQogICAgICAgICAgICBpZiBpbmNsdWRlcyh1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZm9yY2VfbGMpLCAiSW4gQWlyIikgYW5kIGlzX2RlZmVuc2l2ZSB0aGVuIGNtZC5mb3JjZV9kZWZlbnNpdmUgPSB0cnVlIGVuZA0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiTWluaW1hbCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJBdCB0YXJnZXRzIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIlN0YXRpYyIpDQogICAgICAgICAgICBpZiBkZWxheWVkX2ppdHRlciB0aGVuIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgLTEpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAxKSBlbmQNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICIxODAiKQ0KICAgICAgICAgICAgaWYgZGVsYXllZF9qaXR0ZXIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAtMTApIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgMjkpIGVuZA0KICAgICAgICBlbHNlaWYgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJJbiBBaXIgJiBDcm91Y2hpbmciIHRoZW4NCiAgICAgICAgICAgIGlmIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mb3JjZV9sYyksICJJbiBBaXIgJiBDcm91Y2hpbmciKSBhbmQgaXNfZGVmZW5zaXZlIHRoZW4gY21kLmZvcmNlX2RlZmVuc2l2ZSA9IHRydWUgZW5kDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJNaW5pbWFsIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiU3RhdGljIikNCiAgICAgICAgICAgIGlmIGRlbGF5ZWRfaml0dGVyIHRoZW4gdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAtMSkgZWxzZSB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIDEpIGVuZA0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICBpZiBkZWxheWVkX2ppdHRlciB0aGVuIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIC0zMCkgZWxzZSB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCA0MSkgZW5kDQogICAgICAgIGVsc2VpZiBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIkZha2UgTGFnIiB0aGVuDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJNaW5pbWFsIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIkNlbnRlciIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAzMikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIlN0YXRpYyIpDQogICAgICAgICAgICBpZiBkZWxheWVkX2ppdHRlciB0aGVuIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgLTEpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAxKSBlbmQNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICIxODAiKQ0KICAgICAgICAgICAgaWYgZGVsYXllZF9qaXR0ZXIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAtMTQpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgMjgpIGVuZA0KICAgICAgICBlbmQNCiAgICANCg0KICAgIGVsc2VpZiB1aS5nZXQocHJlc2V0X3NlbGVjdG9yKSA9PSAiRGVsYXllZCBKaXR0ZXIiIHRoZW4NCiAgICAgICAgaWYgaW5jbHVkZXModWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmV4dHJhX29wdGlvbiksICLimIEgRmFrZSBMYWcgQWx0ZXJuYXRpdmUiKSBhbmQgbm90ICgoaW5jbHVkZXModWkuZ2V0KE1pc2MuZGlzYWJsZWZsKSwgIkRvdWJsZSBUYXAiKSBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmRvdWJsZXRhcFsxXSkgYW5kIHVpLmdldChrZXlzZm9yaW5kcy5kb3VibGV0YXBbMl0pKSBvciAoaW5jbHVkZXModWkuZ2V0KE1pc2MuZGlzYWJsZWZsKSwgIkhpZGUgU2hvdHMiKSBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmhpZGVzaG90c1sxXSkgYW5kIHVpLmdldChrZXlzZm9yaW5kcy5oaWRlc2hvdHNbMl0pKSBvciAoaW5jbHVkZXModWkuZ2V0KE1pc2MuZGlzYWJsZWZsKSwgIlN0YW5kaW5nIikgYW5kIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiU3RhbmRpbmciKSBvciAoaW5jbHVkZXModWkuZ2V0KE1pc2MuZGlzYWJsZWZsKSwgIkRUIEtuaWZlIikgYW5kIGVudGl0eS5nZXRfY2xhc3NuYW1lKGVudGl0eS5nZXRfcGxheWVyX3dlYXBvbihlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSkgPT0gIkNLbmlmZSIgYW5kIHVpLmdldChrZXlzZm9yaW5kcy5kb3VibGV0YXBbMV0pIGFuZCB1aS5nZXQoa2V5c2ZvcmluZHMuZG91YmxldGFwWzJdKSkpIHRoZW4NCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5mYWtlbGFnZW5hYmxlZFsxXSwgdHJ1ZSkNCiAgICAgICAgICAgIGlmIHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mYWtlbGFnX21vZGUpID09ICJTd2l0Y2giIHRoZW4NCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5mYWtlbGFnYW1vdW50WzFdLCAiRmx1Y3R1YXRlIikNCiAgICAgICAgICAgIHVpLnNldChza2VldGZha2VsYWdsaW1pdCwgZ2xvYmFscy50aWNrY291bnQoKSAlIDIwID4gMTAgYW5kIHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mYWtlbGFnX2ZpcnN0KSBvciB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ19zZWNvbmQpKQ0KICAgICAgICAgICAgdWkuc2V0KHNrZWV0ZmFrZWxhZ3ZhcmlhbmNlLCB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ192YXJvdXMpKQ0KICAgICAgICAgICAgZWxzZWlmIHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mYWtlbGFnX21vZGUpID09ICJSYW5kb20iIHRoZW4NCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5mYWtlbGFnYW1vdW50WzFdLCAiRmx1Y3R1YXRlIikNCiAgICAgICAgICAgIHVpLnNldChza2VldGZha2VsYWdsaW1pdCwgbWF0aC5yYW5kb20odWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZha2VsYWdfZmlyc3QpLCB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ19zZWNvbmQpKSkNCiAgICAgICAgICAgIHVpLnNldChza2VldGZha2VsYWd2YXJpYW5jZSwgdWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZha2VsYWdfdmFyb3VzKSkNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5mYWtlbGFnYW1vdW50WzFdLCB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ19tb2RlKSkNCiAgICAgICAgICAgIHVpLnNldChza2VldGZha2VsYWdsaW1pdCwgdWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZha2VsYWdfZmlyc3QpKQ0KICAgICAgICAgICAgdWkuc2V0KHNrZWV0ZmFrZWxhZ3ZhcmlhbmNlLCB1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZmFrZWxhZ192YXJvdXMpKQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5mYWtlbGFnZW5hYmxlZFsxXSwgZmFsc2UpDQogICAgICAgIGVuZA0KDQogICAgICAgIGlmIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiQ3JvdWNoaW5nIiB0aGVuDQogICAgICAgIGlmIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mb3JjZV9sYyksICJDcm91Y2hpbmciKSB0aGVuIGNtZC5mb3JjZV9kZWZlbnNpdmUgPSB0cnVlIGVuZA0KICAgICAgICBpZiBjbWQuY29tbWFuZF9udW1iZXIgPiBjdXJyZW50X3RpY2tjb3VudCArIDE1IHRoZW4NCiAgICAgICAgICAgIGlmIGNtZC5jaG9rZWRjb21tYW5kcyA9PSAwIHRoZW4NCiAgICAgICAgICAgICAgICBkZWxheWVkX2ppdHRlciA9IG5vdCBkZWxheWVkX2ppdHRlcg0KICAgICAgICAgICAgICAgY3VycmVudF90aWNrY291bnQgPSBjbWQuY29tbWFuZF9udW1iZXINCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbHNlaWYgY21kLmNvbW1hbmRfbnVtYmVyIDwgY3VycmVudF90aWNrY291bnQgdGhlbg0KICAgICAgICAgICAgY3VycmVudF90aWNrY291bnQgPSBjbWQuY29tbWFuZF9udW1iZXINCiAgICAgICAgZW5kDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIk1pbmltYWwiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJBdCB0YXJnZXRzIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIlN0YXRpYyIpDQogICAgICAgIGlmIGRlbGF5ZWRfaml0dGVyIHRoZW4gdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAtMSkgZWxzZSB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIDEpIGVuZA0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgaWYgZGVsYXllZF9qaXR0ZXIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAtMzcpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgMzcpIGVuZA0KICAgICAgICBlbHNlaWYgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJTdGFuZGluZyIgdGhlbg0KICAgICAgICAgICAgaWYgaW5jbHVkZXModWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZvcmNlX2xjKSwgIlN0YW5kaW5nIikgdGhlbiBjbWQuZm9yY2VfZGVmZW5zaXZlID0gdHJ1ZSBlbmQNCiAgICAgICAgICAgIGlmIGNtZC5jb21tYW5kX251bWJlciA+IGN1cnJlbnRfdGlja2NvdW50ICsgMTIgdGhlbg0KICAgICAgICAgICAgICAgIGlmIGNtZC5jaG9rZWRjb21tYW5kcyA9PSAwIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgZGVsYXllZF9qaXR0ZXIgPSBub3QgZGVsYXllZF9qaXR0ZXINCiAgICAgICAgICAgICAgICAgICBjdXJyZW50X3RpY2tjb3VudCA9IGNtZC5jb21tYW5kX251bWJlcg0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZWxzZWlmIGNtZC5jb21tYW5kX251bWJlciA8IGN1cnJlbnRfdGlja2NvdW50IHRoZW4NCiAgICAgICAgICAgICAgICBjdXJyZW50X3RpY2tjb3VudCA9IGNtZC5jb21tYW5kX251bWJlcg0KICAgICAgICAgICAgZW5kDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJNaW5pbWFsIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiU3RhdGljIikNCiAgICAgICAgICAgIGlmIGRlbGF5ZWRfaml0dGVyIHRoZW4gdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAtMSkgZWxzZSB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIDEpIGVuZA0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICBpZiBkZWxheWVkX2ppdHRlciB0aGVuIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIC0xOCkgZWxzZSB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAzMikgZW5kDQogICAgICAgIGVsc2VpZiBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIlNsb3cgV2Fsa2luZyIgdGhlbg0KICAgICAgICAgICAgaWYgaW5jbHVkZXModWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZvcmNlX2xjKSwgIlNsb3cgV2Fsa2luZyIpIHRoZW4gY21kLmZvcmNlX2RlZmVuc2l2ZSA9IHRydWUgZW5kDQogICAgICAgICAgICBpZiBjbWQuY29tbWFuZF9udW1iZXIgPiBjdXJyZW50X3RpY2tjb3VudCArIDExIHRoZW4NCiAgICAgICAgICAgICAgICBpZiBjbWQuY2hva2VkY29tbWFuZHMgPT0gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgIGRlbGF5ZWRfaml0dGVyID0gbm90IGRlbGF5ZWRfaml0dGVyDQogICAgICAgICAgICAgICAgICAgY3VycmVudF90aWNrY291bnQgPSBjbWQuY29tbWFuZF9udW1iZXINCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVsc2VpZiBjbWQuY29tbWFuZF9udW1iZXIgPCBjdXJyZW50X3RpY2tjb3VudCB0aGVuDQogICAgICAgICAgICAgICAgY3VycmVudF90aWNrY291bnQgPSBjbWQuY29tbWFuZF9udW1iZXINCiAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiTWluaW1hbCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJBdCB0YXJnZXRzIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIlN0YXRpYyIpDQogICAgICAgICAgICBpZiBkZWxheWVkX2ppdHRlciB0aGVuIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgLTEpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAxKSBlbmQNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICIxODAiKQ0KICAgICAgICAgICAgaWYgZGVsYXllZF9qaXR0ZXIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAtMjUpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgNDUpIGVuZA0KICAgICAgICBlbHNlaWYgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJNb3ZpbmciIHRoZW4NCiAgICAgICAgICAgIGlmIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mb3JjZV9sYyksICJNb3ZpbmciKSB0aGVuIGNtZC5mb3JjZV9kZWZlbnNpdmUgPSB0cnVlIGVuZA0KICAgICAgICAgICAgaWYgY21kLmNvbW1hbmRfbnVtYmVyID4gY3VycmVudF90aWNrY291bnQgKyA5IHRoZW4NCiAgICAgICAgICAgICAgICBpZiBjbWQuY2hva2VkY29tbWFuZHMgPT0gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgIGRlbGF5ZWRfaml0dGVyID0gbm90IGRlbGF5ZWRfaml0dGVyDQogICAgICAgICAgICAgICAgICAgY3VycmVudF90aWNrY291bnQgPSBjbWQuY29tbWFuZF9udW1iZXINCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVsc2VpZiBjbWQuY29tbWFuZF9udW1iZXIgPCBjdXJyZW50X3RpY2tjb3VudCB0aGVuDQogICAgICAgICAgICAgICAgY3VycmVudF90aWNrY291bnQgPSBjbWQuY29tbWFuZF9udW1iZXINCiAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiTWluaW1hbCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJBdCB0YXJnZXRzIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIlN0YXRpYyIpDQogICAgICAgICAgICBpZiBkZWxheWVkX2ppdHRlciB0aGVuIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgLTEpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAxKSBlbmQNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICIxODAiKQ0KICAgICAgICAgICAgaWYgZGVsYXllZF9qaXR0ZXIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAtMjEpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgMzkpIGVuZA0KICAgICAgICBlbHNlaWYgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJJbiBBaXIiIHRoZW4NCiAgICAgICAgICAgIGlmIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mb3JjZV9sYyksICJJbiBBaXIiKSB0aGVuIGNtZC5mb3JjZV9kZWZlbnNpdmUgPSB0cnVlIGVuZA0KICAgICAgICAgICAgaWYgY21kLmNvbW1hbmRfbnVtYmVyID4gY3VycmVudF90aWNrY291bnQgKyAxNCB0aGVuDQogICAgICAgICAgICAgICAgaWYgY21kLmNob2tlZGNvbW1hbmRzID09IDAgdGhlbg0KICAgICAgICAgICAgICAgICAgICBkZWxheWVkX2ppdHRlciA9IG5vdCBkZWxheWVkX2ppdHRlcg0KICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdGlja2NvdW50ID0gY21kLmNvbW1hbmRfbnVtYmVyDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbHNlaWYgY21kLmNvbW1hbmRfbnVtYmVyIDwgY3VycmVudF90aWNrY291bnQgdGhlbg0KICAgICAgICAgICAgICAgIGN1cnJlbnRfdGlja2NvdW50ID0gY21kLmNvbW1hbmRfbnVtYmVyDQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIk1pbmltYWwiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJTdGF0aWMiKQ0KICAgICAgICAgICAgaWYgZGVsYXllZF9qaXR0ZXIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIC0xKSBlbHNlIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgMSkgZW5kDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgICAgIGlmIGRlbGF5ZWRfaml0dGVyIHRoZW4gdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgLTE5KSBlbHNlIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIDM3KSBlbmQNCiAgICAgICAgZWxzZWlmIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiSW4gQWlyICYgQ3JvdWNoaW5nIiB0aGVuDQogICAgICAgICAgICBpZiBpbmNsdWRlcyh1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZm9yY2VfbGMpLCAiSW4gQWlyICYgQ3JvdWNoaW5nIikgdGhlbiBjbWQuZm9yY2VfZGVmZW5zaXZlID0gdHJ1ZSBlbmQNCiAgICAgICAgICAgIGlmIGNtZC5jb21tYW5kX251bWJlciA+IGN1cnJlbnRfdGlja2NvdW50ICsgNyB0aGVuDQogICAgICAgICAgICAgICAgaWYgY21kLmNob2tlZGNvbW1hbmRzID09IDAgdGhlbg0KICAgICAgICAgICAgICAgICAgICBkZWxheWVkX2ppdHRlciA9IG5vdCBkZWxheWVkX2ppdHRlcg0KICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdGlja2NvdW50ID0gY21kLmNvbW1hbmRfbnVtYmVyDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbHNlaWYgY21kLmNvbW1hbmRfbnVtYmVyIDwgY3VycmVudF90aWNrY291bnQgdGhlbg0KICAgICAgICAgICAgICAgIGN1cnJlbnRfdGlja2NvdW50ID0gY21kLmNvbW1hbmRfbnVtYmVyDQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIk1pbmltYWwiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJTdGF0aWMiKQ0KICAgICAgICAgICAgaWYgZGVsYXllZF9qaXR0ZXIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIC0xKSBlbHNlIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgMSkgZW5kDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgICAgIGlmIGRlbGF5ZWRfaml0dGVyIHRoZW4gdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgLTI2KSBlbHNlIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIDUxKSBlbmQNCiAgICAgICAgZWxzZWlmIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiRmFrZSBMYWciIHRoZW4NCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIk1pbmltYWwiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiQ2VudGVyIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDMyKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiU3RhdGljIikNCiAgICAgICAgICAgIGlmIGRlbGF5ZWRfaml0dGVyIHRoZW4gdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAtMSkgZWxzZSB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIDEpIGVuZA0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICBpZiBkZWxheWVkX2ppdHRlciB0aGVuIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIC0xNCkgZWxzZSB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAyOCkgZW5kDQogICAgICAgIGVuZA0KDQoNCiAgICBlbmQNCg0KICAgICAgICAtLSBEZWZlbnNpdmUgQUENCiAgICAgICAgaWYgaW5jbHVkZXModWkuZ2V0KE1pc2MuZmxpY2tleCksICJTdGFuZGluZyIpIGFuZCBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIlN0YW5kaW5nIiBhbmQgaXNfZGVmZW5zaXZlIHRoZW4NCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIkN1c3RvbSIpDQogICAgICAgICAgICBpZiB1aS5nZXQoTWlzYy5mbGlja3lhdykgPT0gIlplcm8iIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIDApDQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2twaXRjaCkgPT0gIlVwIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCAtODkpDQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2twaXRjaCkgPT0gIkRvd24iIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIDg5KQ0KICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNrcGl0Y2gpID09ICJSYW5kb20iIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIG1hdGgucmFuZG9tKC04OSwgODkpKQ0KICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNrcGl0Y2gpID09ICJQQUtFVEEiIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIG1hdGhfbWFwKG1hdGguYWJzKGdsb2JhbHMucmVhbHRpbWUoKSAlIDAuMyAtIDAuMTUpLCAwLCAwLjE1LCAtODksIDg5KSkNCiAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoTWlzYy5mbGlja3BpdGNoKSA9PSAiU2VtaS1VcCIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgLTQ1KQ0KICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNrcGl0Y2gpID09ICJTZW1pLURvd24iIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIDQ1KQ0KICAgICAgICAgICAgZW5kDQoNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICBpZiB1aS5nZXQoTWlzYy5mbGlja3lhdykgPT0gIlN0YXRpYyIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIDEwMCBvciAtMTAwKQ0KICAgICAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoTWlzYy5mbGlja3lhdykgPT0gIlJhbmRvbSIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIChtYXRoLnJhbmRvbSg3MCwgMTAwKSkgb3IgLShtYXRoLnJhbmRvbSg3MCwgMTAwKSkpDQogICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNreWF3KSA9PSAiSml0dGVyIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgKGdsb2JhbHMudGlja2NvdW50KCkgJSA0ID4gMSBhbmQgNzAgb3IgMTEwKSBvciAoZ2xvYmFscy50aWNrY291bnQoKSAlIDQgPiAxIGFuZCAtNzAgb3IgLTExMCkpDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJPZmYiKQ0KICAgICAgICBlbHNlaWYgaW5jbHVkZXModWkuZ2V0KE1pc2MuZmxpY2tleCksICJNb3ZpbmciKSBhbmQgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJNb3ZpbmciIGFuZCBpc19kZWZlbnNpdmUgdGhlbg0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiQ3VzdG9tIikNCiAgICAgICAgICAgIGlmIHVpLmdldChNaXNjLmZsaWNreWF3KSA9PSAiWmVybyIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgMCkNCiAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoTWlzYy5mbGlja3BpdGNoKSA9PSAiVXAiIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIC04OSkNCiAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoTWlzYy5mbGlja3BpdGNoKSA9PSAiRG93biIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgODkpDQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2twaXRjaCkgPT0gIlJhbmRvbSIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgbWF0aC5yYW5kb20oLTg5LCA4OSkpDQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2twaXRjaCkgPT0gIlBBS0VUQSIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgbWF0aF9tYXAobWF0aC5hYnMoZ2xvYmFscy5yZWFsdGltZSgpICUgMC4zIC0gMC4xNSksIDAsIDAuMTUsIC04OSwgODkpKQ0KICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNrcGl0Y2gpID09ICJTZW1pLVVwIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCAtNDUpDQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2twaXRjaCkgPT0gIlNlbWktRG93biIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgNDUpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICBpZiB1aS5nZXQoTWlzYy5mbGlja3lhdykgPT0gIlN0YXRpYyIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIDkwIG9yIC05MCkNCiAgICAgICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2t5YXcpID09ICJSYW5kb20iIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAobWF0aC5yYW5kb20oNzAsIDEwMCkpIG9yIC0obWF0aC5yYW5kb20oNzAsIDEwMCkpKQ0KICAgICAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoTWlzYy5mbGlja3lhdykgPT0gIkppdHRlciIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIChnbG9iYWxzLnRpY2tjb3VudCgpICUgNCA+IDEgYW5kIDcwIG9yIDExMCkgb3IgKGdsb2JhbHMudGlja2NvdW50KCkgJSA0ID4gMSBhbmQgLTcwIG9yIC0xMTApKQ0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiT2ZmIikNCiAgICAgICAgZWxzZWlmIGluY2x1ZGVzKHVpLmdldChNaXNjLmZsaWNrZXgpLCAiU2xvdyBXYWxraW5nIikgYW5kIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiU2xvdyBXYWxraW5nIiBhbmQgaXNfZGVmZW5zaXZlIHRoZW4NCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIkN1c3RvbSIpDQogICAgICAgICAgICBpZiB1aS5nZXQoTWlzYy5mbGlja3lhdykgPT0gIlplcm8iIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIDApDQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2twaXRjaCkgPT0gIlVwIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCAtODkpDQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2twaXRjaCkgPT0gIkRvd24iIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIDg5KQ0KICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNrcGl0Y2gpID09ICJSYW5kb20iIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIG1hdGgucmFuZG9tKC04OSwgODkpKQ0KICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNrcGl0Y2gpID09ICJQQUtFVEEiIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIG1hdGhfbWFwKG1hdGguYWJzKGdsb2JhbHMucmVhbHRpbWUoKSAlIDAuMyAtIDAuMTUpLCAwLCAwLjE1LCAtODksIDg5KSkNCiAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoTWlzYy5mbGlja3BpdGNoKSA9PSAiU2VtaS1VcCIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgLTQ1KQ0KICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNrcGl0Y2gpID09ICJTZW1pLURvd24iIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIDQ1KQ0KICAgICAgICAgICAgZW5kDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJBdCB0YXJnZXRzIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICIxODAiKQ0KICAgICAgICAgICAgaWYgdWkuZ2V0KE1pc2MuZmxpY2t5YXcpID09ICJTdGF0aWMiIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCA5MCBvciAtOTApDQogICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNreWF3KSA9PSAiUmFuZG9tIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgKG1hdGgucmFuZG9tKDcwLCAxMDApKSBvciAtKG1hdGgucmFuZG9tKDcwLCAxMDApKSkNCiAgICAgICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2t5YXcpID09ICJKaXR0ZXIiIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAoZ2xvYmFscy50aWNrY291bnQoKSAlIDQgPiAxIGFuZCA3MCBvciAxMTApIG9yIChnbG9iYWxzLnRpY2tjb3VudCgpICUgNCA+IDEgYW5kIC03MCBvciAtMTEwKSkNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIk9mZiIpDQogICAgICAgIGVsc2VpZiBpbmNsdWRlcyh1aS5nZXQoTWlzYy5mbGlja2V4KSwgIkNyb3VjaGluZyIpIGFuZCBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIkNyb3VjaGluZyIgYW5kIGlzX2RlZmVuc2l2ZSB0aGVuDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJDdXN0b20iKQ0KICAgICAgICAgICAgaWYgdWkuZ2V0KE1pc2MuZmxpY2t5YXcpID09ICJaZXJvIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCAwKQ0KICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNrcGl0Y2gpID09ICJVcCIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgLTg5KQ0KICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNrcGl0Y2gpID09ICJEb3duIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCA4OSkNCiAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoTWlzYy5mbGlja3BpdGNoKSA9PSAiUmFuZG9tIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCBtYXRoLnJhbmRvbSgtODksIDg5KSkNCiAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoTWlzYy5mbGlja3BpdGNoKSA9PSAiUEFLRVRBIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCBtYXRoX21hcChtYXRoLmFicyhnbG9iYWxzLnJlYWx0aW1lKCkgJSAwLjMgLSAwLjE1KSwgMCwgMC4xNSwgLTg5LCA4OSkpDQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2twaXRjaCkgPT0gIlNlbWktVXAiIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIC00NSkNCiAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoTWlzYy5mbGlja3BpdGNoKSA9PSAiU2VtaS1Eb3duIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCA0NSkNCiAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgICAgIGlmIHVpLmdldChNaXNjLmZsaWNreWF3KSA9PSAiU3RhdGljIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgOTAgb3IgLTkwKQ0KICAgICAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoTWlzYy5mbGlja3lhdykgPT0gIlJhbmRvbSIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIChtYXRoLnJhbmRvbSg3MCwgMTAwKSkgb3IgLShtYXRoLnJhbmRvbSg3MCwgMTAwKSkpDQogICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNreWF3KSA9PSAiSml0dGVyIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgKGdsb2JhbHMudGlja2NvdW50KCkgJSA0ID4gMSBhbmQgNzAgb3IgMTEwKSBvciAoZ2xvYmFscy50aWNrY291bnQoKSAlIDQgPiAxIGFuZCAtNzAgb3IgLTExMCkpDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJPZmYiKQ0KICAgICAgICBlbHNlaWYgaW5jbHVkZXModWkuZ2V0KE1pc2MuZmxpY2tleCksICJJbiBBaXIiKSBhbmQgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJJbiBBaXIiIGFuZCBpc19kZWZlbnNpdmUgdGhlbg0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiQ3VzdG9tIikNCiAgICAgICAgICAgIGlmIHVpLmdldChNaXNjLmZsaWNreWF3KSA9PSAiWmVybyIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgMCkNCiAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoTWlzYy5mbGlja3BpdGNoKSA9PSAiVXAiIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIC04OSkNCiAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoTWlzYy5mbGlja3BpdGNoKSA9PSAiRG93biIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgODkpDQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2twaXRjaCkgPT0gIlJhbmRvbSIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgbWF0aC5yYW5kb20oLTg5LCA4OSkpDQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2twaXRjaCkgPT0gIlBBS0VUQSIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgbWF0aF9tYXAobWF0aC5hYnMoZ2xvYmFscy5yZWFsdGltZSgpICUgMC4zIC0gMC4xNSksIDAsIDAuMTUsIC04OSwgODkpKQ0KICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNrcGl0Y2gpID09ICJTZW1pLVVwIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCAtNDUpDQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2twaXRjaCkgPT0gIlNlbWktRG93biIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgNDUpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICBpZiB1aS5nZXQoTWlzYy5mbGlja3lhdykgPT0gIlN0YXRpYyIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIDkwIG9yIC05MCkNCiAgICAgICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2t5YXcpID09ICJSYW5kb20iIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAobWF0aC5yYW5kb20oNzAsIDEwMCkpIG9yIC0obWF0aC5yYW5kb20oNzAsIDEwMCkpKQ0KICAgICAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoTWlzYy5mbGlja3lhdykgPT0gIkppdHRlciIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIChnbG9iYWxzLnRpY2tjb3VudCgpICUgNCA+IDEgYW5kIDcwIG9yIDExMCkgb3IgKGdsb2JhbHMudGlja2NvdW50KCkgJSA0ID4gMSBhbmQgLTcwIG9yIC0xMTApKQ0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiT2ZmIikNCiAgICAgICAgZWxzZWlmIGluY2x1ZGVzKHVpLmdldChNaXNjLmZsaWNrZXgpLCAiSW4gQWlyICYgQ3JvdWNoaW5nIikgYW5kIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiSW4gQWlyICYgQ3JvdWNoaW5nIiBhbmQgaXNfZGVmZW5zaXZlIHRoZW4NCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIkN1c3RvbSIpDQogICAgICAgICAgICBpZiB1aS5nZXQoTWlzYy5mbGlja3lhdykgPT0gIlplcm8iIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIDApDQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2twaXRjaCkgPT0gIlVwIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCAtODkpDQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2twaXRjaCkgPT0gIkRvd24iIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIDg5KQ0KICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNrcGl0Y2gpID09ICJSYW5kb20iIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIG1hdGgucmFuZG9tKC04OSwgODkpKQ0KICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNrcGl0Y2gpID09ICJQQUtFVEEiIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIG1hdGhfbWFwKG1hdGguYWJzKGdsb2JhbHMucmVhbHRpbWUoKSAlIDAuMyAtIDAuMTUpLCAwLCAwLjE1LCAtODksIDg5KSkNCiAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoTWlzYy5mbGlja3BpdGNoKSA9PSAiU2VtaS1VcCIgdGhlbg0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgLTQ1KQ0KICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNrcGl0Y2gpID09ICJTZW1pLURvd24iIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIDQ1KQ0KICAgICAgICAgICAgZW5kDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJBdCB0YXJnZXRzIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICIxODAiKQ0KICAgICAgICAgICAgaWYgdWkuZ2V0KE1pc2MuZmxpY2t5YXcpID09ICJTdGF0aWMiIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCA5MCBvciAtOTApDQogICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChNaXNjLmZsaWNreWF3KSA9PSAiUmFuZG9tIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgKG1hdGgucmFuZG9tKDcwLCAxMDApKSBvciAtKG1hdGgucmFuZG9tKDcwLCAxMDApKSkNCiAgICAgICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KE1pc2MuZmxpY2t5YXcpID09ICJKaXR0ZXIiIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAoZ2xvYmFscy50aWNrY291bnQoKSAlIDQgPiAxIGFuZCA3MCBvciAxMTApIG9yIChnbG9iYWxzLnRpY2tjb3VudCgpICUgNCA+IDEgYW5kIC03MCBvciAtMTEwKSkNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIk9mZiIpDQogICAgICAgIGVsc2VpZiB1aS5nZXQocHJlc2V0X3NlbGVjdG9yKSA9PSAiQ29uZGl0aW9uYWwiIHRoZW4NCg0KICAgICAgICAgICAgaWYgZHRtaXggYW5kIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiU3RhbmRpbmciIGFuZCAoaW5jbHVkZXModWkuZ2V0KE1pc2MuZmxpY2tleCksICJTdGFuZGluZyIpIG9yIChpbmNsdWRlcyh1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZm9yY2VfbGMpLCAiU3RhbmRpbmciKSBhbmQgZGVmZW5zaXZlb24pKSB0aGVuDQogICAgICAgICAgICAgICAgY21kLmZvcmNlX2RlZmVuc2l2ZSA9IHRydWUNCiAgICAgICAgICAgIGVsc2VpZiBkdG1peCBhbmQgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJNb3ZpbmciIGFuZCAoaW5jbHVkZXModWkuZ2V0KE1pc2MuZmxpY2tleCksICJNb3ZpbmciKSBvciAoaW5jbHVkZXModWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZvcmNlX2xjKSwgIk1vdmluZyIpIGFuZCBkZWZlbnNpdmVvbikpIHRoZW4NCiAgICAgICAgICAgICAgICBjbWQuZm9yY2VfZGVmZW5zaXZlID0gdHJ1ZQ0KICAgICAgICAgICAgZWxzZWlmIGR0bWl4IGFuZCBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIlNsb3cgV2Fsa2luZyIgYW5kIChpbmNsdWRlcyh1aS5nZXQoTWlzYy5mbGlja2V4KSwgIlNsb3cgV2Fsa2luZyIpIG9yIChpbmNsdWRlcyh1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZm9yY2VfbGMpLCAiU2xvdyBXYWxraW5nIikgYW5kIGRlZmVuc2l2ZW9uKSkgdGhlbg0KICAgICAgICAgICAgICAgIGNtZC5mb3JjZV9kZWZlbnNpdmUgPSB0cnVlDQogICAgICAgICAgICBlbHNlaWYgZHRtaXggYW5kIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiQ3JvdWNoaW5nIiBhbmQgKGluY2x1ZGVzKHVpLmdldChNaXNjLmZsaWNrZXgpLCAiQ3JvdWNoaW5nIikgb3IgKGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mb3JjZV9sYyksICJDcm91Y2hpbmciKSBhbmQgZGVmZW5zaXZlb24pKSB0aGVuDQogICAgICAgICAgICAgICAgY21kLmZvcmNlX2RlZmVuc2l2ZSA9IHRydWUNCiAgICAgICAgICAgIGVsc2VpZiBkdG1peCBhbmQgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJJbiBBaXIiIGFuZCAoaW5jbHVkZXModWkuZ2V0KE1pc2MuZmxpY2tleCksICJJbiBBaXIiKSBvciAoaW5jbHVkZXModWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZvcmNlX2xjKSwgIkluIEFpciIpIGFuZCBkZWZlbnNpdmVvbikpIHRoZW4NCiAgICAgICAgICAgICAgICBjbWQuZm9yY2VfZGVmZW5zaXZlID0gdHJ1ZQ0KICAgICAgICAgICAgZWxzZWlmIGR0bWl4IGFuZCBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIkluIEFpciAmIENyb3VjaGluZyIgYW5kIChpbmNsdWRlcyh1aS5nZXQoTWlzYy5mbGlja2V4KSwgIkluIEFpciAmIENyb3VjaGluZyIpIG9yIChpbmNsdWRlcyh1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZm9yY2VfbGMpLCAiSW4gQWlyICYgQ3JvdWNoaW5nIikgYW5kIGRlZmVuc2l2ZW9uKSkgdGhlbg0KICAgICAgICAgICAgICAgIGNtZC5mb3JjZV9kZWZlbnNpdmUgPSB0cnVlDQogICAgICAgICAgICBlbmQNCg0KICAgICAgICBpZiBpc19kZWZlbnNpdmUgYW5kIGRlZmVuc2l2ZW9uIHRoZW4gDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJPZmYiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmZzX2JvZHlfeWF3LCBmYWxzZSkgIA0KICAgICAgICBpZiBkZWZlbnNpdmVwaXRjaCA9PSAiTm9uZSIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJPZmYiKSANCiAgICAgICAgZWxzZWlmIGRlZmVuc2l2ZXBpdGNoID09ICJEb3duIiB0aGVuIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIkN1c3RvbSIpIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgODkpDQogICAgICAgIGVsc2VpZiBkZWZlbnNpdmVwaXRjaCA9PSAiVXAiIHRoZW4gdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiQ3VzdG9tIikgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCAtODkpDQogICAgICAgIGVsc2VpZiBkZWZlbnNpdmVwaXRjaCA9PSAiUmFuZG9tIiB0aGVuIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIkN1c3RvbSIpIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgY2xpZW50LnJhbmRvbV9pbnQoZGVmZW5zaXZlcGl0Y2hhLCBkZWZlbnNpdmVwaXRjaGIpIG9yIGNsaWVudC5yYW5kb21faW50KGRlZmVuc2l2ZXBpdGNoYiwgZGVmZW5zaXZlcGl0Y2hhKSkNCiAgICAgICAgZWxzZWlmIGRlZmVuc2l2ZXBpdGNoID09ICJQQUtFVEEiIHRoZW4gdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiQ3VzdG9tIikgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCBtYXRoX21hcChtYXRoLmFicyhnbG9iYWxzLnJlYWx0aW1lKCkgJSAwLjMgLSAwLjE1KSwgMCwgMC4xNSwgZGVmZW5zaXZlcGl0Y2hhLCBkZWZlbnNpdmVwaXRjaGIpKQ0KICAgICAgICBlbHNlaWYgZGVmZW5zaXZlcGl0Y2ggPT0gIkN1c3RvbSIgdGhlbiB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJDdXN0b20iKSB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIGdsb2JhbHMudGlja2NvdW50KCkgJSA0ID4gMSBhbmQgZGVmZW5zaXZlcGl0Y2hhIG9yIGRlZmVuc2l2ZXBpdGNoYikNCiAgICAgICAgZW5kIA0KICAgICAgICBpZiBhdF90YXJnZXRzIHRoZW4gdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpIGVsc2UgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiTG9jYWwgdmlldyIpIGVuZA0KICAgICAgICBpZiBkZWZlbnNpdmV5YXcgfj0gIkFsbCB0aGUgc2lkZXMiIHRoZW4NCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJSYW5kb20iKSB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgIGlmIGRlZmVuc2l2ZXlhdyA9PSAiU3BpbmJvdCIgdGhlbg0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiU3BpbiIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIGRlZmVuc2l2ZXlhd2EpDQogICAgZWxzZWlmIGRlZmVuc2l2ZXlhdyA9PSAiU2lkZXdheXMiIHRoZW4NCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIHN3aXRjaGRlZiBhbmQgbWF0aC5yYW5kb20oLTYwLCAtMTIwKSBvciBtYXRoLnJhbmRvbSg2MCwgMTIwKSkNCiAgICBlbHNlaWYgZGVmZW5zaXZleWF3ID09ICJPcHBvc2l0ZSIgdGhlbg0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgbWF0aC5yYW5kb20oMTUwLCAyMTApID4gMTgwIGFuZCBtYXRoLnJhbmRvbSgxNTAsIDE4MCkgb3IgbWF0aC5yYW5kb20oLTE4MCwgLTE1MCkpDQogICAgZWxzZWlmIGRlZmVuc2l2ZXlhdyA9PSAiT3Bwb3NpdGUgSml0dGVyIiB0aGVuDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICIxODAiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCBzd2l0Y2hkZWYgYW5kIG1hdGgucmFuZG9tKDEzNSwgMTgwKSBvciBtYXRoLnJhbmRvbSgtMTgwLCAtMTM1KSkNCiAgICBlbHNlaWYgZGVmZW5zaXZleWF3ID09ICJSYW5kb20iIHRoZW4NCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIGNsaWVudC5yYW5kb21faW50KGRlZmVuc2l2ZXlhd2EsIGRlZmVuc2l2ZXlhd2IpIG9yIGNsaWVudC5yYW5kb21faW50KGRlZmVuc2l2ZXlhd2IsIGRlZmVuc2l2ZXlhd2EpKQ0KICAgIGVsc2VpZiBkZWZlbnNpdmV5YXcgPT0gIjMtV2F5IiB0aGVuDQogICAgICAgIGlmIGdsb2JhbHMuY2hva2VkY29tbWFuZHMoKSA9PSAwIHRoZW4NCiAgICAgICAgICAgIHdheWNvdW50ID0gd2F5Y291bnQgKyAxDQogICAgICAgIGVuZA0KICAgICAgICBpZiB3YXljb3VudCA+IDIgdGhlbg0KICAgICAgICAgICAgd2F5Y291bnQgPSAwDQogICAgICAgIGVuZA0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgd2F5XzNbd2F5Y291bnRdKQ0KICAgIGVsc2VpZiBkZWZlbnNpdmV5YXcgPT0gIjUtV2F5IiB0aGVuDQogICAgICAgIGlmIGdsb2JhbHMuY2hva2VkY29tbWFuZHMoKSA9PSAwIHRoZW4NCiAgICAgICAgICAgIHdheWNvdW50ID0gd2F5Y291bnQgKyAxDQogICAgICAgIGVuZA0KICAgICAgICBpZiB3YXljb3VudCA+IDQgdGhlbg0KICAgICAgICAgICAgd2F5Y291bnQgPSAwDQogICAgICAgIGVuZA0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgd2F5XzVbd2F5Y291bnRdKQ0KICAgIGVsc2VpZiBkZWZlbnNpdmV5YXcgPT0gIkN1c3RvbSIgdGhlbg0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgZ2xvYmFscy50aWNrY291bnQoKSAlIDQgPiAxIGFuZCBkZWZlbnNpdmV5YXdhIG9yIGRlZmVuc2l2ZXlhd2IpDQogICAgICAgIGVuZA0KICAgIGVsc2UgDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICIxODAiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCBzbW9vdGhKaXR0ZXIoY2xpZW50LnJhbmRvbV9pbnQoMjAsMTYwKSwgY2xpZW50LnJhbmRvbV9pbnQoLTE2MCwtMjApLCAxMCkpDQogICAgZW5kDQppZiB1aS5nZXQoTWlzYy5lZGdlZGVmZW5zaXZlKSB0aGVuDQogICAgdWkuc2V0KHJlZi5hbnRpYWltLmVkZ2V5YXcsIHRydWUpDQplbmQNCmVuZA0KZWxzZWlmIHVpLmdldChwcmVzZXRfc2VsZWN0b3IpID09ICJDbGFzc2ljIEppdHRlciAoZm9yIDJ4MiB0b3VybmFtZW50cykiIGFuZCBpc19kZWZlbnNpdmUgdGhlbg0KICAgIGlmIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiQ3JvdWNoaW5nIiBhbmQgaW5jbHVkZXModWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZvcmNlX2xjKSwgIkNyb3VjaGluZyIpIHRoZW4NCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiQ3VzdG9tIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCBwaXRjaHN3YXkoLTg5LDg5KSkNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJPZmYiKQ0KICAgICAgICBsb2NhbCB3YXlzID0gey0xNTAsZ2xvYmFscy50aWNrY291bnQoKSAlIDQgPiAxIGFuZCBjbGllbnQucmFuZG9tX2ludCgtMTgwLCAtMTYwKSBvciBjbGllbnQucmFuZG9tX2ludCgxNjAsIDE4MCksMTUwfQ0KICAgICAgICBsb2NhbCB3YXlzMiA9IHstMTIwLGdsb2JhbHMudGlja2NvdW50KCkgJSA0ID4gMSBhbmQgY2xpZW50LnJhbmRvbV9pbnQoLTE4MCwgLTE2MCkgb3IgY2xpZW50LnJhbmRvbV9pbnQoMTYwLCAxODApLDEyMH0NCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIGdsb2JhbHMudGlja2NvdW50KCkgJSA1MCA+IDI1IGFuZCAod2F5c1soZ2xvYmFscy50aWNrY291bnQoKSAlIDMpICsgMV0pIG9yICh3YXlzMlsoZ2xvYmFscy50aWNrY291bnQoKSAlIDMpICsgMV0pKQ0KICAgICAgICBlbHNlaWYgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJTdGFuZGluZyIgYW5kIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mb3JjZV9sYyksICJTdGFuZGluZyIpIHRoZW4NCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIk9mZiIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJBdCB0YXJnZXRzIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIk9mZiIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIGdsb2JhbHMudGlja2NvdW50KCkgJSAxMDAgPiA4IGFuZCAoZ2xvYmFscy50aWNrY291bnQoKSAlIDQgPiAxIGFuZCBjbGllbnQucmFuZG9tX2ludCg2NSwgMTE1KSBvciAtY2xpZW50LnJhbmRvbV9pbnQoNjUsIDExNSkpIG9yIChnbG9iYWxzLnRpY2tjb3VudCgpICUgNCA+IDEgYW5kIGNsaWVudC5yYW5kb21faW50KDAsIDE4MCkgb3IgLWNsaWVudC5yYW5kb21faW50KDAsIDE4MCkpKQ0KICAgICAgICBlbHNlaWYgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJTbG93IFdhbGtpbmciIGFuZCBpbmNsdWRlcyh1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZm9yY2VfbGMpLCAiU2xvdyBXYWxraW5nIikgdGhlbg0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiQ3VzdG9tIikgDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIC00NCkgDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJBdCB0YXJnZXRzIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIk9mZiIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIGdsb2JhbHMudGlja2NvdW50KCkgJSBjbGllbnQucmFuZG9tX2ludCg4MCwgMTAwKSA+IGNsaWVudC5yYW5kb21faW50KDUwLCA3MCkgYW5kIGNsaWVudC5yYW5kb21faW50KDU2LCA4NSkgb3IgLWNsaWVudC5yYW5kb21faW50KDU2LCA4NSkpDQogICAgICAgIGVsc2VpZiBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIk1vdmluZyIgYW5kIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mb3JjZV9sYyksICJNb3ZpbmciKSB0aGVuDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJDdXN0b20iKSANCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgMCkgDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJBdCB0YXJnZXRzIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICJTcGluIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIDQ1KQ0KICAgICAgICBlbHNlaWYgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJJbiBBaXIiIGFuZCBpbmNsdWRlcyh1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZm9yY2VfbGMpLCAiSW4gQWlyIikgdGhlbg0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiQ3VzdG9tIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgLTQ0KQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJPZmYiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCBnbG9iYWxzLnRpY2tjb3VudCgpICUgMTAwID4gOCBhbmQgKGdsb2JhbHMudGlja2NvdW50KCkgJSA0ID4gMSBhbmQgY2xpZW50LnJhbmRvbV9pbnQoNjUsIDExNSkgb3IgLWNsaWVudC5yYW5kb21faW50KDY1LCAxMTUpKSBvciAoZ2xvYmFscy50aWNrY291bnQoKSAlIDQgPiAxIGFuZCBjbGllbnQucmFuZG9tX2ludCgwLCAxODApIG9yIC1jbGllbnQucmFuZG9tX2ludCgwLCAxODApKSkNCiAgICAgICAgZWxzZWlmIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiSW4gQWlyICYgQ3JvdWNoaW5nIiBhbmQgaW5jbHVkZXModWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZvcmNlX2xjKSwgIkluIEFpciAmIENyb3VjaGluZyIpIHRoZW4NCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIkN1c3RvbSIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIHBpdGNoc3dheSg4OSwtODkpKSANCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiT2ZmIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICIxODAiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgZ2xvYmFscy50aWNrY291bnQoKSAlIGNsaWVudC5yYW5kb21faW50KDgwLCAxMDApID4gY2xpZW50LnJhbmRvbV9pbnQoNTAsIDcwKSBhbmQgY2xpZW50LnJhbmRvbV9pbnQoNTYsIDg1KSBvciAtY2xpZW50LnJhbmRvbV9pbnQoNTYsIDg1KSkNCmVuZA0KZWxzZWlmIHVpLmdldChwcmVzZXRfc2VsZWN0b3IpID09ICJEZWxheWVkIEppdHRlciIgYW5kIGlzX2RlZmVuc2l2ZSB0aGVuDQogICAgaWYgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJDcm91Y2hpbmciIGFuZCBpbmNsdWRlcyh1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZm9yY2VfbGMpLCAiQ3JvdWNoaW5nIikgdGhlbg0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJDdXN0b20iKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIC04OSkNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJPZmYiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgZ2xvYmFscy50aWNrY291bnQoKSAlIDQgPiAxIGFuZCBjbGllbnQucmFuZG9tX2ludCgtMTgwLCAxODApIG9yIGNsaWVudC5yYW5kb21faW50KC0xODAsIDE4MCkpDQogICAgICAgIGVsc2VpZiBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIlN0YW5kaW5nIiBhbmQgaW5jbHVkZXModWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZvcmNlX2xjKSwgIlN0YW5kaW5nIikgdGhlbg0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiQ3VzdG9tIikgDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIHBpdGNoc3dheSg4OSwtODkpKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgIGVsc2VpZiBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIlNsb3cgV2Fsa2luZyIgYW5kIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mb3JjZV9sYyksICJTbG93IFdhbGtpbmciKSB0aGVuDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJDdXN0b20iKSANCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgcGl0Y2hzd2F5KDg5LC04OSkpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJBdCB0YXJnZXRzIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIk9mZiIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIGdsb2JhbHMudGlja2NvdW50KCkgJSA0ID4gMSBhbmQgY2xpZW50LnJhbmRvbV9pbnQoLTE4MCwgLTEwMCkgb3IgY2xpZW50LnJhbmRvbV9pbnQoMTAwLCAxODApKQ0KICAgICAgICBlbHNlaWYgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJNb3ZpbmciIGFuZCBpbmNsdWRlcyh1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZm9yY2VfbGMpLCAiTW92aW5nIikgdGhlbg0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiQ3VzdG9tIikgDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIGNsaWVudC5yYW5kb21faW50KC03NSwgNzUpKSANCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIlNwaW4iKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgNDUpDQogICAgICAgIGVsc2VpZiBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIkluIEFpciIgYW5kIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mb3JjZV9sYyksICJJbiBBaXIiKSB0aGVuDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJDdXN0b20iKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCAtNDQpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJBdCB0YXJnZXRzIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIk9mZiIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIGdsb2JhbHMudGlja2NvdW50KCkgJSA0ID4gMSBhbmQgY2xpZW50LnJhbmRvbV9pbnQoLTE4MCwgMTgwKSBvciBjbGllbnQucmFuZG9tX2ludCgtMTgwLCAxODApKQ0KICAgICAgICBlbHNlaWYgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJJbiBBaXIgJiBDcm91Y2hpbmciIGFuZCBpbmNsdWRlcyh1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZm9yY2VfbGMpLCAiSW4gQWlyICYgQ3JvdWNoaW5nIikgdGhlbg0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiQ3VzdG9tIikgDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIDg5KQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJPZmYiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIlNwaW4iKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgNDUpDQplbmQNCmVuZA0KICAgIA0KICAgIC0tDQogICAgaWYgdWkuZ2V0KGdlbmVyYWxfdGFiLm5sZHQpIHRoZW4NCiAgICAgICAgaWYgY21kLmZvcmNlX2RlZmVuc2l2ZSA9PSB0cnVlIGFuZCBkb3VibGV0YXBfY2hhcmdlZCgpIHRoZW4gDQogICAgICAgICAgICBpZiBnbG9iYWxzLnRpY2tjb3VudCgpICUgNCA9PSAwIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQoa2V5c2ZvcmluZHMuZHRfbGltaXQsIDEpDQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgdWkuc2V0KGtleXNmb3JpbmRzLmR0X2xpbWl0LCAyKQ0KICAgICAgICAgICAgZW5kDQoNCiAgICAgICAgICAgIGlmIGlzX2RlZmVuc2l2ZSB0aGVuDQogICAgICAgICAgICAgICAgY21kLmFsbG93X3NlbmRfcGFja2V0ID0gZmFsc2UNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBjbWQubm9fY2hva2UgPSB0cnVlDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgdWkuc2V0KGtleXNmb3JpbmRzLmR0X2xpbWl0LCAxKSANCiAgICAgICAgZW5kDQogICAgZW5kDQoNCg0KICAgIGxvY2FsIGxvY2FsX3BsYXllciA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkNCglsb2NhbCB3ZWFwb25fZW50ID0gZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGxvY2FsX3BsYXllcikNCiAgICBsb2NhbCB3ZWFwb25faWR4ID0gZW50aXR5LmdldF9wcm9wKHdlYXBvbl9lbnQsICJtX2lJdGVtRGVmaW5pdGlvbkluZGV4IikNCiAgICBsb2NhbCB3ZWFwb24gPSBjc2dvX3dlYXBvbnNbd2VhcG9uX2lkeF0NCg0KICAgIGlmIG5vdCBpc19kZWZlbnNpdmUgYW5kIGNtZC5mb3JjZV9kZWZlbnNpdmUgPT0gdHJ1ZSBhbmQgZHRtaXggYW5kIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSB+PSAiRmFrZSBMYWciIGFuZCB3ZWFwb24ubmFtZSB+PSAiUjggUmV2b2x2ZXIiIHRoZW4NCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiTWluaW1hbCIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgMCkNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIlN0YXRpYyIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgMCkNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmZzX2JvZHlfeWF3LCBmYWxzZSkNCiAgICBlbmQNCg0KICAgICAgICAtLSBTQUZFS05JRkUNCiAgICAgICAgaWYgaW5jbHVkZXModWkuZ2V0KE1pc2Muc2FmZV9oZWFkKSwgIktuaWZlIikgYW5kIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiSW4gQWlyICYgQ3JvdWNoaW5nIiBhbmQgZW50aXR5LmdldF9jbGFzc25hbWUoZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpKSA9PSAiQ0tuaWZlIiB0aGVuDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJNaW5pbWFsIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiU3RhdGljIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5mc19ib2R5X3lhdywgZmFsc2UpDQogICAgICAgIGVuZA0KICAgICAgICAtLSBTQUZFWkVVUw0KICAgICAgICBpZiBpbmNsdWRlcyh1aS5nZXQoTWlzYy5zYWZlX2hlYWQpLCAiVGFzZXIiKSBhbmQgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJJbiBBaXIgJiBDcm91Y2hpbmciIGFuZCBlbnRpdHkuZ2V0X2NsYXNzbmFtZShlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkpID09ICJDV2VhcG9uVGFzZXIiIHRoZW4NCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIkN1c3RvbSIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIDg5KQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiUmFuZG9tIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJTdGF0aWMiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmZzX2JvZHlfeWF3LCBmYWxzZSkNCiAgICBlbmQgDQogICAgICAgIC0tIFNBRkUgSEVBRCANCiAgICAgICAgaWYgaW5jbHVkZXModWkuZ2V0KE1pc2Muc2FmZV9oZWFkKSwgIkhlaWdodCBBZHZhbnRhZ2UiKSBhbmQgc2FmZWhlYWR0YXJnZXQoKSBhbmQgKGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiSW4gQWlyICYgQ3JvdWNoaW5nIiBvciBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIkNyb3VjaGluZyIgb3IgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJTdGFuZGluZyIgb3IgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJGYWtlIExhZyIpIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJNaW5pbWFsIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiU3RhdGljIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5mc19ib2R5X3lhdywgZmFsc2UpDQogICAgZW5kICAgICANCg0KICAgICAgICAgICAgIC0tIFNUQVRJQyBGUkVFU1RBTkQNCiAgICAgICAgaWYgdWkuZ2V0KGtleWJpbmRzX3RhYi5mcmVlc3RhbmQpIHRoZW4NCiAgICAgICAgICAgIGlmIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mb3JjZV9sYyksICJGcmVlc3RhbmRpbmciKSBhbmQgbm90IGlzX2RlZmVuc2l2ZSB0aGVuIGNtZC5mb3JjZV9kZWZlbnNpdmUgPSB1aS5nZXQoTWlzYy5mb3JjZWZzbSkgZW5kDQogICAgICAgIGlmIGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mb3JjZV9sYyksICJGcmVlc3RhbmRpbmciKSBhbmQgaXNfZGVmZW5zaXZlIHRoZW4NCiAgICAgICAgICAgIGNtZC55YXcgPSBhYnN0b2ZsaWNrICsgMTgwICsgY2xpZW50LnJhbmRvbV9pbnQoLTE0LCAxNCkNCiAgICAgICAgICAgIGNtZC5waXRjaCA9IDEwODAgKyBjbGllbnQucmFuZG9tX2ludCgtNywgNykNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIkN1c3RvbSIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJMb2NhbCB2aWV3IikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICIxODAiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgY2xhbXBlcihhYnN0b2ZsaWNrKSkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIlN0YXRpYyIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uZnNfYm9keV95YXcsIGZhbHNlKSAgIA0KICAgICAgICBlbHNlDQogICAgICAgICAgICBhYnN0b2ZsaWNrID0gYW50aWFpbV9mdW5jcy5nZXRfYWJzX3lhdygpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJNaW5pbWFsIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiU3RhdGljIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5mc19ib2R5X3lhdywgdHJ1ZSkNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQgICANCg0KICAgICAgICAtLSBNQU5VQUwgQUENCiAgICAgICAgaWYgbWFudWFsX2RpciA9PSAyIHRoZW4NCiAgICAgICAgICAgIGNtZC5mb3JjZV9kZWZlbnNpdmUgPSB1aS5nZXQoTWlzYy5mb3JjZWZzbSkNCiAgICAgICAgICAgIGlmIG5vdCBpc19kZWZlbnNpdmUgb3Igbm90IGluY2x1ZGVzKHVpLmdldChhbnRpYWltX3RhYi5mZWF0dXJlX3RhYi5mb3JjZV9sYyksICJNYW51YWxzIikgdGhlbiANCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIk1pbmltYWwiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiTG9jYWwgdmlldyIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIDkwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiT2ZmIikNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5mc19ib2R5X3lhdywgZmFsc2UpDQogICAgICAgICAgICBlbHNlIA0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIkN1c3RvbSIpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCBjbGllbnQucmFuZG9tX2ludCgtNywgNykpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiTG9jYWwgdmlldyIpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgLTkwICsgY2xpZW50LnJhbmRvbV9pbnQoLTE0LCAxNCkpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsyXSwgMCkNCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJPZmYiKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgMCkNCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uZnNfYm9keV95YXcsIGZhbHNlKQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVsc2VpZiBtYW51YWxfZGlyID09IDEgdGhlbg0KICAgICAgICAgICAgY21kLmZvcmNlX2RlZmVuc2l2ZSA9IHVpLmdldChNaXNjLmZvcmNlZnNtKQ0KICAgICAgICAgICAgaWYgbm90IGlzX2RlZmVuc2l2ZSBvciBub3QgaW5jbHVkZXModWkuZ2V0KGFudGlhaW1fdGFiLmZlYXR1cmVfdGFiLmZvcmNlX2xjKSwgIk1hbnVhbHMiKSB0aGVuIA0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIk1pbmltYWwiKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkxvY2FsIHZpZXciKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICIxODAiKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIC05MCkNCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzFdLCAiT2Zmc2V0IikNCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIk9mZiIpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzJdLCAwKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5mc19ib2R5X3lhdywgZmFsc2UpDQogICAgICAgICAgICAgICAgZWxzZSANCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiQ3VzdG9tIikNCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzJdLCBjbGllbnQucmFuZG9tX2ludCgtNywgNykpDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdfYmFzZSwgIkxvY2FsIHZpZXciKQ0KICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzFdLCAiMTgwIikNCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgOTAgKyBjbGllbnQucmFuZG9tX2ludCgtMTQsIDE0KSkNCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIk9mZiIpDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgMCkNCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmZzX2JvZHlfeWF3LCBmYWxzZSkNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZWlmIG1hbnVhbF9kaXIgPT0gMyB0aGVuDQogICAgICAgICAgICBjbWQuZm9yY2VfZGVmZW5zaXZlID0gdWkuZ2V0KE1pc2MuZm9yY2Vmc20pDQogICAgICAgICAgICBpZiBub3QgaXNfZGVmZW5zaXZlIG9yIG5vdCBpbmNsdWRlcyh1aS5nZXQoYW50aWFpbV90YWIuZmVhdHVyZV90YWIuZm9yY2VfbGMpLCAiTWFudWFscyIpIHRoZW4gDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnBpdGNoWzFdLCAiTWluaW1hbCIpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiTG9jYWwgdmlldyIpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1syXSwgMTgwKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmJvZHlfeWF3WzFdLCAiT2ZmIikNCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIDApDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmZzX2JvZHlfeWF3LCBmYWxzZSkNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsxXSwgIkN1c3RvbSIpDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5waXRjaFsyXSwgY2xpZW50LnJhbmRvbV9pbnQoLTcsIDcpKQ0KICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3X2Jhc2UsICJMb2NhbCB2aWV3IikNCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMl0sIDAgKyBjbGllbnQucmFuZG9tX2ludCgtMTQsIDE0KSkNCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmppdHRlclsxXSwgIk9mZnNldCIpDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMl0sIDApDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1sxXSwgIk9mZiIpDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5ib2R5X3lhd1syXSwgMCkNCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLmZzX2JvZHlfeWF3LCBmYWxzZSkNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICAgIGVuZA0KIA0KLS0tDQoNCmlmIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiSW4gQWlyIiB0aGVuDQogICAgY29uZHRvdGFrZSA9IGFudGlhaW1fdGFiWyJJbkFpciJdDQplbHNlaWYgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJJbiBBaXIgJiBDcm91Y2hpbmciIHRoZW4NCiAgICBjb25kdG90YWtlID0gYW50aWFpbV90YWJbIkFpcmNyb3VjaGluZyJdDQplbHNlaWYgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJTbG93IFdhbGtpbmciIHRoZW4NCiAgICBjb25kdG90YWtlID0gYW50aWFpbV90YWJbIlNsb3d3YWxraW5nIl0NCmVsc2VpZiBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIkZha2UgTGFnIiB0aGVuDQogICAgY29uZHRvdGFrZSA9IGFudGlhaW1fdGFiWyJGYWtlbGFnIl0NCmVsc2UgIA0KICAgIGNvbmR0b3Rha2UgPSBhbnRpYWltX3RhYlthbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCldDQplbmQNCg0KaWYgYW50aV9haW1zOmdldF9mYWtlbGFnX2NvbmQoKSA9PSAiSW4gQWlyIiB0aGVuDQogICAgY29uZHRvdGFrZWZsYWdzID0gYW50aWFpbV90YWJbIkluQWlyIl0NCmVsc2VpZiBhbnRpX2FpbXM6Z2V0X2Zha2VsYWdfY29uZCgpID09ICJJbiBBaXIgJiBDcm91Y2hpbmciIHRoZW4NCiAgICBjb25kdG90YWtlZmxhZ3MgPSBhbnRpYWltX3RhYlsiQWlyY3JvdWNoaW5nIl0NCmVsc2VpZiBhbnRpX2FpbXM6Z2V0X2Zha2VsYWdfY29uZCgpID09ICJTbG93IFdhbGtpbmciIHRoZW4NCiAgICBjb25kdG90YWtlZmxhZ3MgPSBhbnRpYWltX3RhYlsiU2xvd3dhbGtpbmciXQ0KZWxzZWlmIGFudGlfYWltczpnZXRfZmFrZWxhZ19jb25kKCkgPT0gIkZha2UgTGFnIiB0aGVuDQogICAgY29uZHRvdGFrZWZsYWdzID0gYW50aWFpbV90YWJbIkZha2VsYWciXQ0KZWxzZSAgDQogICAgY29uZHRvdGFrZWZsYWdzID0gYW50aWFpbV90YWJbYW50aV9haW1zOmdldF9mYWtlbGFnX2NvbmQoKV0NCmVuZA0KDQogICAgbG9jYWwgcGl0Y2ggPSB1aS5nZXQoY29uZHRvdGFrZS5waXRjaCkNCiAgICBsb2NhbCBwaXRjaHNsaWRlciA9IHVpLmdldChjb25kdG90YWtlLnBpdGNoX3NsaWRlcikgDQogICAgbG9jYWwgYXRfdGFyZ2V0cyA9IHVpLmdldChjb25kdG90YWtlLmF0X3RhcmdldHMpIA0KICAgIGxvY2FsIGxlZnRfeWF3ID0gdWkuZ2V0KGNvbmR0b3Rha2UubGVmdF95YXcpIA0KICAgIGxvY2FsIHJpZ2h0X3lhdyA9IHVpLmdldChjb25kdG90YWtlLnJpZ2h0X3lhdykgDQogICAgbG9jYWwgaml0dGVyX21vZGUgPSB1aS5nZXQoY29uZHRvdGFrZS5qaXR0ZXJfbW9kZSkgDQogICAgbG9jYWwgaml0dGVyX2Ftb3VudCA9IHVpLmdldChjb25kdG90YWtlLmppdHRlcl9hbW91bnQpIA0KICAgIGxvY2FsIGxieSA9IHVpLmdldChjb25kdG90YWtlLmxieSkgDQogICAgbG9jYWwgbGJ5c2lkZSA9IHVpLmdldChjb25kdG90YWtlLmxieXNpZGUpICANCiAgICBsb2NhbCBsYnlzcGVlZCA9IHVpLmdldChjb25kdG90YWtlLmxieXNwZWVkKSANCiAgICBpZiBhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgfj0gIkZha2UgTGFnIiB0aGVuIA0KICAgICBkZWZlbnNpdmVvbiA9IHVpLmdldChjb25kdG90YWtlLmRlZmVuc2l2ZS5hYSkgDQogICAgIGRlZmVuc2l2ZXBpdGNoID0gdWkuZ2V0KGNvbmR0b3Rha2UuZGVmZW5zaXZlLnBpdGNoKSAgDQogICAgIGRlZmVuc2l2ZXBpdGNoYSA9IHVpLmdldChjb25kdG90YWtlLmRlZmVuc2l2ZS5hX3BpdGNoKSANCiAgICAgZGVmZW5zaXZlcGl0Y2hiID0gdWkuZ2V0KGNvbmR0b3Rha2UuZGVmZW5zaXZlLmJfcGl0Y2gpIA0KICAgICBkZWZlbnNpdmV5YXcgPSB1aS5nZXQoY29uZHRvdGFrZS5kZWZlbnNpdmUueWF3KSANCiAgICAgZGVmZW5zaXZleWF3YSA9IHVpLmdldChjb25kdG90YWtlLmRlZmVuc2l2ZS5hX3lhdykgDQogICAgIGRlZmVuc2l2ZXlhd2IgPSB1aS5nZXQoY29uZHRvdGFrZS5kZWZlbnNpdmUuYl95YXcpIA0KICAgIGVsc2UNCiAgICAgICAgIGRlZmVuc2l2ZW9uID0gdWkuZ2V0KGNvbmR0b3Rha2VmbGFncy5kZWZlbnNpdmUuYWEpIA0KICAgICAgICAgZGVmZW5zaXZlcGl0Y2ggPSB1aS5nZXQoY29uZHRvdGFrZWZsYWdzLmRlZmVuc2l2ZS5waXRjaCkgIA0KICAgICAgICAgZGVmZW5zaXZlcGl0Y2hhID0gdWkuZ2V0KGNvbmR0b3Rha2VmbGFncy5kZWZlbnNpdmUuYV9waXRjaCkgDQogICAgICAgICBkZWZlbnNpdmVwaXRjaGIgPSB1aS5nZXQoY29uZHRvdGFrZWZsYWdzLmRlZmVuc2l2ZS5iX3BpdGNoKSANCiAgICAgICAgIGRlZmVuc2l2ZXlhdyA9IHVpLmdldChjb25kdG90YWtlZmxhZ3MuZGVmZW5zaXZlLnlhdykgDQogICAgICAgICBkZWZlbnNpdmV5YXdhID0gdWkuZ2V0KGNvbmR0b3Rha2VmbGFncy5kZWZlbnNpdmUuYV95YXcpIA0KICAgICAgICAgZGVmZW5zaXZleWF3YiA9IHVpLmdldChjb25kdG90YWtlZmxhZ3MuZGVmZW5zaXZlLmJfeWF3KSANCiAgICBlbmQNCiAgICBoYW5kbGVfYWEocGl0Y2gsIHBpdGNoc2xpZGVyLCBkZWZlbnNpdmVzbGlkZXIyLCBkZWZlbnNpdmVzbGlkZXIzLCBhdF90YXJnZXRzLCBsZWZ0X3lhdywgcmlnaHRfeWF3LCBqaXR0ZXJfbW9kZSwgaml0dGVyX2Ftb3VudCwgbGJ5LCBsYnlzaWRlLCBsYnlzcGVlZCwgZGVmZW5zaXZlb24sIGRlZmVuc2l2ZXBpdGNoLCBhX3BpdGNoLCBiX3BpdGNoLCBkZWZlbnNpdmV5YXcsIGFfeWF3LCBiX3lhdykNCg0KZW5kKQ0KDQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJzZXR1cF9jb21tYW5kIiwgZnVuY3Rpb24oKQ0KICAgIGlmIHVpLmdldChNaXNjLmF2b2lkX2JhY2tzdGFiKSBhbmQgYW50aWJhY2tzdGFiKCkgdGhlbg0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ucGl0Y2hbMV0sICJEb3duIikNCiAgICAgICAgdWkuc2V0KHJlZi5hbnRpYWltLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS55YXdbMV0sICIxODAiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0ueWF3WzJdLCAxODApDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5qaXR0ZXJbMV0sICJPZmZzZXQiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uaml0dGVyWzJdLCAwKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMV0sICJTdGF0aWMiKQ0KICAgICAgICB1aS5zZXQocmVmLmFudGlhaW0uYm9keV95YXdbMl0sIDApDQogICAgICAgIHVpLnNldChyZWYuYW50aWFpbS5mc19ib2R5X3lhdywgZmFsc2UpDQogICAgZW5kDQplbmQpDQoNCg0KbG9jYWwgYWJzX3lhd19zZXQgPSB7fQ0KbG9jYWwgbGF0ZXN0X2J1bGxldF9pbXBhY3QgPSB7fQ0KbG9jYWwgbGF0ZXN0X3Nob3RfeWF3ID0ge30NCmxvY2FsIG9sZF9zaW11bGF0aW9uX3RpbWUgPSB7fQ0KDQpsb2NhbCBmdW5jdGlvbiBnZXRfbWF4X2ZlZXRfeWF3KHBsYXllcikNCiAgICByZXR1cm4gNTUNCmVuZA0KDQpsb2NhbCBmdW5jdGlvbiBhZGFwdGl2ZV9yZXNvbHZlKHBsYXllciwgZXllX2FuZ2xlcykNCiAgICBsb2NhbCBtYXhfeWF3ID0gZ2V0X21heF9mZWV0X3lhdyhwbGF5ZXIpDQogICAgaWYgbWF4X3lhdyB0aGVuDQogICAgICAgIGlmIHVpLmdldChnZW5lcmFsX3RhYi5yZXNvbHZlcikgdGhlbg0KICAgICAgICAgICAgbG9jYWwgb25fZ3JvdW5kID0gZW50aXR5LmdldF9wcm9wKHBsYXllciwgIm1fYk9uR3JvdW5kIikNCiAgICAgICAgICAgIGxvY2FsIHNwZWVkXzJkID0gZW50aXR5LmdldF9wcm9wKHBsYXllciwgIm1fZmxTcGVlZDJEIikNCg0KICAgICAgICAgICAgaWYgb25fZ3JvdW5kIH49IG5pbCBhbmQgc3BlZWRfMmQgfj0gbmlsIHRoZW4NCiAgICAgICAgICAgICAgICBpZiBvbl9ncm91bmQgPT0gMSBhbmQgc3BlZWRfMmQgPCAwLjEgdGhlbg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXllX2FuZ2xlcyArIG1heF95YXcgLyAyDQogICAgICAgICAgICAgICAgZWxzZWlmIHNwZWVkXzJkID4gMSB0aGVuDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBleWVfYW5nbGVzIC0gbWF4X3lhdyAvIDEuNQ0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZA0KICAgIHJldHVybiBleWVfYW5nbGVzDQplbmQNCg0KbG9jYWwgZnVuY3Rpb24gcmVzb2x2ZV9vbnNob3RfcmVjb3JkcygpDQogICAgaWYgbm90IHVpLmdldChnZW5lcmFsX3RhYi5yZXNvbHZlcikgdGhlbg0KICAgICAgICByZXR1cm4NCiAgICBlbmQNCg0KICAgIGxvY2FsIGVuZW1pZXMgPSBlbnRpdHkuZ2V0X3BsYXllcnModHJ1ZSkNCiAgICBpZiBub3QgZW5lbWllcyB0aGVuDQogICAgICAgIHJldHVybg0KICAgIGVuZA0KDQogICAgZm9yIGkgPSAxLCAjZW5lbWllcyBkbw0KICAgICAgICBsb2NhbCBwbGF5ZXIgPSBlbmVtaWVzW2ldDQogICAgICAgIGxvY2FsIHdlYXBvbiA9IGVudGl0eS5nZXRfcGxheWVyX3dlYXBvbihwbGF5ZXIpDQogICAgICAgIGlmIHdlYXBvbiB0aGVuICAgIA0KICAgICAgICAgICAgbG9jYWwgbGFzdF9zaG90X3RpbWUgPSBlbnRpdHkuZ2V0X3Byb3Aod2VhcG9uLCAibV9mTGFzdFNob3RUaW1lIikNCiAgICAgICAgICAgIGlmIGxhc3Rfc2hvdF90aW1lIHRoZW4NCiAgICAgICAgICAgICAgICBsb2NhbCBzaW11bGF0aW9uX3RpbWUgPSBlbnRpdHkuZ2V0X3Byb3AocGxheWVyLCAibV9mbFNpbXVsYXRpb25UaW1lIikNCiAgICAgICAgICAgICAgICBpZiBvbGRfc2ltdWxhdGlvbl90aW1lW3BsYXllcl0gdGhlbg0KICAgICAgICAgICAgICAgICAgICBpZiBsYXN0X3Nob3RfdGltZSA+IG9sZF9zaW11bGF0aW9uX3RpbWVbcGxheWVyXSBhbmQgbGFzdF9zaG90X3RpbWUgPD0gc2ltdWxhdGlvbl90aW1lIHRoZW4gICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsYXRlc3RfYnVsbGV0X2ltcGFjdFtwbGF5ZXJdIGFuZCBsYXRlc3Rfc2hvdF95YXdbcGxheWVyXSBhbmQgbGF0ZXN0X2J1bGxldF9pbXBhY3RbcGxheWVyXSB+PSB2ZWNfMygwLCAwLCAwKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZXllX2FuZ2xlcyA9IHZlY18zKGVudGl0eS5nZXRfcHJvcChwbGF5ZXIsICJtX2FuZ0V5ZUFuZ2xlcyIpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFic195YXdfcG9zaXRpdmUgPSBub3JtYWxpemVfYXNfeWF3KGV5ZV9hbmdsZXMueSArIG1hdGguYWJzKGdldF9tYXhfZmVldF95YXcocGxheWVyKSkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYWJzX3lhd19uZWdhdGl2ZSA9IG5vcm1hbGl6ZV9hc195YXcoZXllX2FuZ2xlcy55IC0gbWF0aC5hYnMoZ2V0X21heF9mZWV0X3lhdyhwbGF5ZXIpKSkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsaXN0LnNldChwbGF5ZXIsICJGb3JjZSBib2R5IHlhdyIsIHRydWUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWF0aC5hYnMobm9ybWFsaXplX2FzX3lhdyhleWVfYW5nbGVzLnkgLSBsYXRlc3Rfc2hvdF95YXdbcGxheWVyXSkpIDwgNSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsaXN0LnNldChwbGF5ZXIsICJGb3JjZSBib2R5IHlhdyB2YWx1ZSIsIDApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIG1hdGguYWJzKG5vcm1hbGl6ZV9hc195YXcoYWJzX3lhd19wb3NpdGl2ZSAtIGxhdGVzdF9zaG90X3lhd1twbGF5ZXJdKSkgPiBtYXRoLmFicyhub3JtYWxpemVfYXNfeWF3KGFic195YXdfbmVnYXRpdmUgLSBsYXRlc3Rfc2hvdF95YXdbcGxheWVyXSkpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxpc3Quc2V0KHBsYXllciwgIkZvcmNlIGJvZHkgeWF3IHZhbHVlIiwgLW1hdGguYWJzKGdldF9tYXhfZmVldF95YXcocGxheWVyKSkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGlzdC5zZXQocGxheWVyLCAiRm9yY2UgYm9keSB5YXcgdmFsdWUiLCBtYXRoLmFicyhnZXRfbWF4X2ZlZXRfeWF3KHBsYXllcikpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFic195YXdfc2V0W3BsYXllcl0gPSB0cnVlDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWJzX3lhd19zZXRbcGxheWVyXSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxpc3Quc2V0KHBsYXllciwgIkZvcmNlIGJvZHkgeWF3IiwgZmFsc2UpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxpc3Quc2V0KHBsYXllciwgIkZvcmNlIGJvZHkgeWF3IHZhbHVlIiwgMCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYnNfeWF3X3NldFtwbGF5ZXJdID0gZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBvbGRfc2ltdWxhdGlvbl90aW1lW3BsYXllcl0gPSBzaW11bGF0aW9uX3RpbWUNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQNCmVuZA0KDQoNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInJ1bl9jb21tYW5kIiwgZnVuY3Rpb24oY21kKQ0KICAgIGlmIG5vdCB1aS5nZXQoZ2VuZXJhbF90YWIucmVzb2x2ZXIpIHRoZW4NCiAgICAgICAgcmV0dXJuDQogICAgZW5kDQoNCiAgICBsb2NhbCBlbmVtaWVzID0gZW50aXR5LmdldF9wbGF5ZXJzKHRydWUpDQogICAgZm9yIGkgPSAxLCAjZW5lbWllcyBkbw0KICAgICAgICBsb2NhbCBwbGF5ZXIgPSBlbmVtaWVzW2ldDQogICAgICAgIGxvY2FsIGV5ZV9hbmdsZXMgPSBlbnRpdHkuZ2V0X3Byb3AocGxheWVyLCAibV9hbmdFeWVBbmdsZXMiKQ0KDQogICAgICAgIGVudGl0eS5zZXRfcHJvcChwbGF5ZXIsICJtX2FuZ0V5ZUFuZ2xlcyIsIGFkYXB0aXZlX3Jlc29sdmUocGxheWVyLCBleWVfYW5nbGVzKSkNCiAgICBlbmQNCmVuZCkgICAgDQoNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInJ1bl9jb21tYW5kIiwgZnVuY3Rpb24oY21kKQ0KICAgIGlmIG5vdCB1aS5nZXQoZ2VuZXJhbF90YWIucmVzb2x2ZXIpIHRoZW4NCiAgICAgICAgcmV0dXJuDQogICAgZW5kDQoNCiAgICByZXNvbHZlX29uc2hvdF9yZWNvcmRzKCkNCg0KZW5kKQ0KDQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJzaHV0ZG93biIsIGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBlbmVtaWVzID0gZW50aXR5LmdldF9wbGF5ZXJzKHRydWUpDQogICAgaWYgbm90IGVuZW1pZXMgdGhlbg0KICAgICAgICByZXR1cm4NCiAgICBlbmQNCg0KICAgIGZvciBpID0gMSwgI2VuZW1pZXMgZG8NCiAgICAgICAgbG9jYWwgcGxheWVyID0gZW5lbWllc1tpXQ0KICAgICAgICBsb2NhbCB3ZWFwb24gPSBlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24ocGxheWVyKQ0KICAgICAgICBwbGlzdC5zZXQocGxheWVyLCAiRm9yY2UgYm9keSB5YXciLCBmYWxzZSkNCiAgICAgICAgcGxpc3Quc2V0KHBsYXllciwgIkZvcmNlIGJvZHkgeWF3IHZhbHVlIiwgMCkNCiAgICAgICAgYWJzX3lhd19zZXRbcGxheWVyXSA9IGZhbHNlDQogICAgZW5kDQplbmQpDQoNCmxvY2FsIGN1cl9jbWRfbnVtID0gMA0KbG9jYWwgdHBfdGljayA9IDANCmxvY2FsIHByZV90aWNrID0gbmlsDQpsb2NhbCB0cF90dXJuID0gZmFsc2UNCmxvY2FsIGlzX3RwID0gZmFsc2UNCg0KY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygic2V0dXBfY29tbWFuZCIsIGZ1bmN0aW9uKGNtZCkNCiAgICBpZiBub3QgdWkuZ2V0KGdlbmVyYWxfdGFiLnRlbGVwb3J0KSBvciBub3QgdWkuZ2V0KGdlbmVyYWxfdGFiLnRlbGVwb3J0X2tleSkgb3Igbm90ICh1aS5nZXQoa2V5c2ZvcmluZHMuZG91YmxldGFwWzFdKSBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmRvdWJsZXRhcFsyXSkpIHRoZW4gcmV0dXJuIGVuZA0KICAgIGlmIChhbnRpX2FpbXM6Z2V0X2NvbmRpdGlvbl90eXBlKCkgPT0gIkluIEFpciAmIENyb3VjaGluZyIgb3IgYW50aV9haW1zOmdldF9jb25kaXRpb25fdHlwZSgpID09ICJJbiBBaXIiIG9yIGFudGlfYWltczpnZXRfY29uZGl0aW9uX3R5cGUoKSA9PSAiTW92aW5nIikgdGhlbg0KICAgICAgICBsb2NhbCBhY3RpdmUgPSBmYWxzZQ0KICAgICAgICBsb2NhbCBscCA9IGVudGl0eS5nZXRfcGxheWVycyh0cnVlKQ0KICAgICAgICBpZiBscCB+PSBuaWwgdGhlbg0KICAgICAgICAgICAgZm9yIF8sIGVuZW15IGluIHBhaXJzKGxwKSBkbw0KICAgICAgICAgICAgICAgIGxvY2FsIHZ1bG5lcmFibGUgPSBiaXQuYmFuZChlbnRpdHkuZ2V0X2VzcF9kYXRhKGVuZW15KS5mbGFncywgYml0LmxzaGlmdCgxLCAxMSkpID09IDIwNDgNCiAgICAgICAgICAgICAgICBpZiB2dWxuZXJhYmxlIHRoZW4gYWN0aXZlID0gdHJ1ZSBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICAgICAgaWYgYWN0aXZlIHRoZW4NCiAgICAgICAgICAgIGlmIHRwX3RpY2sgPj0gMTQgdGhlbg0KICAgICAgICAgICAgICAgIHRwX3R1cm4gPSB0cnVlDQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGlmIHRwX3R1cm4gYW5kIHRwX3RpY2sgPT0gMCB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KGtleXNmb3JpbmRzLmRvdWJsZXRhcFsxXSwgZmFsc2UpDQogICAgICAgICAgICAgICAgY2xpZW50LmRlbGF5X2NhbGwoMC4xLCBmdW5jdGlvbigpIHVpLnNldChrZXlzZm9yaW5kcy5kb3VibGV0YXBbMV0sIHRydWUpIGVuZCkNCiAgICAgICAgICAgICAgICB0cF90dXJuID0gZmFsc2UNCiAgICAgICAgICAgICAgICBpc190cCA9IHRydWUgICAgDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgaXNfdHAgPSBmYWxzZQ0KICAgICAgICBlbmQNCiAgICBlbmQNCmVuZCkNCg0KY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygicnVuX2NvbW1hbmQiLCBmdW5jdGlvbihjbWQpDQogICAgaWYgbm90IHVpLmdldChnZW5lcmFsX3RhYi50ZWxlcG9ydCkgb3Igbm90IHVpLmdldChnZW5lcmFsX3RhYi50ZWxlcG9ydF9rZXkpIHRoZW4gcmV0dXJuIGVuZA0KICAgIGN1cl9jbWRfbnVtID0gY21kLmNvbW1hbmRfbnVtYmVyDQplbmQpDQoNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soImxldmVsX2luaXQiLCBmdW5jdGlvbigpDQogICAgcHJlX3RpY2ssIGN1cl9jbWRfbnVtID0gbmlsLCAwDQplbmQpDQoNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInByZWRpY3RfY29tbWFuZCIsIGZ1bmN0aW9uKGNtZCkNCiAgICBpZiBub3QgdWkuZ2V0KGdlbmVyYWxfdGFiLnRlbGVwb3J0KSBvciBub3QgdWkuZ2V0KGdlbmVyYWxfdGFiLnRlbGVwb3J0X2tleSkgdGhlbiByZXR1cm4gZW5kDQogICAgaWYgaXNfdHAgPT0gdHJ1ZSB0aGVuIHJldHVybiBlbmQNCiAgICBpZiBjbWQuY29tbWFuZF9udW1iZXIgPT0gY3VyX2NtZF9udW0gdGhlbg0KICAgICAgICBjdXJfY21kX251bSA9IDANCiAgICAgICAgbG9jYWwgbHAgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpDQogICAgICAgIGxvY2FsIHRpY2tfYmFzZSA9IGVudGl0eS5nZXRfcHJvcChscCwgIm1fblRpY2tCYXNlIikNCg0KICAgICAgICBpZiBwcmVfdGljayB+PSBuaWwgdGhlbg0KICAgICAgICAgICAgdHBfdGljayA9IHRpY2tfYmFzZSAtIHByZV90aWNrDQogICAgICAgIGVuZA0KDQogICAgICAgIHByZV90aWNrID0gbWF0aC5tYXgodGlja19iYXNlLCBwcmVfdGljayBvciAwKQ0KICAgIGVuZA0KZW5kKQ0KDQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwYWludCIsIGZ1bmN0aW9uKCkNCiAgICBpZiB1aS5nZXQoZ2VuZXJhbF90YWIudGVsZXBvcnQpIGFuZCB1aS5nZXQoZ2VuZXJhbF90YWIudGVsZXBvcnRfa2V5KSB0aGVuDQogICAgICAgIHJlbmRlcmVyLmluZGljYXRvcigyNTUsIDI1NSwgMjU1LCAyMDAsICJBdXRvbWF0aWMgVGVsZXBvcnQiKQ0KICAgIGVuZA0KZW5kKQ0KDQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJzZXR1cF9jb21tYW5kIiwgZnVuY3Rpb24oY21kKQ0KICAgIGxvY2FsIHRocmVhdCA9IGNsaWVudC5jdXJyZW50X3RocmVhdCgpDQogICAgaWYgbm90IHVpLmdldChnZW5lcmFsX3RhYi5sYWdleHBsb2l0KSBvciBub3QgdWkuZ2V0KGdlbmVyYWxfdGFiLmxhZ2V4cGxvaXRfa2V5KSB0aGVuIHVpLnNldChrZXlzZm9yaW5kcy5haW1ib3RbMV0sIHRydWUpIHJldHVybiBlbmQNCiAgICBpZiBjbWQuaW5fanVtcCA9PSAxIGFuZCB1aS5nZXQoa2V5c2ZvcmluZHMuZG91YmxldGFwWzFdKSBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmRvdWJsZXRhcFsyXSkgdGhlbg0KICAgICAgICB1aS5zZXQoa2V5c2ZvcmluZHMuYWltYm90WzFdLCBmYWxzZSkNCiAgICAgICAgdWkuc2V0KGtleXNmb3JpbmRzLmRvdWJsZXRhcFsxXSwgZ2xvYmFscy50aWNrY291bnQoKSAlIDMgPiAxKQ0KICAgICAgICBjbWQuZm9yY2VfZGVmZW5zaXZlID0gdHJ1ZQ0KICAgIGVsc2UNCiAgICAgICAgdWkuc2V0KGtleXNmb3JpbmRzLmFpbWJvdFsxXSwgdHJ1ZSkNCiAgICAgICAgdWkuc2V0KGtleXNmb3JpbmRzLmRvdWJsZXRhcFsxXSwgdHJ1ZSkNCiAgICBlbmQNCmVuZCkNCg0KY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygnc2V0dXBfY29tbWFuZCcsIGZ1bmN0aW9uKGNtZCkNCiAgICBpZiBub3QgdWkuZ2V0KGdlbmVyYWxfdGFiLm5sZHQpIHRoZW4gcmV0dXJuIGVuZA0KICAgIGlmIG5vdCAoKHVpLmdldChrZXlzZm9yaW5kcy5kb3VibGV0YXBbMV0pIGFuZCB1aS5nZXQoa2V5c2ZvcmluZHMuZG91YmxldGFwWzJdKSkgb3IgKHVpLmdldChrZXlzZm9yaW5kcy5oaWRlc2hvdHNbMV0pIGFuZCB1aS5nZXQoa2V5c2ZvcmluZHMuaGlkZXNob3RzWzJdKSkpIHRoZW4NCiAgICAgICAgdWkuc2V0KGtleXNmb3JpbmRzLmFpbWJvdFsxXSwgdHJ1ZSkNCiAgICAgICAgcmV0dXJuDQogICAgZW5kDQoNCiAgICBsb2NhbCB3cG4gPSBlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkNCg0KICAgIGxvY2FsIGZsYWdzID0gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZGbGFncyIpDQogICAgbG9jYWwgb25ncm91bmQgPSBiaXQuYmFuZChmbGFncywgMSkgfj0gMCBhbmQgY21kLmluX2p1bXAgPT0gMA0KDQogICAgaWYgd3BuID09IG5pbCB0aGVuIHJldHVybiBlbmQNCg0KICAgIGxvY2FsIHdwbl9jbGFzcyA9IGVudGl0eS5nZXRfY2xhc3NuYW1lKHdwbikNCg0KICAgIGlmIHdwbl9jbGFzcyA9PSAnQ1dlYXBvblNTRzA4JyBvciBub3Qgb25ncm91bmQgdGhlbg0KICAgIA0KICAgIGxvY2FsIHRpY2tiYXNlID0gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICdtX25UaWNrQmFzZScpDQogICAgbG9jYWwgc2hpZnQgPSBtYXRoLmZsb29yKHRpY2tiYXNlIC0gZ2xvYmFscy50aWNrY291bnQoKSAtIDMgLSB0b3RpY2tzKGNsaWVudC5sYXRlbmN5KCkpICogLjQpDQogICAgbG9jYWwgdGlja3NfY2hhcmdlZCA9IHNoaWZ0IDw9IC0xNSArICh1aS5nZXQoa2V5c2ZvcmluZHMuZHRfbGltaXQpIC0gMSkgKyA1DQoNCiAgICBsb2NhbCB0aHJlYXQgPSBjbGllbnQuY3VycmVudF90aHJlYXQoKQ0KDQogICAgaWYgdGlja3NfY2hhcmdlZCBvciBub3QgdGhyZWF0IG9yIGJpdC5iYW5kKGVudGl0eS5nZXRfZXNwX2RhdGEodGhyZWF0KS5mbGFncywgYml0LmxzaGlmdCgxLCAxMSkpIH49IDIwNDggdGhlbg0KICAgICAgICB1aS5zZXQoa2V5c2ZvcmluZHMuYWltYm90WzFdLCB0cnVlKQ0KICAgICAgICByZXR1cm4NCiAgICBlbmQNCg0KICAgIHVpLnNldChrZXlzZm9yaW5kcy5haW1ib3RbMV0sIGZhbHNlKQ0KZW5kDQplbmQpDQoNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ3NodXRkb3duJywgZnVuY3Rpb24oKQ0KICAgIHVpLnNldChrZXlzZm9yaW5kcy5haW1ib3RbMV0sIHRydWUpDQplbmQpDQoNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInNldHVwX2NvbW1hbmQiLCBmdW5jdGlvbihjbWQpDQogICAgaWYgbm90IHVpLmdldChnZW5lcmFsX3RhYi5haXJzdG9wKSB0aGVuIHJldHVybiBlbmQNCiAgICBpZiBub3QgdWkuZ2V0KGdlbmVyYWxfdGFiLmFpcnN0b3BrZXkpIHRoZW4gcmV0dXJuIGVuZA0KICAgIGxvY2FsIGxwID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQ0KICAgIGxvY2FsIHRocmVhdCA9IGNsaWVudC5jdXJyZW50X3RocmVhdCgpDQogICAgaWYgZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSA9PSBuaWwgb3IgY2xpZW50LmN1cnJlbnRfdGhyZWF0KCkgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZA0KDQogICAgYWlyc3RvcCA9IGZhbHNlDQoNCiAgICBsb2NhbCB3cG4gPSBlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkNCg0KICAgIGlmIHdwbiA9PSBuaWwgdGhlbiByZXR1cm4gZW5kDQoNCiAgICBsb2NhbCB3cG5fY2xhc3MgPSBlbnRpdHkuZ2V0X2NsYXNzbmFtZSh3cG4pDQoNCiAgICBpZiB3cG5fY2xhc3Mgfj0gJ0NXZWFwb25TU0cwOCcgdGhlbiByZXR1cm4gZW5kDQoNCiAgICBpZiBub3QgZW50aXR5X2lzX3JlYWR5KGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpIG9yIG5vdCBlbnRpdHlfY2FuX2ZpcmUod3BuKSB0aGVuIHJldHVybiBlbmQNCg0KCWxvY2FsIGZsYWdzID0gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZGbGFncyIpDQogICAgbG9jYWwgb25ncm91bmQgPSBiaXQuYmFuZChmbGFncywgMSkgfj0gMCBhbmQgY21kLmluX2p1bXAgPT0gMA0KDQogICAgaWYgb25ncm91bmQgdGhlbiByZXR1cm4gZW5kDQoNCiAgICBsb2NhbCBkYXRhID0gY3Nnb193ZWFwb25zKHdwbikNCg0KICAgIGxvY2FsIG9yaWdpbiA9IHZlY3RvcihlbnRpdHkuZ2V0X29yaWdpbihlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSkNCiAgICBsb2NhbCBwb3MgPSB2ZWN0b3IoZW50aXR5LmdldF9vcmlnaW4oY2xpZW50LmN1cnJlbnRfdGhyZWF0KCkpKQ0KICAgIGxvY2FsIG1heF9kYW1hZ2UgPSAwLjENCiAgICBsb2NhbCBfLCBkYW1hZ2UgPSBjbGllbnQudHJhY2VfYnVsbGV0KGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksIG9yaWdpbi54LCBvcmlnaW4ueSwgb3JpZ2luLnosIHBvcy54LCBwb3MueSwgcG9zLnogICk7DQoNCiAgICBsb2NhbCBoZWFsdGggPSBlbnRpdHkuZ2V0X3Byb3AoY2xpZW50LmN1cnJlbnRfdGhyZWF0KCksICdtX2lIZWFsdGgnKTsNCg0KICAgIGlmIGRhbWFnZSA8IG1heF9kYW1hZ2UgdGhlbg0KICAgICAgICByZXR1cm4NCiAgICBlbmQNCg0KICAgIGFpcnN0b3AgPSB0cnVlIA0KDQogICAgYXV0b3N0b3AoY21kLCAxKQ0KZW5kKQ0KDQpsb2NhbCB3c19jbGFudGFnID0gew0KICAgICIgICIsDQogICAgIiAgIiwNCiAgICAiIHxeICIsDQogICAgIiBQICIsDQogICAgIiBQfF4gIiwNCiAgICAiIFBSICIsDQogICAgIiBQUl4gIiwNCiAgICAiIFBSQSAiLA0KICAgICIgUFJBfCAiLA0KICAgICIgUFJBSS4gIiwNCiAgICAiIFBSQUk1ICIsDQogICAgIiBQUkFJUyAiLA0KICAgICIgUFJBSTUzICIsDQogICAgIiBQUkFJU0UgIiwNCiAgICAiIFBSQUlTRTAgIiwNCiAgICAiIFBSQUlTRS4gIiwNCiAgICAiIFBSQUlTRS4xICIsDQogICAgIiBQUkFJU0UuTCAiLA0KICAgICIgUFJBSVNFLkw1ICIsDQogICAgIiBQUkFJU0UuTFUgIiwNCiAgICAiIFBSQUlTRS5MVTQgIiwNCiAgICAiIFBSQUlTRS5MVUEgIiwNCiAgICAiIFBSQUlTRS5MVUEgIiwNCiAgICAiIFBSQUlTRS5MVUEgIiwNCiAgICAiIFBSQUlTRS5MVUEgIiwNCiAgICAiIFBSQUlTRS5MVTQgIiwNCiAgICAiIFBSQUlTRS5MVSAiLA0KICAgICIgUFJBSVNFLkw1ICIsDQogICAgIiBQUkFJU0UuTCAiLA0KICAgICIgUFJBSVNFLjEgIiwNCiAgICAiIFBSQUlTRS4gIiwNCiAgICAiIFBSQUlTRTAgIiwNCiAgICAiIFBSQUlTRSAiLA0KICAgICIgUFJBSTUzICIsDQogICAgIiBQUkFJUyAiLA0KICAgICIgUFJBSTUgIiwNCiAgICAiIFBSQUkgIiwNCiAgICAiIFBSQXwgIiwNCiAgICAiIFBSQSAiLA0KICAgICIgUFJeICIsDQogICAgIiBQUiAiLA0KICAgICIgUHxeICIsDQogICAgIiBQICIsDQogICAgIiB8XiAiLA0KICAgICIgICIsDQogICAgIiAgIiwNCn0NCg0KbG9jYWwgaXRlciA9IDANCmxvY2FsIHdzdGltZSA9IDANCmxvY2FsIGZ1bmN0aW9uIHJvdGF0ZV9zdHJpbmcoKQ0KICAgIGxvY2FsIHJldF9zdHIgPSB3c19jbGFudGFnW2l0ZXJdDQogICAgaWYgaXRlciA8IDQ1IHRoZW4NCiAgICAgICAgaXRlciA9IGl0ZXIgKyAxDQogICAgZWxzZQ0KICAgICAgICBpdGVyID0gMQ0KICAgIGVuZA0KICAgIHJldHVybiByZXRfc3RyDQplbmQNCg0KY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygncGFpbnQnLCBmdW5jdGlvbigpDQogICAgaWYgbm90IHVpLmdldCh2aXN1YWxzX3RhYi5jbGFudGFnKSB0aGVuIGNsaWVudC5zZXRfY2xhbl90YWcoIiIpIHJldHVybiBlbmQNCiAgICBpZiB1aS5nZXQodWkucmVmZXJlbmNlKCJNaXNjIiwgIk1pc2NlbGxhbmVvdXMiLCAiQ2xhbiB0YWcgc3BhbW1lciIpKSB0aGVuIHJldHVybiBlbmQNCiAgICBpZiB3c3RpbWUgKyAwLjMgPCBnbG9iYWxzLmN1cnRpbWUoKSB0aGVuDQogICAgICAgIGNsaWVudC5zZXRfY2xhbl90YWcocm90YXRlX3N0cmluZygpKQ0KICAgICAgICB3c3RpbWUgPSBnbG9iYWxzLmN1cnRpbWUoKQ0KICAgIGVsc2VpZiB3c3RpbWUgPiBnbG9iYWxzLmN1cnRpbWUoKSB0aGVuDQogICAgICAgIHdzdGltZSA9IGdsb2JhbHMuY3VydGltZSgpDQogICAgZW5kDQplbmQpDQoNCmxvY2FsIGNoYXRfc3BhbW1lciA9IHt9DQoNCmNoYXRfc3BhbW1lci5waHJhc2VzID0gew0KICAgIGVuZ2xpc2ggPSB7DQogICAgICAgIHsiU1RGVSBBbmQgR2V0IG1lZ2FtaXguR1MifSwNCiAgICAgICAgeyJtZWdhbWl4LkdTIGlzIHRoZSBiZXN0IHNjcmlwdCJ9LA0KICAgICAgICB7Ik5pZ2dlciByZXRhcmRlZCBkZXN0cm95ZWQifSwNCiAgICAgICAgeyJTb3JyeSBpbSBqdXN0IHVuaGl0dGFibGUifSwNCiAgICAgICAgeyIo4pejX+KXoiltZWdhbWl4KOKXo1/il6IpIn0sDQogICAgICAgIHsidG9vIGV6IGZvciBtZWdhbWl4LkdTIn0sICANCiAgICAgICAgeyJ5b3UgaGF2ZSBubyBjaGFuY2UgdG8gd2luIG1lIHVudGlsIHlvdSBnZXQgbWVnYW1peC5HUyJ9LCAgDQogICAgICAgIHsibW9zdCB1c2VsZXNzIHBsYXllciBmb3VuZCJ9LCAgDQogICAgfSwNCiAgICBvbmUgPSB7DQogICAgICAgIHsiMSJ9LA0KICAgIH0sDQp9DQoNCmNoYXRfc3BhbW1lci5waHJhc2VfY291bnQgPSB7DQogICAgZW5nbGlzaCA9IDAsDQogICAgb25lID0gMCwNCn0NCg0KY2hhdF9zcGFtbWVyLmhhbmRsZSA9IGZ1bmN0aW9uKGUpDQoNCiAgICBsb2NhbCBwbGF5ZXIgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpDQoNCiAgICBpZiBwbGF5ZXIgPT0gbmlsIHRoZW4NCiAgICAgICAgcmV0dXJuDQogICAgZW5kDQoNCiAgICBsb2NhbCB2aWN0aW0gPSBjbGllbnQudXNlcmlkX3RvX2VudGluZGV4KGUudXNlcmlkKQ0KDQogICAgaWYgdmljdGltID09IG5pbCB0aGVuDQogICAgICAgIHJldHVybg0KICAgIGVuZA0KDQogICAgbG9jYWwgYXR0YWNrZXIgPSBjbGllbnQudXNlcmlkX3RvX2VudGluZGV4KGUuYXR0YWNrZXIpDQoNCiAgICBpZiBhdHRhY2tlciA9PSBuaWwgdGhlbg0KICAgICAgICByZXR1cm4NCiAgICBlbmQNCg0KICAgIGlmIHVpLmdldChnZW5lcmFsX3RhYi50cmFzaHRhbGspID09ICJFbmdsaXNoIiB0aGVuDQoNCiAgICAgICAgY2hhdF9zcGFtbWVyLnBocmFzZV9jb3VudC5lbmdsaXNoID0gY2xpZW50LnJhbmRvbV9pbnQoMSw4KQ0KDQogICAgbG9jYWwgcGhyYXNlID0gew0KICAgICAgICBlbmdsaXNoID0gY2hhdF9zcGFtbWVyLnBocmFzZXMuZW5nbGlzaFtjaGF0X3NwYW1tZXIucGhyYXNlX2NvdW50LmVuZ2xpc2hdLA0KICAgIH0NCg0KICAgIGlmIHVpLmdldChnZW5lcmFsX3RhYi50cmFzaHRhbGspIH49ICJPZmYiIHRoZW4NCiAgICAgICAgaWYgYXR0YWNrZXIgPT0gcGxheWVyIGFuZCB2aWN0aW0gfj0gcGxheWVyIHRoZW4NCiAgICAgICAgICAgIGZvciBpID0gMSwgI3BocmFzZS5lbmdsaXNoIGRvDQogICAgICAgICAgICAgICAgICAgIGNsaWVudC5leGVjKCgic2F5ICVzIik6Zm9ybWF0KHBocmFzZS5lbmdsaXNoW2ldKSkNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQNCg0KZWxzZWlmIHVpLmdldChnZW5lcmFsX3RhYi50cmFzaHRhbGspID09ICIxIiB0aGVuDQoNCiAgICBjaGF0X3NwYW1tZXIucGhyYXNlX2NvdW50Lm9uZSA9IGNoYXRfc3BhbW1lci5waHJhc2VfY291bnQub25lICsgMQ0KICAgIGlmIGNoYXRfc3BhbW1lci5waHJhc2VfY291bnQub25lID4gI2NoYXRfc3BhbW1lci5waHJhc2VzLm9uZSB0aGVuDQogICAgICAgIGNoYXRfc3BhbW1lci5waHJhc2VfY291bnQub25lID0gMQ0KICAgIGVuZA0KDQogICAgbG9jYWwgcGhyYXNlID0gew0KICAgICAgICBvbmUgPSBjaGF0X3NwYW1tZXIucGhyYXNlcy5vbmVbY2hhdF9zcGFtbWVyLnBocmFzZV9jb3VudC5vbmVdLA0KICAgIH0NCg0KICAgIGlmIHVpLmdldChnZW5lcmFsX3RhYi50cmFzaHRhbGspIH49ICJPZmYiIHRoZW4NCiAgICAgICAgaWYgYXR0YWNrZXIgPT0gcGxheWVyIGFuZCB2aWN0aW0gfj0gcGxheWVyIHRoZW4NCiAgICAgICAgICAgIGZvciBpID0gMSwgI3BocmFzZS5vbmUgZG8NCiAgICAgICAgICAgICAgICAgICAgY2xpZW50LmV4ZWMoKCJzYXkgJXMiKTpmb3JtYXQocGhyYXNlLm9uZVtpXSkpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgZW5kDQplbmQNCmVuZA0KDQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCdwbGF5ZXJfZGVhdGgnLCBjaGF0X3NwYW1tZXIuaGFuZGxlKQ0KDQotLSBtZWdhbWl4IElORElDQVRPUlMNCmxvY2FsIGN1cnRpbWUgPSBnbG9iYWxzLmN1cnRpbWUNCmxvY2FsIHVuc2V0X2V2ZW50X2NhbGxiYWNrID0gY2xpZW50LnVuc2V0X2V2ZW50X2NhbGxiYWNrDQpsb2NhbCByZW5kZXJfY2lyY2xlX291dGxpbmUsIG1lYXN1cmVfdGV4dCwgcmVuZGVyX3RleHQgPSByZW5kZXJlci5jaXJjbGVfb3V0bGluZSwgcmVuZGVyZXIubWVhc3VyZV90ZXh0LCByZW5kZXJlci50ZXh0DQpsb2NhbCB1aV9nZXQgPSB1aS5nZXQNCg0KbG9jYWwgeCwgeSA9IGNsaWVudC5zY3JlZW5fc2l6ZSgpDQoNCmxvY2FsIFdpZHRoID0gNg0KbG9jYWwgSGVpZ2h0ID0gKHkgLyAyKSArIHkgLzEyDQpmdW5jdGlvbiBsZXJwKGEsIGIsIHQpDQogICAgaWYgbm90IGIgb3Igbm90IGEgb3Igbm90IHQgdGhlbiByZXR1cm4gZW5kDQogICAgcmV0dXJuIGEgKyAoYiAtIGEpICogdA0KZW5kDQpsb2NhbCBpbmRpY2F0b3JzID0ge30NCg0KbG9jYWwgVElNRV9UT19QTEFOVF9CT01CID0gMw0KbG9jYWwgdGltZUF0Qm9tYldpbGxCZVBsYW50ZWQNCg0KbG9jYWwgZnVuY3Rpb24gaW5uZXJDaXJjbGVPdXRsaW5lUGVyY2VudGFnZSgpDQoJbG9jYWwgdGltZUVsYXBzZWQgPSAoY3VydGltZSgpICsgVElNRV9UT19QTEFOVF9CT01CKSAtIHRpbWVBdEJvbWJXaWxsQmVQbGFudGVkDQoJbG9jYWwgdGltZUVsYXBzZWRJblBlcmMgPSAodGltZUVsYXBzZWQgLyBUSU1FX1RPX1BMQU5UX0JPTUIgKiAxMDApICsgMC41DQoJcmV0dXJuIHRpbWVFbGFwc2VkSW5QZXJjICogMC4wMQ0KZW5kDQoNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ2JvbWJfYmVnaW5wbGFudCcsIGZ1bmN0aW9uICgpDQoJdGltZUF0Qm9tYldpbGxCZVBsYW50ZWQgPSBjdXJ0aW1lKCkgKyBUSU1FX1RPX1BMQU5UX0JPTUINCglpc0JvbWJCZWluZ1BsYW50ZWQgPSB0cnVlDQplbmQpDQoNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ2JvbWJfYWJvcnRwbGFudCcsIGZ1bmN0aW9uICgpDQoJaXNCb21iQmVpbmdQbGFudGVkID0gZmFsc2UNCmVuZCkNCg0KY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygnYm9tYl9wbGFudGVkJywgZnVuY3Rpb24gKCkNCglpc0JvbWJCZWluZ1BsYW50ZWQgPSBmYWxzZQ0KZW5kKQ0KDQotLQ0KbG9jYWwgZnVuY3Rpb24gSW5kaWNhdG9yQ2FsbGJhY2soaW5kaWNhdG9yKQ0KICAgIGlmIG5vdCB1aS5nZXQodmlzdWFsc190YWIuaW5kaWNhdG9ycykgdGhlbg0KICAgICAgICByZXR1cm4gZW5kDQoJdGFibGUuaW5zZXJ0KGluZGljYXRvcnMsIGluZGljYXRvcikNCmVuZA0KDQpsb2NhbCBncm91bmRfdGlja3MsIGVuZF90aW1lID0gMCwgMA0KDQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwcmVfcmVuZGVyIiwgZnVuY3Rpb24oKQ0KICAgIGxvY2FsIGxwLCBscF9wdHIgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCBleHRfZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQ0KICAgIGlmIG5vdCBscCBvciBub3QgbHBfcHRyIHRoZW4gcmV0dXJuIGVuZA0KICAgIGxvY2FsIG9uX2dyb3VuZCA9IGJpdC5iYW5kKGxwX3B0cjpnZXRfcHJvcCgibV9mRmxhZ3MiKSwgMSkNCiAgICBpZiAoZW50aXR5LmlzX2FsaXZlKGxwKSA9PSBmYWxzZSkgdGhlbiByZXR1cm4gZW5kDQogICAgDQogICAgaWYgdWkuZ2V0KHZpc3VhbHNfdGFiLmdyb3VuZGJyZWFrZXIpID09ICJCYWNrd2FyZHMiIHRoZW4gZW50aXR5LnNldF9wcm9wKGxwLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCA4LCAwKSANCiAgICBlbHNlaWYgdWkuZ2V0KHZpc3VhbHNfdGFiLmdyb3VuZGJyZWFrZXIpID09ICJNb29uIFdhbGsiIHRoZW4gZW50aXR5LnNldF9wcm9wKGxwLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCAxLCA3KQ0KICAgIGVuZA0KDQogICAgaWYgdWkuZ2V0KHZpc3VhbHNfdGFiLmFpcmJyZWFrZXIpID09ICJGb3JjZSBGYWxsaW5nIiB0aGVuIGVudGl0eS5zZXRfcHJvcChscCwgIm1fZmxQb3NlUGFyYW1ldGVyIiwgMSwgNikNCiAgICBlbHNlaWYgdWkuZ2V0KHZpc3VhbHNfdGFiLmFpcmJyZWFrZXIpID09ICJNb29uIFdhbGsiIHRoZW4gaWYgb25fZ3JvdW5kID09IDAgdGhlbiBscF9wdHI6Z2V0X2FuaW1fb3ZlcmxheSg2KS53ZWlnaHQgPSAxIGVuZA0KICAgIGVuZA0KDQogICAgaWYgaW5jbHVkZXModWkuZ2V0KHZpc3VhbHNfdGFiLmFuaW1icmVha2VyKSwgIkxhbmRpbmcgUGl0Y2giKSB0aGVuDQogICAgICAgIGlmIG9uX2dyb3VuZCA9PSAxIHRoZW4NCiAgICAgICAgICAgIGdyb3VuZF90aWNrcyA9IGdyb3VuZF90aWNrcyArIDENCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgZ3JvdW5kX3RpY2tzID0gMA0KICAgICAgICAgICAgZW5kX3RpbWUgPSBnbG9iYWxzLmN1cnRpbWUoKSArIDENCiAgICAgICAgZW5kDQoNCiAgICAgICAgaWYgZ3JvdW5kX3RpY2tzID4gZ2xvYmFscy5jaG9rZWRjb21tYW5kcygpICsgMSBhbmQgZW5kX3RpbWUgPiBnbG9iYWxzLmN1cnRpbWUoKSB0aGVuDQogICAgICAgICAgICBlbnRpdHkuc2V0X3Byb3AobHAsICJtX2ZsUG9zZVBhcmFtZXRlciIsIDAuNSwgMTIpDQogICAgICAgIGVuZA0KICAgIGVuZA0KDQogICAgaWYgaW5jbHVkZXModWkuZ2V0KHZpc3VhbHNfdGFiLmFuaW1icmVha2VyKSwgIk1vdmUgTGVhbiIpIHRoZW4NCiAgICAgICAgbHBfcHRyOmdldF9hbmltX292ZXJsYXkoMTIpLndlaWdodCA9IG1hdGgucmFuZG9tKDEsMykNCiAgICBlbmQNCg0KICAgIGlmIGluY2x1ZGVzKHVpLmdldCh2aXN1YWxzX3RhYi5hbmltYnJlYWtlciksICJTbGlkZSBPbiBTbG93IFdhbGsiKSB0aGVuDQogICAgICAgIGVudGl0eS5zZXRfcHJvcChscCwgIm1fZmxQb3NlUGFyYW1ldGVyIiwgMCwgOSkNCiAgICBlbmQNCg0KICAgIGlmIGluY2x1ZGVzKHVpLmdldCh2aXN1YWxzX3RhYi5hbmltYnJlYWtlciksICJHcm91bmQgRWFydGhxdWFrZSIpIHRoZW4NCiAgICAgICAgaWYgb25fZ3JvdW5kID09IDEgdGhlbiBlbnRpdHkuc2V0X3Byb3AobHAsICJtX2ZsUG9zZVBhcmFtZXRlciIsIDEsIGNsaWVudC5yYW5kb21fZmxvYXQoNSwxMCkpIGVuZCANCiAgICBlbmQNCiAgICANCiAgICBpZiBpbmNsdWRlcyh1aS5nZXQodmlzdWFsc190YWIuYW5pbWJyZWFrZXIpLCAiQWlyIEVhcnRocXVha2UiKSB0aGVuDQogICAgICAgIGlmIG9uX2dyb3VuZCA9PSAwIHRoZW4gZW50aXR5LnNldF9wcm9wKGxwLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCAxLCBjbGllbnQucmFuZG9tX2Zsb2F0KDUsMTApKSBlbmQgDQogICAgZW5kDQplbmQpDQoNCi0tIEVWRU5UIExPR1MNCi0tIGxvY2FsIHZhcmlhYmxlcyBmb3IgQVBJIGZ1bmN0aW9ucy4gYW55IGNoYW5nZXMgdG8gdGhlIGxpbmUgYmVsb3cgd2lsbCBiZSBsb3N0IG9uIHJlLWdlbmVyYXRpb24NCmxvY2FsIG5vdGlmeV9sb2wgPSB7fQ0KZnVuY3Rpb24gbm90aWZ5X3JlbmRlcigpIA0KICAgIGlmIHVpLmdldCh2aXN1YWxzX3RhYi5ldmVudGxvZ3MpIHRoZW4NCiAgICAgICAgaWYgaW5jbHVkZXModWkuZ2V0KHZpc3VhbHNfdGFiLmV2ZW50c19zdHlsZSksICJtZWdhbWl4IikgdGhlbg0KICAgIGxvY2FsIFgsIFkgPSBjbGllbnQuc2NyZWVuX3NpemUoKQ0KICAgIGZvciBpLCBpbmZvX25vdGkgaW4gaXBhaXJzKG5vdGlmeV9sb2wpIGRvDQogICAgICAgIGlmIGkgPiA5OSB0aGVuDQogICAgICAgICAgICB0YWJsZS5yZW1vdmUobm90aWZ5X2xvbCwgaSkNCiAgICAgICAgZW5kDQogICAgICAgIGlmIGluZm9fbm90aS50ZXh0IH49IG5pbCBhbmQgaW5mb19ub3RpLnRleHQgfj0gIiIgdGhlbg0KICAgICAgICAgICAgbG9jYWwgY29sb3IgPSBpbmZvX25vdGkuY29sb3INCiAgICAgICAgICAgIGxvY2FsIHdpZHRoID0gdmVjdG9yKHJlbmRlcmVyLm1lYXN1cmVfdGV4dCgiYyIsIGluZm9fbm90aS50ZXh0KSkNCiAgICAgICAgICAgIGlmIGluZm9fbm90aS50aW1lciArIDggPCBnbG9iYWxzLnJlYWx0aW1lKCkgdGhlbg0KICAgICAgICAgICAgICAgIGluZm9fbm90aS5hbHBoYV90ZXh0ID0gbGVycChpbmZvX25vdGkuYWxwaGFfdGV4dCwgMSwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDEyKQ0KICAgICAgICAgICAgICAgIGluZm9fbm90aS5hbHBoYSA9IGxlcnAoaW5mb19ub3RpLmFscGhhLCAwLCBnbG9iYWxzLmZyYW1ldGltZSgpICogMTApDQogICAgICAgICAgICAgICAgaW5mb19ub3RpLmFhY2lyY2xlID0gbGVycChpbmZvX25vdGkuYWFjaXJjbGUsIDAsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiA3KQ0KICAgICAgICAgICAgICAgIGluZm9fbm90aS5iZXRhX3RleHQgPSBsZXJwKGluZm9fbm90aS5iZXRhX3RleHQsIDAsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiA5KQ0KICAgICAgICAgICAgICAgIGluZm9fbm90aS5hbHBoYWJhciA9IGxlcnAoaW5mb19ub3RpLmFscGhhYmFyLCAwLCBnbG9iYWxzLmZyYW1ldGltZSgpICogOCkgDQogICAgICAgICAgICAgICAgaW5mb19ub3RpLmJldGFiciA9IGxlcnAoaW5mb19ub3RpLmJldGFiciwgMCwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDUpDQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgaW5mb19ub3RpLmFscGhhX3RleHQgPSBsZXJwKGluZm9fbm90aS5hbHBoYV90ZXh0LCByZW5kZXJlci5tZWFzdXJlX3RleHQoImMiLCBpbmZvX25vdGkudGV4dCkgKyA1MCwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDEwKQ0KICAgICAgICAgICAgICAgIGluZm9fbm90aS5hbHBoYSA9IGxlcnAoaW5mb19ub3RpLmFscGhhLCByZW5kZXJlci5tZWFzdXJlX3RleHQoImMiLCBpbmZvX25vdGkudGV4dCkgKyAzMCwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDUpDQogICAgICAgICAgICAgICAgaW5mb19ub3RpLmFhY2lyY2xlID0gbGVycChpbmZvX25vdGkuYWFjaXJjbGUsIDAuNSwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDMpICANCiAgICAgICAgICAgICAgICBpbmZvX25vdGkuYmV0YV90ZXh0ID0gbGVycChpbmZvX25vdGkuYmV0YV90ZXh0LCB3aWR0aC54LzIsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAxNCkNCiAgICAgICAgICAgICAgICBpbmZvX25vdGkuYWxwaGFiYXIgPSBsZXJwKGluZm9fbm90aS5hbHBoYWJhciwgMjUsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAyKQ0KICAgICAgICAgICAgICAgIGluZm9fbm90aS5iZXRhYnIgPSBsZXJwKGluZm9fbm90aS5iZXRhYnIsIDI1NSwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDQpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICAgIGxvY2FsX3BsYXllciA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkNCiAgICAgICAgaWYgbG9jYWxfcGxheWVyID09IG5pbCB0aGVuIHJldHVybiBlbmQNCiAgICAgICAgbG9jYWwgd2lkdGggPSB2ZWN0b3IocmVuZGVyZXIubWVhc3VyZV90ZXh0KCJjIiwgaW5mb19ub3RpLnRleHQpKQ0KICAgICAgICBsb2NhbCByLGcsYixhID0gdWkuZ2V0KHZpc3VhbHNfdGFiLmV2ZW50bG9nc2FjY2VudCkNCiAgICAgICAgDQoNCiAgICAgICAgaWYgdWkuZ2V0KHZpc3VhbHNfdGFiLmV2ZW50b3V0bGluZSkgdGhlbg0KICAgICAgICBpZiB1aS5nZXQodmlzdWFsc190YWIuZXZlbnRnbG93KSB0aGVuDQogICAgICAgIGdsb3dfbW9kdWxlKFggLzIgLSBpbmZvX25vdGkuYmV0YV90ZXh0IC0gMTUsIFkgLSBpKjQyIC0gODUsaW5mb19ub3RpLmFscGhhLCAtMSwgMTIsIDAsIHtyLGcsYixpbmZvX25vdGkuYWxwaGFiYXJ9LCB7MCwwLDAsMH0pDQogICAgICAgIGVuZA0KICAgICAgICByZW5kZXJlci50ZXh0KFggLyAyIC0gaW5mb19ub3RpLmJldGFfdGV4dCwgWSAtIGkqNDIgLSA5MywgMjU1LDI1NSwyNTUsMjU1ICwgIiIsIGluZm9fbm90aS5hbHBoYV90ZXh0LCBpbmZvX25vdGkudGV4dCkNCiAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKFggLyAyIC0gaW5mb19ub3RpLmJldGFfdGV4dCAtIDE1LCBZIC0gaSo0MiAtIDEwMCwgaW5mb19ub3RpLmFscGhhLCAyLCByLCBnLCBiLCBpbmZvX25vdGkuYmV0YWJyKQ0KICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUoWCAvIDIgLSBpbmZvX25vdGkuYmV0YV90ZXh0IC0gMTUsIFkgLSBpKjQyIC0gNzYsIGluZm9fbm90aS5hbHBoYSwgMiwgciwgZywgYiwgaW5mb19ub3RpLmJldGFicikNCiAgICAgICAgcmVuZGVyZXIuY2lyY2xlX291dGxpbmUoWCAvIDIgLSBpbmZvX25vdGkuYmV0YV90ZXh0IC0gMTUsIFkgLSBpKjQyIC0gODcsIHIsIGcsIGIsIGluZm9fbm90aS5iZXRhYnIsIDEzLCA5MCwgaW5mb19ub3RpLmFhY2lyY2xlLCAyKQ0KICAgICAgICByZW5kZXJlci5jaXJjbGVfb3V0bGluZShYIC8gMiArIGluZm9fbm90aS5iZXRhX3RleHQgKyAxNCwgWSAtIGkqNDIgLSA4NywgciwgZywgYiwgaW5mb19ub3RpLmJldGFiciwgMTMsIC05MCwgaW5mb19ub3RpLmFhY2lyY2xlLCAyKQ0KICAgIGVsc2UNCiAgICAgICAgaWYgdWkuZ2V0KHZpc3VhbHNfdGFiLmV2ZW50Z2xvdykgdGhlbg0KICAgICAgICAgICAgZ2xvd19tb2R1bGUoWCAvMiAtIGluZm9fbm90aS5iZXRhX3RleHQgLSAxNSwgWSAtIGkqMTYgLSAyODUsaW5mb19ub3RpLmFscGhhLCAtMSwgMTIsIDAsIHtyLGcsYixpbmZvX25vdGkuYWxwaGFiYXJ9LCB7MCwwLDAsMH0pDQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIHJlbmRlcmVyLnRleHQoWCAvIDIgLSBpbmZvX25vdGkuYmV0YV90ZXh0LCBZIC0gaSoxNiAtIDI5MywgMjU1LDI1NSwyNTUsMjU1ICwgIiIsIGluZm9fbm90aS5hbHBoYV90ZXh0LCBpbmZvX25vdGkudGV4dCkNCg0KICAgICAgICBlbmQNCgkJDQogICAgICAgIGlmIGluZm9fbm90aS50aW1lciArIDguNzYgPCBnbG9iYWxzLnJlYWx0aW1lKCkgdGhlbg0KICAgICAgICAgICAgdGFibGUucmVtb3ZlKG5vdGlmeV9sb2wsaSkNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQNCmVuZA0KZW5kDQoNCg0KDQpmdW5jdGlvbiBuZXdfbm90aWZ5KHN0cmluZykNCiAgICBsb2NhbCBub3RpZmljYXRpb24gPSB7DQogICAgICAgIHRleHQgPSBzdHJpbmcsDQogICAgICAgIHRpbWVyID0gZ2xvYmFscy5yZWFsdGltZSgpLA0KICAgICAgICBjb2xvciA9IHsgciwgZywgYiwgYSB9LA0KICAgICAgICBhbHBoYSA9IDAsDQogICAgICAgIGFscGhhX3RleHQgPSAwLA0KICAgICAgICBhYWNpcmNsZSA9IDAsDQogICAgICAgIGJldGFfdGV4dCA9IDAsDQogICAgICAgIGFscGhhYmFyID0gMCwNCiAgICAgICAgYmV0YWJyID0gMCwNCiAgICB9DQoNCiAgICBsb2NhbCBZID0gc2VsZWN0KDEuMjUsIGNsaWVudC5zY3JlZW5fc2l6ZSgpKQ0KDQogICAgaWYgI25vdGlmeV9sb2wgPT0gMCB0aGVuDQogICAgICAgIG5vdGlmaWNhdGlvbi55ID0gWSArIDMwDQogICAgZWxzZQ0KICAgICAgICBsb2NhbCBsYXN0Tm90aWZpY2F0aW9uID0gbm90aWZ5X2xvbFsjbm90aWZ5X2xvbF0NCiAgICAgICAgbm90aWZpY2F0aW9uLnkgPSBsYXN0Tm90aWZpY2F0aW9uLnkgKyAzMA0KICAgIGVuZA0KDQogICAgdGFibGUuaW5zZXJ0KG5vdGlmeV9sb2wsIG5vdGlmaWNhdGlvbikNCmVuZA0KDQpsb2NhbCBoaXRncm91cF9uYW1lcyA9IHsiR2VuZXJpYyIsICJIZWFkIiwgIkNoZXN0IiwgIlN0b21hY2giLCAiTGVmdCBBcm0iLCAiUmlnaHQgQXJtIiwgIkxlZnQgTGVnIiwgIlJpZ2h0IExlZyIsICJOZWNrIiwgIj8iLCAiR2VhciJ9DQoNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soImFpbV9maXJlIiwgZnVuY3Rpb24oZSkNCiAgICBpZiBub3QgdWkuZ2V0KHZpc3VhbHNfdGFiLmV2ZW50bG9ncykgdGhlbiByZXR1cm4gZW5kDQogICAgc3RvcmVkX3Nob3QgPSB7DQogICAgZGFtYWdlID0gZS5kYW1hZ2UsDQogICAgaGl0Ym94ID0gaGl0Z3JvdXBfbmFtZXNbZS5oaXRncm91cCArIDFdLA0KICAgIGxhZ2NvbXAgPSBlLnRlbGVwb3J0ZWQsDQogICAgYmFja3RyYWNrID0gZS50aWNrDQp9DQplbmQpDQoNCmxvY2FsIGZ1bmN0aW9uIG9uX2FpbV9oaXQoZSkNCiAgICBsb2NhbCBncm91cCA9IGhpdGdyb3VwX25hbWVzW2UuaGl0Z3JvdXAgKyAxXSBvciAiPyINCglsb2NhbCBoaXRjaGFuY2UgPSBtYXRoLmZsb29yKGUuaGl0X2NoYW5jZSkNCiAgICBsb2NhbCByLGcsYixhID0gdWkuZ2V0KHZpc3VhbHNfdGFiLmV2ZW50bG9nc2FjY2VudCkNCiAgICBpZiB1aS5nZXQodmlzdWFsc190YWIuZXZlbnRsb2dzKSB0aGVuDQogICAgICAgIGlmIGluY2x1ZGVzKHVpLmdldCh2aXN1YWxzX3RhYi5ldmVudHMpLCAiRGFtYWdlIERlbHQiKSBhbmQgaW5jbHVkZXModWkuZ2V0KHZpc3VhbHNfdGFiLmV2ZW50cyksICJBaW1lZCBIaXRib3giKSB0aGVuDQoNCiAgICAgICAgICAgIG5ld19ub3RpZnkoc3RyaW5nLmZvcm1hdCgiJXNIaXQgICVzJXMlcyAgaW4gIHRoZSAgJXMlcyVzICBmb3IgICVzJXMlcyAgZGFtYWdlICAoJXMlcyAgaGVhbHRoICByZW1haW5pbmclcykiLCAnXGEnIC4uIHJnYmFfdG9faGV4KDI1NSwyNTUsMjU1LDI1NSkgLi4gJycsICdcYScgLi4gcmdiYV90b19oZXgocixnLGIsYSkgLi4gJycsIGVudGl0eS5nZXRfcGxheWVyX25hbWUoZS50YXJnZXQpLCAnXGEnIC4uIHJnYmFfdG9faGV4KDI1NSwyNTUsMjU1LDI1NSkgLi4gJycsICdcYScgLi4gcmdiYV90b19oZXgocixnLGIsYSkgLi4gJycsIGdyb3VwLCAnXGEnIC4uIHJnYmFfdG9faGV4KDI1NSwyNTUsMjU1LDI1NSkgLi4gJycsICdcYScgLi4gcmdiYV90b19oZXgocixnLGIsYSkgLi4gJycsIGUuZGFtYWdlLCAnXGEnIC4uIHJnYmFfdG9faGV4KDI1NSwyNTUsMjU1LDI1NSkgLi4gJycsICdcYScgLi4gcmdiYV90b19oZXgocixnLGIsYSkgLi4gJycsIGVudGl0eS5nZXRfcHJvcChlLnRhcmdldCwgIm1faUhlYWx0aCIpLCAnXGEnIC4uIHJnYmFfdG9faGV4KDI1NSwyNTUsMjU1LDI1NSkgLi4gJycpKQ0KICAgICAgICBlbHNlaWYgaW5jbHVkZXModWkuZ2V0KHZpc3VhbHNfdGFiLmV2ZW50cyksICJBaW1lZCBIaXRib3giKSB0aGVuDQogICAgICAgICAgICBuZXdfbm90aWZ5KHN0cmluZy5mb3JtYXQoIiVzSGl0ICAlcyVzJXMgIGluICB0aGUgICVzJXMiLCAnXGEnIC4uIHJnYmFfdG9faGV4KDI1NSwyNTUsMjU1LDI1NSkgLi4gJycsICdcYScgLi4gcmdiYV90b19oZXgocixnLGIsYSkgLi4gJycsIGVudGl0eS5nZXRfcGxheWVyX25hbWUoZS50YXJnZXQpLCAnXGEnIC4uIHJnYmFfdG9faGV4KDI1NSwyNTUsMjU1LDI1NSkgLi4gJycsICdcYScgLi4gcmdiYV90b19oZXgocixnLGIsYSkgLi4gJycsIGdyb3VwKSwgMjU1LDI1NSwyNTUsMjU1KQ0KICAgICAgICBlbHNlaWYgaW5jbHVkZXModWkuZ2V0KHZpc3VhbHNfdGFiLmV2ZW50cyksICJEYW1hZ2UgRGVsdCIpIHRoZW4gDQogICAgICAgICAgICBuZXdfbm90aWZ5KHN0cmluZy5mb3JtYXQoIiVzSGl0ICAlcyVzJXMgICBmb3IgICVzJXMlcyAgZGFtYWdlICAoJXMlcyAgaGVhbHRoICByZW1haW5pbmclcykiLCAnXGEnIC4uIHJnYmFfdG9faGV4KDI1NSwyNTUsMjU1LDI1NSkgLi4gJycsICdcYScgLi4gcmdiYV90b19oZXgocixnLGIsYSkgLi4gJycsIGVudGl0eS5nZXRfcGxheWVyX25hbWUoZS50YXJnZXQpLCAnXGEnIC4uIHJnYmFfdG9faGV4KDI1NSwyNTUsMjU1LDI1NSkgLi4gJycsICdcYScgLi4gcmdiYV90b19oZXgocixnLGIsYSkgLi4gJycsIGUuZGFtYWdlLCAnXGEnIC4uIHJnYmFfdG9faGV4KDI1NSwyNTUsMjU1LDI1NSkgLi4gJycsICdcYScgLi4gcmdiYV90b19oZXgocixnLGIsYSkgLi4gJycsIGVudGl0eS5nZXRfcHJvcChlLnRhcmdldCwgIm1faUhlYWx0aCIpLCAnXGEnIC4uIHJnYmFfdG9faGV4KDI1NSwyNTUsMjU1LDI1NSkgLi4gJycpKQ0KICAgICAgICBlbmQNCg0KICAgIGlmIGluY2x1ZGVzKHVpLmdldCh2aXN1YWxzX3RhYi5ldmVudHNfc3R5bGUpLCAiQ29uc29sZSIpIHRoZW4NCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyNTUsIDI1NSwgMjU1LCAiIEhpdFwwIikNCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgc3RyaW5nLmZvcm1hdCgiICVzXDAiLCBlbnRpdHkuZ2V0X3BsYXllcl9uYW1lKGUudGFyZ2V0KSkpDQogICAgICAgIGNsaWVudC5jb2xvcl9sb2coMjU1LCAyNTUsIDI1NSwgIiBpbiB0aGVcMCIpDQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIHN0cmluZy5mb3JtYXQoIiAlc1wwIiwgZ3JvdXApKQ0KICAgICAgICBjbGllbnQuY29sb3JfbG9nKDI1NSwgMjU1LCAyNTUsICIgZm9yXDAiKQ0KICAgICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCBzdHJpbmcuZm9ybWF0KCIgJXNcMCIsIGUuZGFtYWdlKSkNCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyNTUsIDI1NSwgMjU1LCAiIChcMCIpDQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIHN0cmluZy5mb3JtYXQoIiAlcyBoZWFsdGggIHJlbWFpbmluZ1wwIiwgZW50aXR5LmdldF9wcm9wKGUudGFyZ2V0LCAibV9pSGVhbHRoIikpKQ0KICAgICAgICBjbGllbnQuY29sb3JfbG9nKDI1NSwgMjU1LCAyNTUsICIpIikNCiAgICBlbmQNCmVuZA0KZW5kDQoNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soImFpbV9oaXQiLCBvbl9haW1faGl0KQ0KDQpsb2NhbCBmdW5jdGlvbiBvbl9haW1fbWlzc2VkKGUpDQogICAgbG9jYWwgZ3JvdXAgPSBoaXRncm91cF9uYW1lc1tlLmhpdGdyb3VwICsgMV0gb3IgIj8iDQoJbG9jYWwgaGl0Y2hhbmNlID0gbWF0aC5mbG9vcihlLmhpdF9jaGFuY2UpDQogICAgbG9jYWwgcmVhc29uID0gZS5yZWFzb24NCiAgICBsb2NhbCByLGcsYixhID0gdWkuZ2V0KHZpc3VhbHNfdGFiLmV2ZW50bG9nc2FjY2VudCkNCiAgICBpZiBlLnJlYXNvbiA9PSAiPyIgdGhlbiByZWFzb24gPSAiUmVzb2x2ZXIiIGVuZA0KICAgIGlmIGUucmVhc29uID09ICJkZWF0aCIgdGhlbiByZWFzb24gPSAiRGVhdGgiIGVuZA0KICAgIGlmIGUucmVhc29uID09ICJzcHJlYWQiIHRoZW4gcmVhc29uID0gIlNwcmVhZCIgZW5kDQogICAgaWYgdWkuZ2V0KHZpc3VhbHNfdGFiLmV2ZW50bG9ncykgdGhlbg0KICAgICAgICBuZXdfbm90aWZ5KHN0cmluZy5mb3JtYXQoIiVzTWlzc2VkICAlcyVzJXMgIGR1ZSAgdG8gICVzJXMiLCAnXGEnIC4uIHJnYmFfdG9faGV4KDI1NSwyNTUsMjU1LDI1NSkgLi4gJycsICdcYScgLi4gcmdiYV90b19oZXgocixnLGIsYSkgLi4gJycsIGVudGl0eS5nZXRfcGxheWVyX25hbWUoZS50YXJnZXQpLCAnXGEnIC4uIHJnYmFfdG9faGV4KDI1NSwyNTUsMjU1LDI1NSkgLi4gJycsICdcYScgLi4gcmdiYV90b19oZXgocixnLGIsYSkgLi4gJycsIHJlYXNvbiksIDI1NSwyNTUsMjU1LDI1NSkNCiAgICBsb2NhbCBtaXNzX21lc3NhZ2UgPSBzdHJpbmcuZm9ybWF0KCJNaXNzZWQgICVzICBkdWUgIHRvICAlcyIsIGVudGl0eS5nZXRfcGxheWVyX25hbWUoZS50YXJnZXQpLCByZWFzb24pDQogICAgaWYgaW5jbHVkZXModWkuZ2V0KHZpc3VhbHNfdGFiLmV2ZW50c19zdHlsZSksICJDb25zb2xlIikgdGhlbg0KCWNsaWVudC5jb2xvcl9sb2coMjU1LCAyNTUsIDI1NSwgIiBNaXNzZWRcMCIpDQoJY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgc3RyaW5nLmZvcm1hdCgiICVzXDAiLCBlbnRpdHkuZ2V0X3BsYXllcl9uYW1lKGUudGFyZ2V0KSkpDQoJY2xpZW50LmNvbG9yX2xvZygyNTUsIDI1NSwgMjU1LCAiIGR1ZSB0b1wwIikNCgljbGllbnQuY29sb3JfbG9nKHIsZyxiLCBzdHJpbmcuZm9ybWF0KCIgJXMiLCByZWFzb24pKQ0KICAgIGVuZA0KZW5kDQplbmQNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soImFpbV9taXNzIiwgb25fYWltX21pc3NlZCkNCg0KY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygncGFpbnRfdWknLCBmdW5jdGlvbiAoKSAgIA0Kbm90aWZ5X3JlbmRlcigpDQplbmQpDQotLSANCmxvY2FsIHJlYWR5X2FjdGl2ZSA9IDANCmxvY2FsIGFuaW1hdGVkID0NCnsNCmRlc3luY3NpemUgPSAwLA0KbmV3c3dheSA9IDAsDQpkdGFscGhhID0gNzUsDQpoc2FscGhhID0gNzUsDQpmc2FscGhhID0gNzUsDQpkbWdhbHBoYSA9IDc1LCANCmxjYmFyID0gMCwNCmFkZGljdGlvbiA9IDAsDQpiYXJhbHBoYSA9IDEsDQpzY29wZWRhbHBoYSA9IDEsDQpzY29wZWRhbGlnbiA9IDAsDQphcnJvd19sZWZ0ID0gMCwNCmFycm93X3JpZ2h0ID0gMCwNCmFycm93X2xlZnRfbW92ZSA9IDAsDQphcnJvd19yaWdodF9tb3ZlID0gMCwNCmZvcmFycm93cyA9IDAsDQpmb3JtZWdhbWl4ID0gMCwNCmluYWN0aXZlX2ZyYWN0aW9uID0gMCwNCmFjdGl2ZV9mcmFjdGlvbiA9IDAsIA0KZnJhY3Rpb24gPSAwLA0KaGlkZV9mcmFjdGlvbiA9IDAsDQpkbWdfZnJhY3Rpb24gPSAwLA0KaWRlYWxfZnJhY3Rpb24gPSAwLA0KZHRfZnJhY3Rpb24gPSAwLA0Kc2NvcGVkX2ZyYWN0aW9uID0gMCwNCmxieV9yID0gMCwNCmxieV9sID0gMCwNCn0NCmN0eF9jbGFtcCA9IGZ1bmN0aW9uKHZhbCwgbG93ZXIsIHVwcGVyKQ0KICAgIGFzc2VydCh2YWwgYW5kIGxvd2VyIGFuZCB1cHBlciwgIm5vdCB2ZXJ5IHVzZWZ1bCBlcnJvciBtZXNzYWdlIGhlcmUiKQ0KICAgIGlmIGxvd2VyID4gdXBwZXIgdGhlbiBsb3dlciwgdXBwZXIgPSB1cHBlciwgbG93ZXIgZW5kIC0tIHN3YXAgaWYgYm91bmRhcmllcyBzdXBwbGllZCB0aGUgd3Jvbmcgd2F5DQogICAgcmV0dXJuIG1hdGgubWF4KGxvd2VyLCBtYXRoLm1pbih1cHBlciwgdmFsKSkNCmVuZA0KZWFzZUluT3V0ID0gZnVuY3Rpb24odCkNCiAgICByZXR1cm4gKHQgPiAwLjUpIGFuZCA0KigodC0xKV4zKSsxIG9yIDQqdF4zOw0KZW5kDQpmdW5jdGlvbiByb3VuZChudW1iZXIpDQogICAgcmV0dXJuIG1hdGguZmxvb3IobnVtYmVyICsgMC41KQ0KICBlbmQNCg0KICBsb2NhbCBmdW5jdGlvbiBoc3ZfdG9fcmdiKGgsIHMsIHYsIGEpDQogICAgbG9jYWwgciwgZywgYg0KDQogICAgbG9jYWwgaSA9IG1hdGguZmxvb3IoaCAqIDYpOw0KICAgIGxvY2FsIGYgPSBoICogNiAtIGk7DQogICAgbG9jYWwgcCA9IHYgKiAoMSAtIHMpOw0KICAgIGxvY2FsIHEgPSB2ICogKDEgLSBmICogcyk7DQogICAgbG9jYWwgdCA9IHYgKiAoMSAtICgxIC0gZikgKiBzKTsNCg0KICAgIGkgPSBpICUgNg0KDQogICAgaWYgaSA9PSAwIHRoZW4gciwgZywgYiA9IHYsIHQsIHANCiAgICBlbHNlaWYgaSA9PSAxIHRoZW4gciwgZywgYiA9IHEsIHYsIHANCiAgICBlbHNlaWYgaSA9PSAyIHRoZW4gciwgZywgYiA9IHAsIHYsIHQNCiAgICBlbHNlaWYgaSA9PSAzIHRoZW4gciwgZywgYiA9IHAsIHEsIHYNCiAgICBlbHNlaWYgaSA9PSA0IHRoZW4gciwgZywgYiA9IHQsIHAsIHYNCiAgICBlbHNlaWYgaSA9PSA1IHRoZW4gciwgZywgYiA9IHYsIHAsIHENCiAgICBlbmQNCg0KICAgIHJldHVybiByICogMjU1LCBnICogMjU1LCBiICogMjU1LCBhICogMjU1DQplbmQNCg0KICBsb2NhbCBmdW5jdGlvbiByYWluYm93aXplKGZyZXF1ZW5jeSwgcmdiX3NwbGl0X3JhdGlvKQ0KICAgIGxvY2FsIHIsIGcsIGIsIGEgPSBoc3ZfdG9fcmdiKGdsb2JhbHMucmVhbHRpbWUoKSAqIGZyZXF1ZW5jeSwgMSwgMSwgMSkNCg0KICAgIHIgPSByICogcmdiX3NwbGl0X3JhdGlvDQogICAgZyA9IGcgKiByZ2Jfc3BsaXRfcmF0aW8NCiAgICBiID0gYiAqIHJnYl9zcGxpdF9yYXRpbw0KDQogICAgcmV0dXJuIHIsIGcsIGINCmVuZA0KDQpsb2NhbCBsYXN0X3VwZGF0ZSA9IDANCi0tIENFTlRFUiBJTkRJQ0FUT1JTDQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwYWludCIsIGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBwbGF5ZXIgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpDQogICAgaWYgbm90IHBsYXllciBvciBub3QgZW50aXR5LmlzX2FsaXZlKHBsYXllcikgdGhlbiByZXR1cm4gZW5kDQogICAgYXZldDEsIGF2ZXQyLCBhdmV0MywgYXZldDQgPSB1aS5nZXQodmlzdWFsc190YWIuYXJyb3dhY2NlbnQpDQogICAgY3ZldDEsIGN2ZXQyLCBjdmV0MywgY3ZldDQgPSB1aS5nZXQodmlzdWFsc190YWIuY3Jvc3NoYWlyYWNjZW50KQ0KbG9jYWwgc2NyX3gsIHNjcl95ID0gY2xpZW50LnNjcmVlbl9zaXplKCkNCmxvY2FsIHNjciA9IHsgY2xpZW50LnNjcmVlbl9zaXplKCkgfQ0KbG9jYWwgc2NwZCA9IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9iSXNTY29wZWQiKQ0KbG9jYWwgbWUgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpDQoNCmlmIG5vdCBtZSBvciBub3QgZW50aXR5LmlzX2FsaXZlKG1lKSB0aGVuIHJldHVybiBlbmQNCi0tIEFycm93cw0KaWYgdWkuZ2V0KHZpc3VhbHNfdGFiLmFycm93cykgfj0gIk9mZiIgdGhlbg0KCWlmIHNjcGQgfj0gMCB0aGVuIGFuaW1hdGVkLmZvcmFycm93cyA9IGxlcnAoYW5pbWF0ZWQuZm9yYXJyb3dzLCAwLCBnbG9iYWxzLmZyYW1ldGltZSgpICogMjQpIGVsc2UgYW5pbWF0ZWQuZm9yYXJyb3dzID0gbGVycChhbmltYXRlZC5mb3JhcnJvd3MsIDEsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAyNCkgZW5kDQoJaWYgdWkuZ2V0KHZpc3VhbHNfdGFiLmFycm93cykgPT0gIlRTNCIgdGhlbg0KICAgIAlpZiBtYW51YWxfZGlyID09IDIgdGhlbg0KICAgICAgICAgICAgYW5pbWF0ZWQuYXJyb3dfcmlnaHQgPSBsZXJwKGFuaW1hdGVkLmFycm93X3JpZ2h0LCAyNTUsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAyNCkNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIGFuaW1hdGVkLmFycm93X3JpZ2h0ID0gbGVycChhbmltYXRlZC5hcnJvd19yaWdodCwgMCwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDI0KQ0KICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBpZiBtYW51YWxfZGlyID09IDEgdGhlbg0KICAgICAgICAgICAgYW5pbWF0ZWQuYXJyb3dfbGVmdCA9IGxlcnAoYW5pbWF0ZWQuYXJyb3dfbGVmdCwgMjU1LCBnbG9iYWxzLmZyYW1ldGltZSgpICogMjQpDQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICBhbmltYXRlZC5hcnJvd19sZWZ0ID0gbGVycChhbmltYXRlZC5hcnJvd19sZWZ0LCAwLCBnbG9iYWxzLmZyYW1ldGltZSgpICogMjQpDQogICAgICAgICAgICBlbmQNCgl4ID0gc2NyWzFdDQoJeSA9IHNjclsyXQ0KCQlsb2NhbCBib2R5eWF3ID0gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZsUG9zZVBhcmFtZXRlciIsIDExKSAqIDEyMCAtIDYwDQoJCXJlbmRlcmVyLnRyaWFuZ2xlKHggLyAyICsgNTUsIHkgLyAyICsgMiwgeCAvIDIgKyA0MiwgeSAvIDIgLSA3LCB4IC8gMiArIDQyLCB5IC8gMiArIDExLCANCgkJbWFudWFsX2RpciA9PSAyIGFuZCBhdmV0MSBvciAyNSwgDQoJCW1hbnVhbF9kaXIgPT0gMiBhbmQgYXZldDIgb3IgMjUsIA0KCQltYW51YWxfZGlyID09IDIgYW5kIGF2ZXQyIG9yIDI1LCANCgkJbWFudWFsX2RpciA9PSAyIGFuZCAyNTUgKiBhbmltYXRlZC5mb3JhcnJvd3Mgb3IgMTYwICogYW5pbWF0ZWQuZm9yYXJyb3dzKQ0KDQoJCXJlbmRlcmVyLnRyaWFuZ2xlKHggLyAyIC0gNTUsIHkgLyAyICsgMiwgeCAvIDIgLSA0MiwgeSAvIDIgLSA3LCB4IC8gMiAtIDQyLCB5IC8gMiArIDExLCANCgkJbWFudWFsX2RpciA9PSAxIGFuZCBhdmV0MSBvciAyNSwgDQoJCW1hbnVhbF9kaXIgPT0gMSBhbmQgYXZldDIgb3IgMjUsIA0KCQltYW51YWxfZGlyID09IDEgYW5kIGF2ZXQzIG9yIDI1LCANCgkJbWFudWFsX2RpciA9PSAxIGFuZCAyNTUgKiBhbmltYXRlZC5mb3JhcnJvd3Mgb3IgMTYwICogYW5pbWF0ZWQuZm9yYXJyb3dzKQ0KCQ0KCQlyZW5kZXJlci5yZWN0YW5nbGUoeCAvIDIgKyAzOCwgeSAvIDIgLSA3LCAyLCAxOCwgDQoJCWJvZHl5YXcgPCAtMTAgYW5kIGF2ZXQxIG9yIDI1LA0KCQlib2R5eWF3IDwgLTEwIGFuZCBhdmV0MiBvciAyNSwNCgkJYm9keXlhdyA8IC0xMCBhbmQgYXZldDMgb3IgMjUsDQoJCWJvZHl5YXcgPCAtMTAgYW5kIDI1NSAqIGFuaW1hdGVkLmZvcmFycm93cyBvciAxNjAgKiBhbmltYXRlZC5mb3JhcnJvd3MpDQoJCXJlbmRlcmVyLnJlY3RhbmdsZSh4IC8gMiAtIDQwLCB5IC8gMiAtIDcsIDIsIDE4LAkJCQ0KCQlib2R5eWF3ID4gMTAgYW5kIGF2ZXQxIG9yIDI1LA0KCQlib2R5eWF3ID4gMTAgYW5kIGF2ZXQyIG9yIDI1LA0KCQlib2R5eWF3ID4gMTAgYW5kIGF2ZXQzIG9yIDI1LA0KCQlib2R5eWF3ID4gMTAgYW5kIDI1NSAqIGFuaW1hdGVkLmZvcmFycm93cyBvciAxNjAgKiBhbmltYXRlZC5mb3JhcnJvd3MpDQoJZWxzZWlmIHVpLmdldCh2aXN1YWxzX3RhYi5hcnJvd3MpID09ICJNYW51YWwiIHRoZW4NCg0KICAgICAgICBpZiBtYW51YWxfZGlyID09IDIgdGhlbiBhbmltYXRlZC5hcnJvd19yaWdodCA9IGxlcnAoYW5pbWF0ZWQuYXJyb3dfcmlnaHQsIDI1NSwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE0KSBhbmltYXRlZC5hcnJvd19yaWdodF9tb3ZlID0gbGVycChhbmltYXRlZC5hcnJvd19yaWdodF9tb3ZlLCA1NSwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE0KQ0KICAgICAgICBlbHNlIGFuaW1hdGVkLmFycm93X3JpZ2h0ID0gbGVycChhbmltYXRlZC5hcnJvd19yaWdodCwgMCwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE0KSBhbmltYXRlZC5hcnJvd19yaWdodF9tb3ZlID0gbGVycChhbmltYXRlZC5hcnJvd19yaWdodF9tb3ZlLCA1LCBnbG9iYWxzLmZyYW1ldGltZSgpICogMTQpIGVuZA0KICAgICAgICBpZiBtYW51YWxfZGlyID09IDEgdGhlbiBhbmltYXRlZC5hcnJvd19sZWZ0ID0gbGVycChhbmltYXRlZC5hcnJvd19sZWZ0LCAyNTUsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAxNCkgYW5pbWF0ZWQuYXJyb3dfbGVmdF9tb3ZlID0gbGVycChhbmltYXRlZC5hcnJvd19sZWZ0X21vdmUsIDU1LCBnbG9iYWxzLmZyYW1ldGltZSgpICogMTQpDQogICAgICAgIGVsc2UgYW5pbWF0ZWQuYXJyb3dfbGVmdCA9IGxlcnAoYW5pbWF0ZWQuYXJyb3dfbGVmdCwgMCwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDI0KSBhbmltYXRlZC5hcnJvd19sZWZ0X21vdmUgPSBsZXJwKGFuaW1hdGVkLmFycm93X2xlZnRfbW92ZSwgNSwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE0KSBlbmQNCiAgICAgICAgbG9jYWwgbGJ5MiA9IGFudGlhaW1fZnVuY3MuZ2V0X2Rlc3luYygxKQ0KICAgIA0KICAgICAgICBpZiBsYnkyIDw9IC0xIHRoZW4gYW5pbWF0ZWQubGJ5X2wgPSBsZXJwKGFuaW1hdGVkLmxieV9sLCAyNTUsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAxNCkNCiAgICAgICAgZWxzZSBhbmltYXRlZC5sYnlfbCA9IGxlcnAoYW5pbWF0ZWQubGJ5X2wsIDAsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAxNCkgZW5kDQogICAgICAgIGlmIGxieTIgPj0gLTEgdGhlbiBhbmltYXRlZC5sYnlfciA9IGxlcnAoYW5pbWF0ZWQubGJ5X3IsIDI1NSwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE0KQ0KICAgICAgICBlbHNlIGFuaW1hdGVkLmxieV9yID0gbGVycChhbmltYXRlZC5sYnlfciwgMCwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE0KSBlbmQNCiAgICAgICAgDQogICAgICAgIHJlbmRlcmVyLnRleHQoc2NyWzFdIC8gMiAtIGFuaW1hdGVkLmFycm93X2xlZnRfbW92ZSAsIHNjclsyXSAvIDIsIDI1NSwgMjU1LCAyNTUsIDI1ICogYW5pbWF0ZWQuZm9yYXJyb3dzLCAiK2MiLCBuaWwsICI8IikgDQogICAgICAgIHJlbmRlcmVyLnRleHQoc2NyWzFdIC8gMiArIGFuaW1hdGVkLmFycm93X3JpZ2h0X21vdmUgLCBzY3JbMl0gLyAyLCAyNTUsIDI1NSwgMjU1LCAyNSAqIGFuaW1hdGVkLmZvcmFycm93cywgIitjIiwgbmlsLCAiPiIpIA0KICAgICAgICByZW5kZXJlci50ZXh0KHNjclsxXSAvIDIgLSBhbmltYXRlZC5hcnJvd19sZWZ0X21vdmUgLCBzY3JbMl0gLyAyLCBhdmV0MSwgYXZldDIsIGF2ZXQzLCBhbmltYXRlZC5hcnJvd19sZWZ0ICogYW5pbWF0ZWQuZm9yYXJyb3dzLCAiK2MiLCBuaWwsICI8IikgDQogICAgICAgIHJlbmRlcmVyLnRleHQoc2NyWzFdIC8gMiArIGFuaW1hdGVkLmFycm93X3JpZ2h0X21vdmUgLCBzY3JbMl0gLyAyLCBhdmV0MSwgYXZldDIsIGF2ZXQzLCBhbmltYXRlZC5hcnJvd19yaWdodCAqIGFuaW1hdGVkLmZvcmFycm93cywgIitjIiwgbmlsLCAiPiIpIA0KCWVsc2VpZiB1aS5nZXQodmlzdWFsc190YWIuYXJyb3dzKSA9PSAibWVnYW1peCIgdGhlbg0KDQoJaWYgbWFudWFsX2RpciA9PSAyIHRoZW4gYW5pbWF0ZWQuYXJyb3dfcmlnaHQgPSBsZXJwKGFuaW1hdGVkLmFycm93X3JpZ2h0LCAyNTUsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAxNCkNCiAgICBlbHNlIGFuaW1hdGVkLmFycm93X3JpZ2h0ID0gbGVycChhbmltYXRlZC5hcnJvd19yaWdodCwgMCwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE0KSBlbmQNCglpZiBtYW51YWxfZGlyID09IDEgdGhlbiBhbmltYXRlZC5hcnJvd19sZWZ0ID0gbGVycChhbmltYXRlZC5hcnJvd19sZWZ0LCAyNTUsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAxNCkNCiAgICBlbHNlIGFuaW1hdGVkLmFycm93X2xlZnQgPSBsZXJwKGFuaW1hdGVkLmFycm93X2xlZnQsIDAsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAyNCkgZW5kDQogICAgbG9jYWwgbGJ5MiA9IGFudGlhaW1fZnVuY3MuZ2V0X2Rlc3luYygxKQ0KDQogICAgaWYgbGJ5MiA8PSAtMSB0aGVuIGFuaW1hdGVkLmxieV9sID0gbGVycChhbmltYXRlZC5sYnlfbCwgMjU1LCBnbG9iYWxzLmZyYW1ldGltZSgpICogMTQpDQogICAgZWxzZSBhbmltYXRlZC5sYnlfbCA9IGxlcnAoYW5pbWF0ZWQubGJ5X2wsIDAsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAxNCkgZW5kDQogICAgaWYgbGJ5MiA+PSAtMSB0aGVuIGFuaW1hdGVkLmxieV9yID0gbGVycChhbmltYXRlZC5sYnlfciwgMjU1LCBnbG9iYWxzLmZyYW1ldGltZSgpICogMTQpDQogICAgZWxzZSBhbmltYXRlZC5sYnlfciA9IGxlcnAoYW5pbWF0ZWQubGJ5X3IsIDAsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAxNCkgZW5kDQogICAgDQoJcmVuZGVyZXIudGV4dChzY3JbMV0gLyAyIC0gNTUgLCBzY3JbMl0gLyAyLCAyNTUsIDI1NSwgMjU1LCAyNTUgKiBhbmltYXRlZC5mb3JhcnJvd3MsICIrYyIsIG5pbCwgIjwiKSANCglyZW5kZXJlci50ZXh0KHNjclsxXSAvIDIgKyA1NSAsIHNjclsyXSAvIDIsIDI1NSwgMjU1LCAyNTUsIDI1NSAqIGFuaW1hdGVkLmZvcmFycm93cywgIitjIiwgbmlsLCAiPiIpIA0KCXJlbmRlcmVyLnRleHQoc2NyWzFdIC8gMiAtIDU1ICwgc2NyWzJdIC8gMiwgYXZldDEsIGF2ZXQyLCBhdmV0MywgYW5pbWF0ZWQuYXJyb3dfbGVmdCwgIitjIiwgbmlsLCAiPCIpIA0KCXJlbmRlcmVyLnRleHQoc2NyWzFdIC8gMiArIDU1ICwgc2NyWzJdIC8gMiwgYXZldDEsIGF2ZXQyLCBhdmV0MywgYW5pbWF0ZWQuYXJyb3dfcmlnaHQsICIrYyIsIG5pbCwgIj4iKSANCg0KICAgIHJlbmRlcmVyLnRleHQoc2NyWzFdIC8gMiAtIDY4ICwgc2NyWzJdIC8gMiwgYXZldDEsIGF2ZXQyLCBhdmV0MywgYW5pbWF0ZWQubGJ5X2wgKiBhbmltYXRlZC5mb3JhcnJvd3MsICIrYyIsIG5pbCwgIjwiKSANCglyZW5kZXJlci50ZXh0KHNjclsxXSAvIDIgKyA2OCAsIHNjclsyXSAvIDIsIGF2ZXQxLCBhdmV0MiwgYXZldDMsIGFuaW1hdGVkLmxieV9yICogYW5pbWF0ZWQuZm9yYXJyb3dzLCAiK2MiLCBuaWwsICI+IikgDQplbmQNCgllbmQNCg0KaWYgdWkuZ2V0KHZpc3VhbHNfdGFiLmNlbnRlcl9pbmRpY2F0b3JzKSA9PSAiTWVnYW1peCIgdGhlbg0KICAgIGxvY2FsIHgsIHkgPSBjbGllbnQuc2NyZWVuX3NpemUoKQ0KICAgIGxvY2FsIGxvZ29fdywgbG9nb19oID0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCJjIiwgIm1lZ2FtaXgiKQ0KICAgIHZ2ZXQxLCB2dmV0MiwgdnZldDMgPSB1aS5nZXQodmlzdWFsc190YWIuY3Jvc3NoYWlyYWNjZW50KQ0KICAgIHN0YXRlID0gYW50aV9haW1zOmdldF9zdGF0ZV90eXBlKCkNCiAgICBhbmdsZSA9IG1hdGgubWluKDU3LCBtYXRoLmFicyhlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fZmxQb3NlUGFyYW1ldGVyIiwgMTEpKjEyMC02MCkpCQ0KICAgIGlmIHN3YXkoKSAgPiAwIHRoZW4NCiAgICAgICAgYW5pbWF0ZWQubmV3c3dheSA9IGxlcnAoYW5pbWF0ZWQubmV3c3dheSwgc3dheSgpLCBnbG9iYWxzLmZyYW1ldGltZSgpICogMjQpDQogICAgICAgIGVsc2UgDQogICAgICAgIGFuaW1hdGVkLm5ld3N3YXkgPSBsZXJwKGFuaW1hdGVkLm5ld3N3YXksIDAsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAyNCkNCiAgICAgICAgZW5kDQoNCiAgICBpZiB1aS5nZXQodmlzdWFsc190YWIub25zY29wZSkgPT0gIlJpZ2h0IiB0aGVuIA0KICAgIGlmIHNjcGQgfj0gMCB0aGVuDQogICAgICAgIGFuaW1hdGVkLnNjb3BlZF9mcmFjdGlvbiA9IGxlcnAoYW5pbWF0ZWQuc2NvcGVkX2ZyYWN0aW9uLCAxLCBnbG9iYWxzLmZyYW1ldGltZSgpICogMjQpDQogICAgICAgIGFuaW1hdGVkLnNjb3BlZGFscGhhID0gbGVycChhbmltYXRlZC5zY29wZWRhbHBoYSwgMSwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE0KQ0KICAgICAgICBhbHBoYWZvcmxvZ28gPSAiXGFmZmZmZmZmZiINCiAgICBlbHNlDQogICAgICAgIGFuaW1hdGVkLnNjb3BlZF9mcmFjdGlvbiA9IGxlcnAoYW5pbWF0ZWQuc2NvcGVkX2ZyYWN0aW9uLCAwLCBnbG9iYWxzLmZyYW1ldGltZSgpICogMjQpDQogICAgICAgIGFuaW1hdGVkLnNjb3BlZGFscGhhID0gbGVycChhbmltYXRlZC5zY29wZWRhbHBoYSwgMSwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDI0KQ0KICAgICAgICBhbHBoYWZvcmxvZ28gPSAiXGFmZmZmZmZmZiINCiAgICBlbmQNCiAgICBlbHNlaWYgdWkuZ2V0KHZpc3VhbHNfdGFiLm9uc2NvcGUpID09ICJCbGVzcyIgdGhlbiANCiAgICBhbmltYXRlZC5zY29wZWRfZnJhY3Rpb24gPSBsZXJwKGFuaW1hdGVkLnNjb3BlZF9mcmFjdGlvbiwgMCwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDI0LCAwLCAxKQ0KICAgIGlmIHNjcGQgfj0gMCB0aGVuDQogICAgICAgIGFscGhhZm9ybG9nbyA9ICJcYWZmZmZmZjAwIg0KICAgIGFuaW1hdGVkLnNjb3BlZGFscGhhID0gbGVycChhbmltYXRlZC5zY29wZWRhbHBoYSwgMCwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDI0KQ0KICAgIGVsc2UgDQogICAgICAgIGFscGhhZm9ybG9nbyA9ICJcYWZmZmZmZmZmIg0KICAgICAgICBhbmltYXRlZC5zY29wZWRhbHBoYSA9IGxlcnAoYW5pbWF0ZWQuc2NvcGVkYWxwaGEsIDEsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAyNCkNCiAgICBlbmQNCiAgICBlbHNlaWYgdWkuZ2V0KHZpc3VhbHNfdGFiLm9uc2NvcGUpID09ICJPZmYiIHRoZW4gDQogICAgICAgIGFscGhhZm9ybG9nbyA9ICJcYWZmZmZmZmZmIg0KICAgICAgICBhbmltYXRlZC5zY29wZWRhbHBoYSA9IGxlcnAoYW5pbWF0ZWQuc2NvcGVkYWxwaGEsIDEsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAyNCkNCiAgICAgICAgYW5pbWF0ZWQuc2NvcGVkX2ZyYWN0aW9uID0gbGVycChhbmltYXRlZC5zY29wZWRfZnJhY3Rpb24sIDAsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAyNCwgMCwgMSkNCiAgICBlbmQNCiAgICBpZiB1aS5nZXQodmlzdWFsc190YWIub25zY29wZSkgPT0gIlJpZ2h0IiB0aGVuIA0KICAgIGlmIHNjcGQgfj0gMCB0aGVuIGFuaW1hdGVkLmZvcm1lZ2FtaXggPSBsZXJwKGFuaW1hdGVkLmZvcm1lZ2FtaXgsIDAsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAyNCkgZWxzZSBhbmltYXRlZC5mb3JtZWdhbWl4ID0gbGVycChhbmltYXRlZC5mb3JtZWdhbWl4LCAxLCBnbG9iYWxzLmZyYW1ldGltZSgpICogMjQpIGVuZA0KICAgIGVsc2UNCiAgICAgICAgYW5pbWF0ZWQuZm9ybWVnYW1peCA9IGxlcnAoYW5pbWF0ZWQuZm9ybWVnYW1peCwgMSwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDI0KQ0KICAgIGVuZA0KICAgIGxvY2FsIHNjb3BlZF9mcmFjdGlvbiA9IGFuaW1hdGVkLnNjb3BlZF9mcmFjdGlvbiANCiAgICBnbG93X21vZHVsZSh4LzIgKyA2ICsgKChsb2dvX3cgKyAyKS8xLjQpICogc2NvcGVkX2ZyYWN0aW9uLCB5LzIgKyAzMiwyMCwgLTEsIDEwLCAwLCB7dnZldDEsIHZ2ZXQyLCB2dmV0MywxMDAgKiBhbmltYXRlZC5zY29wZWRhbHBoYX0sIHswLDAsMCwwfSkNCiAgICByZW5kZXJlci50ZXh0KHgvMiAtIDE0ICsgKChsb2dvX3cgKyAyKS8xLjQpICogc2NvcGVkX2ZyYWN0aW9uLCB5LzIgKyAzMiwgMjU1LCAyNTUsIDI1NSwgMjU1ICogYW5pbWF0ZWQuc2NvcGVkYWxwaGEsICJjLSIsIG5pbCwgc3RyaW5nLnVwcGVyKCJtZWdhbWl4IikpDQogICAgcmVuZGVyZXIudGV4dCh4LzIgKyAxNCArICgobG9nb193ICsgMikvMS40KSAqIHNjb3BlZF9mcmFjdGlvbiwgeS8yICsgMzIsIHZ2ZXQxLCB2dmV0MiwgdnZldDMsIGFuaW1hdGVkLm5ld3N3YXkgKiBhbmltYXRlZC5zY29wZWRhbHBoYSwgImMtIiwgbmlsLCBzdHJpbmcudXBwZXIoIkJsZXNzIikpDQogICAgbG9jYWwgbHAgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpDQogICAgbG9jYWwgbmV4dEF0dGFjayA9IGVudGl0eS5nZXRfcHJvcChscCwgIm1fZmxOZXh0QXR0YWNrIikNCiAgICBsb2NhbCBuZXh0UHJpbWFyeUF0dGFjayA9IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24obHApLCAibV9mbE5leHRQcmltYXJ5QXR0YWNrIikNCiAgICBsb2NhbCBkdF9hY3RpdmUgPSBmYWxzZQ0KICAgIGlmIG5leHRQcmltYXJ5QXR0YWNrIH49IG5pbCB0aGVuDQogICAgICAgIGR0X2FjdGl2ZSA9IG5vdCAobWF0aC5tYXgobmV4dFByaW1hcnlBdHRhY2ssIG5leHRBdHRhY2spID4gZ2xvYmFscy5jdXJ0aW1lKCkpDQogICAgZW5kDQoNCiAgICBsb2NhbCBuZXh0X2F0dGFjayA9IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9mbE5leHRBdHRhY2siKQ0KICAgIGxvY2FsIG5leHRfcHJpbWFyeV9hdHRhY2sgPSBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpLCAibV9mbE5leHRQcmltYXJ5QXR0YWNrIikNCg0KICAgIGxvY2FsIGR0X3RvZ2dsZWQgPSB1aS5nZXQoa2V5c2ZvcmluZHMuZG91YmxldGFwWzFdKSBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmRvdWJsZXRhcFsyXSkNCg0KICAgIGlmIGR0X3RvZ2dsZWQgYW5kIGR0X2FjdGl2ZSB0aGVuDQogICAgICAgIGFuaW1hdGVkLmFjdGl2ZV9mcmFjdGlvbiA9IGN0eF9jbGFtcChhbmltYXRlZC5hY3RpdmVfZnJhY3Rpb24gKyBnbG9iYWxzLmZyYW1ldGltZSgpLzAuMTUsIDAsIDEpDQogICAgZWxzZQ0KICAgICAgICBhbmltYXRlZC5hY3RpdmVfZnJhY3Rpb24gPSBjdHhfY2xhbXAoYW5pbWF0ZWQuYWN0aXZlX2ZyYWN0aW9uIC0gZ2xvYmFscy5mcmFtZXRpbWUoKS8wLjE1LCAwLCAxKQ0KICAgIGVuZA0KDQogICAgaWYgZHRfdG9nZ2xlZCBhbmQgbm90IGR0X2FjdGl2ZSB0aGVuDQogICAgICAgIGFuaW1hdGVkLmluYWN0aXZlX2ZyYWN0aW9uID0gY3R4X2NsYW1wKGFuaW1hdGVkLmluYWN0aXZlX2ZyYWN0aW9uICsgZ2xvYmFscy5mcmFtZXRpbWUoKS8wLjE1LCAwLCAxKQ0KICAgIGVsc2UNCiAgICAgICAgYW5pbWF0ZWQuaW5hY3RpdmVfZnJhY3Rpb24gPSBjdHhfY2xhbXAoYW5pbWF0ZWQuaW5hY3RpdmVfZnJhY3Rpb24gLSBnbG9iYWxzLmZyYW1ldGltZSgpLzAuMTUsIDAsIDEpDQogICAgZW5kDQoNCiAgICBpZiB1aS5nZXQoa2V5c2ZvcmluZHMuaGlkZXNob3RzWzFdKSBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmhpZGVzaG90c1syXSkgYW5kIG5vdCBkdF90b2dnbGVkIHRoZW4NCiAgICAgICAgYW5pbWF0ZWQuaGlkZV9mcmFjdGlvbiA9IGN0eF9jbGFtcChhbmltYXRlZC5oaWRlX2ZyYWN0aW9uICsgZ2xvYmFscy5mcmFtZXRpbWUoKS8wLjE1LCAwLCAxKQ0KICAgIGVsc2UNCiAgICAgICAgYW5pbWF0ZWQuaGlkZV9mcmFjdGlvbiA9IGN0eF9jbGFtcChhbmltYXRlZC5oaWRlX2ZyYWN0aW9uIC0gZ2xvYmFscy5mcmFtZXRpbWUoKS8wLjE1LCAwLCAxKQ0KICAgIGVuZA0KDQogICAgaWYgbWF0aC5tYXgoYW5pbWF0ZWQuaGlkZV9mcmFjdGlvbiwgYW5pbWF0ZWQuaW5hY3RpdmVfZnJhY3Rpb24sIGFuaW1hdGVkLmFjdGl2ZV9mcmFjdGlvbikgPiAwIHRoZW4NCiAgICAgICAgYW5pbWF0ZWQuZnJhY3Rpb24gPSBjdHhfY2xhbXAoYW5pbWF0ZWQuZnJhY3Rpb24gKyBnbG9iYWxzLmZyYW1ldGltZSgpLzAuMiwgMCwgMSkNCiAgICBlbHNlDQogICAgICAgIGFuaW1hdGVkLmZyYWN0aW9uID0gY3R4X2NsYW1wKGFuaW1hdGVkLmZyYWN0aW9uIC0gZ2xvYmFscy5mcmFtZXRpbWUoKS8wLjIsIDAsIDEpDQogICAgZW5kDQoNCiAgICBpZiB1aS5nZXQoa2V5c2ZvcmluZHMuZG1nWzJdKSB0aGVuDQogICAgICAgIGFuaW1hdGVkLmRtZ19mcmFjdGlvbiA9IGN0eF9jbGFtcChhbmltYXRlZC5kbWdfZnJhY3Rpb24gKyBnbG9iYWxzLmZyYW1ldGltZSgpLzAuMTUsIDAsIDEpDQogICAgZWxzZQ0KICAgICAgICBhbmltYXRlZC5kbWdfZnJhY3Rpb24gPSBjdHhfY2xhbXAoYW5pbWF0ZWQuZG1nX2ZyYWN0aW9uIC0gZ2xvYmFscy5mcmFtZXRpbWUoKS8wLjE1LCAwLCAxKQ0KICAgIGVuZA0KDQoNCiAgICBsb2NhbCBkdF9zaXplID0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCItIiwgIkRUICIpDQogICAgbG9jYWwgcmVhZHlfc2l6ZSA9IHJlbmRlcmVyLm1lYXN1cmVfdGV4dCgiLSIsICJSRUFEWSIpDQogICAgbG9jYWwgcmVhZHlfc2l6ZSA9IHJlbmRlcmVyLm1lYXN1cmVfdGV4dCgiLSIsICJBQ1RJVkUiKQ0KICAgIGlmIGlzX2RlZmVuc2l2ZSB0aGVuDQogICAgICAgIHJlYWR5X3NpemUgPSByZW5kZXJlci5tZWFzdXJlX3RleHQoIi0iLCAiQUNUSVZFIikNCiAgICAgICAgICAgIGR0X3NpemUgPSByZW5kZXJlci5tZWFzdXJlX3RleHQoIi0iLCAiRFQgIikNCiAgICAgICAgICAgIHJlbmRlcmVyLnRleHQoeC8yICsgKChkdF9zaXplICsgcmVhZHlfc2l6ZSArIDIpLzIpICogc2NvcGVkX2ZyYWN0aW9uLCB5LzIgKyA1MCwgMjU1LCAyNTUsIDI1NSwgYW5pbWF0ZWQuYWN0aXZlX2ZyYWN0aW9uICogMjU1ICogYW5pbWF0ZWQuc2NvcGVkYWxwaGEsICItYyIsIGR0X3NpemUgKyBhbmltYXRlZC5hY3RpdmVfZnJhY3Rpb24gKiByZWFkeV9zaXplICsgMSwgIkRUICIsICJcYSIgLi4gcmdiYV90b19oZXgoMjI1LCAyNTUsIDI1NSwgMjU1ICogYW5pbWF0ZWQuYWN0aXZlX2ZyYWN0aW9uICogYW5pbWF0ZWQuc2NvcGVkYWxwaGEpIC4uICJBQ1RJVkUiKQ0KICAgICAgICBlbHNlDQogICAgICAgIHJlYWR5X3NpemUgPSByZW5kZXJlci5tZWFzdXJlX3RleHQoIi0iLCAiUkVBRFkiKQ0KICAgICAgICAgICAgZHRfc2l6ZSA9IHJlbmRlcmVyLm1lYXN1cmVfdGV4dCgiLSIsICJEVCAiKQ0KICAgICAgICAgICAgcmVuZGVyZXIudGV4dCh4LzIgKyAoKGR0X3NpemUgKyByZWFkeV9zaXplICsgMikvMikgKiBzY29wZWRfZnJhY3Rpb24sIHkvMiArIDUwLCAyNTUsIDI1NSwgMjU1LCBhbmltYXRlZC5hY3RpdmVfZnJhY3Rpb24gKiAyNTUgKiBhbmltYXRlZC5zY29wZWRhbHBoYSwgIi1jIiwgZHRfc2l6ZSArIGFuaW1hdGVkLmFjdGl2ZV9mcmFjdGlvbiAqIHJlYWR5X3NpemUgKyAxLCAiRFQgIiwgIlxhIiAuLiByZ2JhX3RvX2hleCgyMDAsIDI1NSwgMjAwLCAyNTUgKiBhbmltYXRlZC5hY3RpdmVfZnJhY3Rpb24gKiBhbmltYXRlZC5zY29wZWRhbHBoYSkgLi4gIlJFQURZIikNCiAgICAgICAgZW5kDQoNCiAgICBsb2NhbCBjaGFyZ2luZ19zaXplID0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCItIiwgIldBSVRJTkciKQ0KICAgIGxvY2FsIHJldCA9IGFuaW1hdGVfdGV4dChnbG9iYWxzLmN1cnRpbWUoKSAqIDgsICJXQUlUSU5HIiwgMjU1LCAyNTUsIDI1NSwgNTAgKiBhbmltYXRlZC5zY29wZWRhbHBoYSwgMjU1LCAwLCAwLCAyNTUgKiBhbmltYXRlZC5zY29wZWRhbHBoYSkgDQogICAgICAgIGR0X3NpemUgPSByZW5kZXJlci5tZWFzdXJlX3RleHQoIi0iLCAiRFQgIikNCiAgICAgICAgcmVuZGVyZXIudGV4dCh4LzIgKyAoKGR0X3NpemUgKyBjaGFyZ2luZ19zaXplICsgMikvMikgKiBzY29wZWRfZnJhY3Rpb24sIHkvMiArIDUwLCAyNTUsIDI1NSwgMjU1LCBhbmltYXRlZC5pbmFjdGl2ZV9mcmFjdGlvbiAqIDI1NSAqIGFuaW1hdGVkLnNjb3BlZGFscGhhICwgIi1jIiwgZHRfc2l6ZSArIGFuaW1hdGVkLmluYWN0aXZlX2ZyYWN0aW9uICogY2hhcmdpbmdfc2l6ZSArIDEsICJEVCAiLCByZXQpDQoNCg0KDQoNCiAgICBsb2NhbCBoaWRlX3NpemUgPSByZW5kZXJlci5tZWFzdXJlX3RleHQoIi0iLCAiT1NBQSAiKQ0KICAgIGxvY2FsIGFjdGl2ZV9zaXplID0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCItIiwgIkFDVElWRSIpDQogICAgcmVuZGVyZXIudGV4dCh4LzIgKyAoKGhpZGVfc2l6ZSArIGFjdGl2ZV9zaXplICsgMikvMikgKiBzY29wZWRfZnJhY3Rpb24sIHkvMiArIDUwLCAyNTUsIDI1NSwgMjU1LCBhbmltYXRlZC5oaWRlX2ZyYWN0aW9uICogMjU1ICogYW5pbWF0ZWQuc2NvcGVkYWxwaGEsICItYyIsIGhpZGVfc2l6ZSArIGFuaW1hdGVkLmhpZGVfZnJhY3Rpb24gKiBhY3RpdmVfc2l6ZSArIDEsICJISURFICIsICJcYSIgLi4gcmdiYV90b19oZXgoMTIwLCAyNTUsIDEyMCwgMjU1ICogYW5pbWF0ZWQuaGlkZV9mcmFjdGlvbiAqIGFuaW1hdGVkLnNjb3BlZGFscGhhKSAuLiAiQUNUSVZFIikNCg0KICAgIGxvY2FsIGRtZ19zaXplID0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCItIiwgIkRNRyAiKQ0KICAgIHJlbmRlcmVyLnRleHQoeC8yICsgKChkbWdfc2l6ZSArIDIpLzIpICogc2NvcGVkX2ZyYWN0aW9uLCB5LzIgKyA1MCArIDcgKiBlYXNlSW5PdXQoYW5pbWF0ZWQuZnJhY3Rpb24pLCAyNTUsIDI1NSwgMjU1LCBhbmltYXRlZC5kbWdfZnJhY3Rpb24gKiAyNTUgKiBhbmltYXRlZC5zY29wZWRhbHBoYSwgIi1jIiwgYW5pbWF0ZWQuZG1nX2ZyYWN0aW9uICogZG1nX3NpemUgKyAxLCAiRCIsICJcYSIgLi4gcmdiYV90b19oZXgoMjU1LCAyNTUsIDI1NSwgYW5pbWF0ZWQuZG1nX2ZyYWN0aW9uICogMjU1ICogYW5pbWF0ZWQuc2NvcGVkYWxwaGEpIC4uICJNIiwgIlxhIiAuLiByZ2JhX3RvX2hleCgyNTUsIDI1NSwgMjU1LCBhbmltYXRlZC5kbWdfZnJhY3Rpb24gKiAyNTUgKiBhbmltYXRlZC5zY29wZWRhbHBoYSkgLi4gIkciKQ0KDQoNCiAgICBsb2NhbCBzdGF0ZV9zaXplID0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCItIiwgJy0gJyAuLiBzdHJpbmcudXBwZXIoc3RhdGUpIC4uICcgPCcpDQogICAgcmVuZGVyZXIudGV4dCh4LzIgKyAoKHN0YXRlX3NpemUgKyAyKS8yKSAqIHNjb3BlZF9mcmFjdGlvbiwgeS8yICsgNDEsIDI1NSwgMjU1LCAyNTUsIDI1NSAqIGFuaW1hdGVkLnNjb3BlZGFscGhhLCAiLWMiLCAwLCAnLSAnIC4uIHN0cmluZy51cHBlcihzdGF0ZSkgLi4gJyAtJykNCmVsc2VpZiB1aS5nZXQodmlzdWFsc190YWIuY2VudGVyX2luZGljYXRvcnMpID09ICJQYXJhZGlzZSIgdGhlbg0KICAgIGxvY2FsIHgsIHkgPSBjbGllbnQuc2NyZWVuX3NpemUoKQ0KICAgIGxvY2FsIGxvZ29fdywgbG9nb19oID0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCJjIiwgIm1lZ2FtaXgiKQ0KICAgIA0KICAgIHN0YXRlID0gYW50aV9haW1zOmdldF9zdGF0ZV90eXBlKCkNCiAgICBhbmdsZSA9IG1hdGgubWluKDU3LCBtYXRoLmFicyhlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fZmxQb3NlUGFyYW1ldGVyIiwgMTEpKjEyMC02MCkpCQ0KICAgIGlmIHN3YXkoKSAgPiAwIHRoZW4NCiAgICAgICAgYW5pbWF0ZWQubmV3c3dheSA9IGxlcnAoYW5pbWF0ZWQubmV3c3dheSwgc3dheSgpLCBnbG9iYWxzLmZyYW1ldGltZSgpICogMjQpDQogICAgICAgIGVsc2UgDQogICAgICAgIGFuaW1hdGVkLm5ld3N3YXkgPSBsZXJwKGFuaW1hdGVkLm5ld3N3YXksIDAsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAyNCkNCiAgICAgICAgZW5kDQoNCiAgICBpZiB1aS5nZXQodmlzdWFsc190YWIub25zY29wZSkgPT0gIlJpZ2h0IiB0aGVuIA0KICAgIGlmIHNjcGQgfj0gMCB0aGVuDQogICAgICAgIGFuaW1hdGVkLnNjb3BlZF9mcmFjdGlvbiA9IGxlcnAoYW5pbWF0ZWQuc2NvcGVkX2ZyYWN0aW9uLCAxLCBnbG9iYWxzLmZyYW1ldGltZSgpICogMjQpDQogICAgICAgIGFuaW1hdGVkLnNjb3BlZGFscGhhID0gbGVycChhbmltYXRlZC5zY29wZWRhbHBoYSwgMSwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE0KQ0KICAgICAgICBhbHBoYWZvcmxvZ28gPSAiXGFmZmZmZmZmZiINCiAgICBlbHNlDQogICAgICAgIGFuaW1hdGVkLnNjb3BlZF9mcmFjdGlvbiA9IGxlcnAoYW5pbWF0ZWQuc2NvcGVkX2ZyYWN0aW9uLCAwLCBnbG9iYWxzLmZyYW1ldGltZSgpICogMjQpDQogICAgICAgIGFuaW1hdGVkLnNjb3BlZGFscGhhID0gbGVycChhbmltYXRlZC5zY29wZWRhbHBoYSwgMSwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDI0KQ0KICAgICAgICBhbHBoYWZvcmxvZ28gPSAiXGFmZmZmZmZmZiINCiAgICBlbmQNCiAgICBlbHNlaWYgdWkuZ2V0KHZpc3VhbHNfdGFiLm9uc2NvcGUpID09ICJCbGVzcyIgdGhlbiANCiAgICBhbmltYXRlZC5zY29wZWRfZnJhY3Rpb24gPSBsZXJwKGFuaW1hdGVkLnNjb3BlZF9mcmFjdGlvbiwgMCwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDI0LCAwLCAxKQ0KICAgIGlmIHNjcGQgfj0gMCB0aGVuDQogICAgICAgIGFscGhhZm9ybG9nbyA9ICJcYWZmZmZmZjAwIg0KICAgIGFuaW1hdGVkLnNjb3BlZGFscGhhID0gbGVycChhbmltYXRlZC5zY29wZWRhbHBoYSwgMCwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDI0KQ0KICAgIGVsc2UgDQogICAgICAgIGFscGhhZm9ybG9nbyA9ICJcYWZmZmZmZmZmIg0KICAgICAgICBhbmltYXRlZC5zY29wZWRhbHBoYSA9IGxlcnAoYW5pbWF0ZWQuc2NvcGVkYWxwaGEsIDEsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAyNCkNCiAgICBlbmQNCiAgICBlbHNlaWYgdWkuZ2V0KHZpc3VhbHNfdGFiLm9uc2NvcGUpID09ICJPZmYiIHRoZW4gDQogICAgICAgIGFscGhhZm9ybG9nbyA9ICJcYWZmZmZmZmZmIg0KICAgICAgICBhbmltYXRlZC5zY29wZWRhbHBoYSA9IGxlcnAoYW5pbWF0ZWQuc2NvcGVkYWxwaGEsIDEsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAyNCkNCiAgICAgICAgYW5pbWF0ZWQuc2NvcGVkX2ZyYWN0aW9uID0gbGVycChhbmltYXRlZC5zY29wZWRfZnJhY3Rpb24sIDAsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAyNCwgMCwgMSkNCiAgICBlbmQNCiAgICBpZiB1aS5nZXQodmlzdWFsc190YWIub25zY29wZSkgPT0gIlJpZ2h0IiB0aGVuIA0KICAgIGlmIHNjcGQgfj0gMCB0aGVuIGFuaW1hdGVkLmZvcm1lZ2FtaXggPSBsZXJwKGFuaW1hdGVkLmZvcm1lZ2FtaXgsIDAsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAyNCkgZWxzZSBhbmltYXRlZC5mb3JtZWdhbWl4ID0gbGVycChhbmltYXRlZC5mb3JtZWdhbWl4LCAxLCBnbG9iYWxzLmZyYW1ldGltZSgpICogMjQpIGVuZA0KICAgIGVsc2UNCiAgICAgICAgYW5pbWF0ZWQuZm9ybWVnYW1peCA9IGxlcnAoYW5pbWF0ZWQuZm9ybWVnYW1peCwgMSwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDI0KQ0KICAgIGVuZA0KICAgIGxvY2FsIHNjb3BlZF9mcmFjdGlvbiA9IGFuaW1hdGVkLnNjb3BlZF9mcmFjdGlvbiANCiAgICBsb2NhbCByciwgZ2csIGJiID0gcmFpbmJvd2l6ZSgoMS8xMCksIDEpDQogICAgcmVuZGVyZXIudGV4dCh4LzIsIHkvMiArIDI4LCByciwgZ2csIGJiLCAyNTUgKiBhbmltYXRlZC5zY29wZWRhbHBoYSwgImQiLCBodHJzd2F5KCksIGFuaW1hdGVfdGV4dChnbG9iYWxzLmN1cnRpbWUoKSAqIDEuNSwgc3RyaW5nLnVwcGVyKCI+X21lZ2FtaXgiKSwgcnIsZ2csYmIsMjU1LGJiLHJyLGdnLDI1NSkpDQogICAgbG9jYWwgbHAgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpDQogICAgbG9jYWwgbmV4dEF0dGFjayA9IGVudGl0eS5nZXRfcHJvcChscCwgIm1fZmxOZXh0QXR0YWNrIikNCiAgICBsb2NhbCBuZXh0UHJpbWFyeUF0dGFjayA9IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24obHApLCAibV9mbE5leHRQcmltYXJ5QXR0YWNrIikNCiAgICBsb2NhbCBkdF9hY3RpdmUgPSBmYWxzZQ0KICAgIGlmIG5leHRQcmltYXJ5QXR0YWNrIH49IG5pbCB0aGVuDQogICAgICAgIGR0X2FjdGl2ZSA9IG5vdCAobWF0aC5tYXgobmV4dFByaW1hcnlBdHRhY2ssIG5leHRBdHRhY2spID4gZ2xvYmFscy5jdXJ0aW1lKCkpDQogICAgZW5kDQoNCiAgICBsb2NhbCBuZXh0X2F0dGFjayA9IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9mbE5leHRBdHRhY2siKQ0KICAgIGxvY2FsIG5leHRfcHJpbWFyeV9hdHRhY2sgPSBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpLCAibV9mbE5leHRQcmltYXJ5QXR0YWNrIikNCg0KICAgIGxvY2FsIGR0X3RvZ2dsZWQgPSB1aS5nZXQoa2V5c2ZvcmluZHMuZG91YmxldGFwWzFdKSBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmRvdWJsZXRhcFsyXSkNCg0KICAgIGlmIGR0X3RvZ2dsZWQgYW5kIGR0X2FjdGl2ZSB0aGVuDQogICAgICAgIGFuaW1hdGVkLmFjdGl2ZV9mcmFjdGlvbiA9IGN0eF9jbGFtcChhbmltYXRlZC5hY3RpdmVfZnJhY3Rpb24gKyBnbG9iYWxzLmZyYW1ldGltZSgpLzAsIDAsIDEpDQogICAgZWxzZQ0KICAgICAgICBhbmltYXRlZC5hY3RpdmVfZnJhY3Rpb24gPSBjdHhfY2xhbXAoYW5pbWF0ZWQuYWN0aXZlX2ZyYWN0aW9uIC0gZ2xvYmFscy5mcmFtZXRpbWUoKS8wLCAwLCAxKQ0KICAgIGVuZA0KDQogICAgaWYgZHRfdG9nZ2xlZCBhbmQgbm90IGR0X2FjdGl2ZSB0aGVuDQogICAgICAgIGFuaW1hdGVkLmluYWN0aXZlX2ZyYWN0aW9uID0gY3R4X2NsYW1wKGFuaW1hdGVkLmluYWN0aXZlX2ZyYWN0aW9uICsgZ2xvYmFscy5mcmFtZXRpbWUoKS8wLCAwLCAxKQ0KICAgIGVsc2UNCiAgICAgICAgYW5pbWF0ZWQuaW5hY3RpdmVfZnJhY3Rpb24gPSBjdHhfY2xhbXAoYW5pbWF0ZWQuaW5hY3RpdmVfZnJhY3Rpb24gLSBnbG9iYWxzLmZyYW1ldGltZSgpLzAsIDAsIDEpDQogICAgZW5kDQoNCiAgICBpZiB1aS5nZXQoa2V5c2ZvcmluZHMuaGlkZXNob3RzWzFdKSBhbmQgdWkuZ2V0KGtleXNmb3JpbmRzLmhpZGVzaG90c1syXSkgYW5kIG5vdCBkdF90b2dnbGVkIHRoZW4NCiAgICAgICAgYW5pbWF0ZWQuaGlkZV9mcmFjdGlvbiA9IGN0eF9jbGFtcChhbmltYXRlZC5oaWRlX2ZyYWN0aW9uICsgZ2xvYmFscy5mcmFtZXRpbWUoKS8wLCAwLCAxKQ0KICAgIGVsc2UNCiAgICAgICAgYW5pbWF0ZWQuaGlkZV9mcmFjdGlvbiA9IGN0eF9jbGFtcChhbmltYXRlZC5oaWRlX2ZyYWN0aW9uIC0gZ2xvYmFscy5mcmFtZXRpbWUoKS8wLCAwLCAxKQ0KICAgIGVuZA0KDQogICAgaWYgbWF0aC5tYXgoYW5pbWF0ZWQuaGlkZV9mcmFjdGlvbiwgYW5pbWF0ZWQuaW5hY3RpdmVfZnJhY3Rpb24sIGFuaW1hdGVkLmFjdGl2ZV9mcmFjdGlvbikgPiAwIHRoZW4NCiAgICAgICAgYW5pbWF0ZWQuZnJhY3Rpb24gPSBjdHhfY2xhbXAoYW5pbWF0ZWQuZnJhY3Rpb24gKyBnbG9iYWxzLmZyYW1ldGltZSgpLzAsIDAsIDEpDQogICAgZWxzZQ0KICAgICAgICBhbmltYXRlZC5mcmFjdGlvbiA9IGN0eF9jbGFtcChhbmltYXRlZC5mcmFjdGlvbiAtIGdsb2JhbHMuZnJhbWV0aW1lKCkvMCwgMCwgMSkNCiAgICBlbmQNCg0KICAgIGlmIHVpLmdldChrZXliaW5kc190YWIuZnJlZXN0YW5kKSB0aGVuDQogICAgICAgIGFuaW1hdGVkLmRtZ19mcmFjdGlvbiA9IGN0eF9jbGFtcChhbmltYXRlZC5kbWdfZnJhY3Rpb24gKyBnbG9iYWxzLmZyYW1ldGltZSgpLzAsIDAsIDEpDQogICAgZWxzZQ0KICAgICAgICBhbmltYXRlZC5kbWdfZnJhY3Rpb24gPSBjdHhfY2xhbXAoYW5pbWF0ZWQuZG1nX2ZyYWN0aW9uIC0gZ2xvYmFscy5mcmFtZXRpbWUoKS8wLCAwLCAxKQ0KICAgIGVuZA0KDQoNCiAgICBsb2NhbCBkdF9zaXplID0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCJjIiwgIkRUICIpDQoNCiAgICAgICAgICAgIHJlbmRlcmVyLnRleHQoeC8yICsgKGR0X3NpemUpLCB5LzIgKyA0NSwgMjU1LCAyNTUsIDI1NSwgYW5pbWF0ZWQuYWN0aXZlX2ZyYWN0aW9uICogMjU1ICogYW5pbWF0ZWQuc2NvcGVkYWxwaGEsICJjIiwgZHRfc2l6ZSArIGFuaW1hdGVkLmFjdGl2ZV9mcmFjdGlvbiArIDEsICJEVCAiKQ0KDQogICAgICAgICAgICByZW5kZXJlci50ZXh0KHgvMiArIChkdF9zaXplKSwgeS8yICsgNDUsIDI1NSwgMCwgMCwgYW5pbWF0ZWQuaW5hY3RpdmVfZnJhY3Rpb24gKiAyNTUgKiBhbmltYXRlZC5zY29wZWRhbHBoYSwgImMiLCBkdF9zaXplICsgYW5pbWF0ZWQuaW5hY3RpdmVfZnJhY3Rpb24gKyAxLCAiRFQgIikNCg0KICAgIGxvY2FsIGhpZGVfc2l6ZSA9IHJlbmRlcmVyLm1lYXN1cmVfdGV4dCgiYyIsICJIUyAiKQ0KICAgIHJlbmRlcmVyLnRleHQoeC8yICsgKGhpZGVfc2l6ZSksIHkvMiArIDQ1LCAyNTUsIDI1NSwgMjU1LCBhbmltYXRlZC5oaWRlX2ZyYWN0aW9uICogMjU1ICogYW5pbWF0ZWQuc2NvcGVkYWxwaGEsICJjIiwgaGlkZV9zaXplICsgYW5pbWF0ZWQuaGlkZV9mcmFjdGlvbiArIDEsICJIUyAiKQ0KDQogICAgbG9jYWwgZG1nX3NpemUgPSByZW5kZXJlci5tZWFzdXJlX3RleHQoImMiLCAiRlMgIikNCiAgICByZW5kZXJlci50ZXh0KHgvMiArIChkbWdfc2l6ZSksIHkvMiArIDUwICsgNyAqIGVhc2VJbk91dChhbmltYXRlZC5mcmFjdGlvbiksIDI1NSwgMjU1LCAyNTUsIGFuaW1hdGVkLmRtZ19mcmFjdGlvbiAqIDI1NSAqIGFuaW1hdGVkLnNjb3BlZGFscGhhLCAiYyIsIGFuaW1hdGVkLmRtZ19mcmFjdGlvbiAqIGRtZ19zaXplICsgMSwgIkZTICIpDQoNCg0KZW5kDQplbmQp"}
